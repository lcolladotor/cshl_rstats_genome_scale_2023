<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 RSE plotting basics with smokingMouse | Statistical Analysis of Genome Scale Data 2023</title>
  <meta name="description" content="6 RSE plotting basics with smokingMouse | Statistical Analysis of Genome Scale Data 2023" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="6 RSE plotting basics with smokingMouse | Statistical Analysis of Genome Scale Data 2023" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="lcolladotor/cshl_rstats_genome_scale_2023" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 RSE plotting basics with smokingMouse | Statistical Analysis of Genome Scale Data 2023" />
  
  
  

<meta name="author" content="Leonardo Collado-Torres" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="icon_32.png" type="image/x-icon" />
<link rel="prev" href="isee-introduction.html"/>
<link rel="next" href="biocthis-introduction.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#download-course-materials"><i class="fa fa-check"></i>Download course materials</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#code-of-conduct"><i class="fa fa-check"></i>Code of Conduct</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-schedule"><i class="fa fa-check"></i>Course Schedule</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#external-links"><i class="fa fa-check"></i>External links</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-prerequisites"><i class="fa fa-check"></i>Course Prerequisites</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#r-session-information"><i class="fa fa-check"></i>R session information</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="speaqeasy-introduction.html"><a href="speaqeasy-introduction.html"><i class="fa fa-check"></i><b>1</b> SPEAQeasy introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="speaqeasy-introduction.html"><a href="speaqeasy-introduction.html#overview-slides"><i class="fa fa-check"></i><b>1.1</b> 2022-04-20 overview slides</a></li>
<li class="chapter" data-level="1.2" data-path="speaqeasy-introduction.html"><a href="speaqeasy-introduction.html#speaqeasy-main-links"><i class="fa fa-check"></i><b>1.2</b> SPEAQeasy main links</a></li>
<li class="chapter" data-level="1.3" data-path="speaqeasy-introduction.html"><a href="speaqeasy-introduction.html#pipeline-outputs"><i class="fa fa-check"></i><b>1.3</b> Pipeline outputs</a></li>
<li class="chapter" data-level="1.4" data-path="speaqeasy-introduction.html"><a href="speaqeasy-introduction.html#exercises"><i class="fa fa-check"></i><b>1.4</b> Exercises</a></li>
<li class="chapter" data-level="1.5" data-path="speaqeasy-introduction.html"><a href="speaqeasy-introduction.html#solutions"><i class="fa fa-check"></i><b>1.5</b> Solutions</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="smokingmouse-study.html"><a href="smokingmouse-study.html"><i class="fa fa-check"></i><b>2</b> smokingMouse study</a>
<ul>
<li class="chapter" data-level="2.1" data-path="smokingmouse-study.html"><a href="smokingmouse-study.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="smokingmouse-study.html"><a href="smokingmouse-study.html#overview-1"><i class="fa fa-check"></i><b>2.2</b> Overview</a></li>
<li class="chapter" data-level="2.3" data-path="smokingmouse-study.html"><a href="smokingmouse-study.html#goals"><i class="fa fa-check"></i><b>2.3</b> Goals</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="smokingmouse-study.html"><a href="smokingmouse-study.html#main-objective"><i class="fa fa-check"></i><b>2.3.1</b> Main objective</a></li>
<li class="chapter" data-level="2.3.2" data-path="smokingmouse-study.html"><a href="smokingmouse-study.html#secondary-objectives"><i class="fa fa-check"></i><b>2.3.2</b> Secondary objectives</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="smokingmouse-study.html"><a href="smokingmouse-study.html#study-design"><i class="fa fa-check"></i><b>2.4</b> Study design</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="summarizedexperiment-review.html"><a href="summarizedexperiment-review.html"><i class="fa fa-check"></i><b>3</b> SummarizedExperiment review</a>
<ul>
<li class="chapter" data-level="3.1" data-path="summarizedexperiment-review.html"><a href="summarizedexperiment-review.html#overview-2"><i class="fa fa-check"></i><b>3.1</b> Overview</a></li>
<li class="chapter" data-level="3.2" data-path="summarizedexperiment-review.html"><a href="summarizedexperiment-review.html#quiz"><i class="fa fa-check"></i><b>3.2</b> Quiz</a></li>
<li class="chapter" data-level="3.3" data-path="summarizedexperiment-review.html"><a href="summarizedexperiment-review.html#exercises-1"><i class="fa fa-check"></i><b>3.3</b> Exercises</a></li>
<li class="chapter" data-level="3.4" data-path="summarizedexperiment-review.html"><a href="summarizedexperiment-review.html#solutions-1"><i class="fa fa-check"></i><b>3.4</b> Solutions</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="smokingmouse-rse.html"><a href="smokingmouse-rse.html"><i class="fa fa-check"></i><b>4</b> smokingMouse RSE</a>
<ul>
<li class="chapter" data-level="4.1" data-path="smokingmouse-rse.html"><a href="smokingmouse-rse.html#download-data"><i class="fa fa-check"></i><b>4.1</b> Download data</a></li>
<li class="chapter" data-level="4.2" data-path="smokingmouse-rse.html"><a href="smokingmouse-rse.html#data-overview"><i class="fa fa-check"></i><b>4.2</b> Data overview</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="smokingmouse-rse.html"><a href="smokingmouse-rse.html#assays"><i class="fa fa-check"></i><b>4.2.1</b> Assays</a></li>
<li class="chapter" data-level="4.2.2" data-path="smokingmouse-rse.html"><a href="smokingmouse-rse.html#sample-data"><i class="fa fa-check"></i><b>4.2.2</b> Sample data</a></li>
<li class="chapter" data-level="4.2.3" data-path="smokingmouse-rse.html"><a href="smokingmouse-rse.html#gene-information"><i class="fa fa-check"></i><b>4.2.3</b> Gene Information</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="isee-introduction.html"><a href="isee-introduction.html"><i class="fa fa-check"></i><b>5</b> iSEE introduction</a>
<ul>
<li class="chapter" data-level="5.1" data-path="isee-introduction.html"><a href="isee-introduction.html#toy-rse-data"><i class="fa fa-check"></i><b>5.1</b> Toy RSE data</a></li>
<li class="chapter" data-level="5.2" data-path="isee-introduction.html"><a href="isee-introduction.html#isee"><i class="fa fa-check"></i><b>5.2</b> iSEE</a></li>
<li class="chapter" data-level="5.3" data-path="isee-introduction.html"><a href="isee-introduction.html#exercise-with-data-from-spatiallibd"><i class="fa fa-check"></i><b>5.3</b> Exercise with data from spatialLIBD</a></li>
<li class="chapter" data-level="5.4" data-path="isee-introduction.html"><a href="isee-introduction.html#community"><i class="fa fa-check"></i><b>5.4</b> Community</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="rse-plotting-basics-with-smokingmouse.html"><a href="rse-plotting-basics-with-smokingmouse.html"><i class="fa fa-check"></i><b>6</b> RSE plotting basics with smokingMouse</a>
<ul>
<li class="chapter" data-level="6.1" data-path="rse-plotting-basics-with-smokingmouse.html"><a href="rse-plotting-basics-with-smokingmouse.html#download-the-smokingmouse-data"><i class="fa fa-check"></i><b>6.1</b> Download the smokingMouse data</a></li>
<li class="chapter" data-level="6.2" data-path="rse-plotting-basics-with-smokingmouse.html"><a href="rse-plotting-basics-with-smokingmouse.html#data-preparation"><i class="fa fa-check"></i><b>6.2</b> Data preparation</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="rse-plotting-basics-with-smokingmouse.html"><a href="rse-plotting-basics-with-smokingmouse.html#data-normalization"><i class="fa fa-check"></i><b>6.2.1</b> Data normalization</a></li>
<li class="chapter" data-level="6.2.2" data-path="rse-plotting-basics-with-smokingmouse.html"><a href="rse-plotting-basics-with-smokingmouse.html#gene-filtering"><i class="fa fa-check"></i><b>6.2.2</b> Gene filtering</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="rse-plotting-basics-with-smokingmouse.html"><a href="rse-plotting-basics-with-smokingmouse.html#exploratory-data-analysis"><i class="fa fa-check"></i><b>6.3</b> Exploratory Data Analysis</a></li>
<li class="chapter" data-level="6.4" data-path="rse-plotting-basics-with-smokingmouse.html"><a href="rse-plotting-basics-with-smokingmouse.html#quality-control-analysis"><i class="fa fa-check"></i><b>6.4</b> Quality Control Analysis</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="rse-plotting-basics-with-smokingmouse.html"><a href="rse-plotting-basics-with-smokingmouse.html#evaluate-qc-metrics-for-groups-of-samples"><i class="fa fa-check"></i><b>6.4.1</b> Evaluate QC metrics for groups of samples</a></li>
<li class="chapter" data-level="6.4.2" data-path="rse-plotting-basics-with-smokingmouse.html"><a href="rse-plotting-basics-with-smokingmouse.html#examine-relationships-between-qc-metrics-of-samples"><i class="fa fa-check"></i><b>6.4.2</b> Examine relationships between QC metrics of samples</a></li>
<li class="chapter" data-level="6.4.3" data-path="rse-plotting-basics-with-smokingmouse.html"><a href="rse-plotting-basics-with-smokingmouse.html#qc-sample-filtering"><i class="fa fa-check"></i><b>6.4.3</b> QC sample filtering</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="rse-plotting-basics-with-smokingmouse.html"><a href="rse-plotting-basics-with-smokingmouse.html#miscellaneous-about-cpm-values"><i class="fa fa-check"></i><b>6.5</b> Miscellaneous about CPM values</a></li>
<li class="chapter" data-level="" data-path="rse-plotting-basics-with-smokingmouse.html"><a href="rse-plotting-basics-with-smokingmouse.html#references"><i class="fa fa-check"></i>References</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="biocthis-introduction.html"><a href="biocthis-introduction.html"><i class="fa fa-check"></i><b>7</b> biocthis introduction</a>
<ul>
<li class="chapter" data-level="7.1" data-path="biocthis-introduction.html"><a href="biocthis-introduction.html#related-past-materials"><i class="fa fa-check"></i><b>7.1</b> Related past materials</a></li>
<li class="chapter" data-level="7.2" data-path="biocthis-introduction.html"><a href="biocthis-introduction.html#biocthis-main-commands"><i class="fa fa-check"></i><b>7.2</b> biocthis main commands</a></li>
<li class="chapter" data-level="7.3" data-path="biocthis-introduction.html"><a href="biocthis-introduction.html#live-demo"><i class="fa fa-check"></i><b>7.3</b> Live demo</a></li>
<li class="chapter" data-level="7.4" data-path="biocthis-introduction.html"><a href="biocthis-introduction.html#community-1"><i class="fa fa-check"></i><b>7.4</b> Community</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="recount3-introduction.html"><a href="recount3-introduction.html"><i class="fa fa-check"></i><b>8</b> recount3 introduction</a>
<ul>
<li class="chapter" data-level="8.1" data-path="recount3-introduction.html"><a href="recount3-introduction.html#recount-projects"><i class="fa fa-check"></i><b>8.1</b> recount projects</a></li>
<li class="chapter" data-level="8.2" data-path="recount3-introduction.html"><a href="recount3-introduction.html#using-recount3"><i class="fa fa-check"></i><b>8.2</b> Using recount3</a></li>
<li class="chapter" data-level="8.3" data-path="recount3-introduction.html"><a href="recount3-introduction.html#exercise"><i class="fa fa-check"></i><b>8.3</b> Exercise</a></li>
<li class="chapter" data-level="8.4" data-path="recount3-introduction.html"><a href="recount3-introduction.html#community-2"><i class="fa fa-check"></i><b>8.4</b> Community</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="interpreting-model-coefficients-with-exploremodelmatrix.html"><a href="interpreting-model-coefficients-with-exploremodelmatrix.html"><i class="fa fa-check"></i><b>9</b> Interpreting model coefficients with ExploreModelMatrix</a>
<ul>
<li class="chapter" data-level="9.1" data-path="interpreting-model-coefficients-with-exploremodelmatrix.html"><a href="interpreting-model-coefficients-with-exploremodelmatrix.html#model-objects-in-r"><i class="fa fa-check"></i><b>9.1</b> Model objects in R</a></li>
<li class="chapter" data-level="9.2" data-path="interpreting-model-coefficients-with-exploremodelmatrix.html"><a href="interpreting-model-coefficients-with-exploremodelmatrix.html#exploremodelmatrix"><i class="fa fa-check"></i><b>9.2</b> ExploreModelMatrix</a></li>
<li class="chapter" data-level="9.3" data-path="interpreting-model-coefficients-with-exploremodelmatrix.html"><a href="interpreting-model-coefficients-with-exploremodelmatrix.html#example-1"><i class="fa fa-check"></i><b>9.3</b> Example 1</a></li>
<li class="chapter" data-level="9.4" data-path="interpreting-model-coefficients-with-exploremodelmatrix.html"><a href="interpreting-model-coefficients-with-exploremodelmatrix.html#example-2"><i class="fa fa-check"></i><b>9.4</b> Example 2</a></li>
<li class="chapter" data-level="9.5" data-path="interpreting-model-coefficients-with-exploremodelmatrix.html"><a href="interpreting-model-coefficients-with-exploremodelmatrix.html#example-3"><i class="fa fa-check"></i><b>9.5</b> Example 3</a></li>
<li class="chapter" data-level="9.6" data-path="interpreting-model-coefficients-with-exploremodelmatrix.html"><a href="interpreting-model-coefficients-with-exploremodelmatrix.html#exercise-1"><i class="fa fa-check"></i><b>9.6</b> Exercise</a></li>
<li class="chapter" data-level="9.7" data-path="interpreting-model-coefficients-with-exploremodelmatrix.html"><a href="interpreting-model-coefficients-with-exploremodelmatrix.html#to-learn-more"><i class="fa fa-check"></i><b>9.7</b> To learn more</a></li>
<li class="chapter" data-level="9.8" data-path="interpreting-model-coefficients-with-exploremodelmatrix.html"><a href="interpreting-model-coefficients-with-exploremodelmatrix.html#community-3"><i class="fa fa-check"></i><b>9.8</b> Community</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="differential-gene-expression-analysis-with-limma.html"><a href="differential-gene-expression-analysis-with-limma.html"><i class="fa fa-check"></i><b>10</b> Differential gene expression analysis with limma</a>
<ul>
<li class="chapter" data-level="10.1" data-path="differential-gene-expression-analysis-with-limma.html"><a href="differential-gene-expression-analysis-with-limma.html#srp045638-data"><i class="fa fa-check"></i><b>10.1</b> SRP045638 data</a></li>
<li class="chapter" data-level="10.2" data-path="differential-gene-expression-analysis-with-limma.html"><a href="differential-gene-expression-analysis-with-limma.html#data-normalization-1"><i class="fa fa-check"></i><b>10.2</b> Data normalization</a></li>
<li class="chapter" data-level="10.3" data-path="differential-gene-expression-analysis-with-limma.html"><a href="differential-gene-expression-analysis-with-limma.html#differential-expression"><i class="fa fa-check"></i><b>10.3</b> Differential expression</a></li>
<li class="chapter" data-level="10.4" data-path="differential-gene-expression-analysis-with-limma.html"><a href="differential-gene-expression-analysis-with-limma.html#visualizing-degs"><i class="fa fa-check"></i><b>10.4</b> Visualizing DEGs</a></li>
<li class="chapter" data-level="10.5" data-path="differential-gene-expression-analysis-with-limma.html"><a href="differential-gene-expression-analysis-with-limma.html#community-4"><i class="fa fa-check"></i><b>10.5</b> Community</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="differential-gene-expression-exercise.html"><a href="differential-gene-expression-exercise.html"><i class="fa fa-check"></i><b>11</b> Differential gene expression exercise</a>
<ul>
<li class="chapter" data-level="11.1" data-path="differential-gene-expression-exercise.html"><a href="differential-gene-expression-exercise.html#recap"><i class="fa fa-check"></i><b>11.1</b> Recap</a></li>
<li class="chapter" data-level="11.2" data-path="differential-gene-expression-exercise.html"><a href="differential-gene-expression-exercise.html#exercise-2"><i class="fa fa-check"></i><b>11.2</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="de-model-building-with-variancepartition.html"><a href="de-model-building-with-variancepartition.html"><i class="fa fa-check"></i><b>12</b> DE model building with variancePartition</a>
<ul>
<li class="chapter" data-level="12.1" data-path="de-model-building-with-variancepartition.html"><a href="de-model-building-with-variancepartition.html#download-the-smokingmouse-data-and-subset-it"><i class="fa fa-check"></i><b>12.1</b> Download the smokingMouse data and subset it</a></li>
<li class="chapter" data-level="12.2" data-path="de-model-building-with-variancepartition.html"><a href="de-model-building-with-variancepartition.html#explore-gene-level-effects"><i class="fa fa-check"></i><b>12.2</b> Explore gene-level effects</a></li>
<li class="chapter" data-level="12.3" data-path="de-model-building-with-variancepartition.html"><a href="de-model-building-with-variancepartition.html#variance-partition-analysis"><i class="fa fa-check"></i><b>12.3</b> Variance Partition Analysis</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="de-model-building-with-variancepartition.html"><a href="de-model-building-with-variancepartition.html#canonical-correlation-analysis"><i class="fa fa-check"></i><b>12.3.1</b> Canonical Correlation Analysis</a></li>
<li class="chapter" data-level="12.3.2" data-path="de-model-building-with-variancepartition.html"><a href="de-model-building-with-variancepartition.html#fit-model-and-extract-fraction-of-variance-explained"><i class="fa fa-check"></i><b>12.3.2</b> Fit model and extract fraction of variance explained</a></li>
<li class="chapter" data-level="12.3.3" data-path="de-model-building-with-variancepartition.html"><a href="de-model-building-with-variancepartition.html#examine-expression-of-most-affected-genes-by-each-sample-variable"><i class="fa fa-check"></i><b>12.3.3</b> Examine expression of most affected genes by each sample variable</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="de-model-building-with-variancepartition.html"><a href="de-model-building-with-variancepartition.html#solutions-2"><i class="fa fa-check"></i><b>12.4</b> Solutions</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="de-model-building-with-variancepartition.html"><a href="de-model-building-with-variancepartition.html#exercise-1-1"><i class="fa fa-check"></i><b>12.4.1</b> Exercise 1</a></li>
<li class="chapter" data-level="12.4.2" data-path="de-model-building-with-variancepartition.html"><a href="de-model-building-with-variancepartition.html#exercise-2-1"><i class="fa fa-check"></i><b>12.4.2</b> Exercise 2</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="de-model-building-with-variancepartition.html"><a href="de-model-building-with-variancepartition.html#references-1"><i class="fa fa-check"></i>References</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="expression-heatmaps-with-complexheatmap.html"><a href="expression-heatmaps-with-complexheatmap.html"><i class="fa fa-check"></i><b>13</b> Expression heatmaps with ComplexHeatmap</a>
<ul>
<li class="chapter" data-level="13.1" data-path="expression-heatmaps-with-complexheatmap.html"><a href="expression-heatmaps-with-complexheatmap.html#introduction-1"><i class="fa fa-check"></i><b>13.1</b> Introduction</a></li>
<li class="chapter" data-level="13.2" data-path="expression-heatmaps-with-complexheatmap.html"><a href="expression-heatmaps-with-complexheatmap.html#complexheatmap"><i class="fa fa-check"></i><b>13.2</b> ComplexHeatmap</a></li>
<li class="chapter" data-level="13.3" data-path="expression-heatmaps-with-complexheatmap.html"><a href="expression-heatmaps-with-complexheatmap.html#heatmap-with-expression-data"><i class="fa fa-check"></i><b>13.3</b> Heatmap with expression data</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="expression-heatmaps-with-complexheatmap.html"><a href="expression-heatmaps-with-complexheatmap.html#download-data-1"><i class="fa fa-check"></i><b>13.3.1</b> Download data</a></li>
<li class="chapter" data-level="13.3.2" data-path="expression-heatmaps-with-complexheatmap.html"><a href="expression-heatmaps-with-complexheatmap.html#prepare-the-data"><i class="fa fa-check"></i><b>13.3.2</b> Prepare the data</a></li>
<li class="chapter" data-level="13.3.3" data-path="expression-heatmaps-with-complexheatmap.html"><a href="expression-heatmaps-with-complexheatmap.html#create-annotations"><i class="fa fa-check"></i><b>13.3.3</b> Create annotations</a></li>
<li class="chapter" data-level="13.3.4" data-path="expression-heatmaps-with-complexheatmap.html"><a href="expression-heatmaps-with-complexheatmap.html#plot-our-heatmap"><i class="fa fa-check"></i><b>13.3.4</b> Plot our heatmap</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="complexheatmap-exercise-solution.html"><a href="complexheatmap-exercise-solution.html"><i class="fa fa-check"></i><b>14</b> ComplexHeatmap exercise solution</a></li>
<li class="chapter" data-level="15" data-path="exercise-with-variancepartition-and-complexheatmap.html"><a href="exercise-with-variancepartition-and-complexheatmap.html"><i class="fa fa-check"></i><b>15</b> Exercise with variancePartition and ComplexHeatmap</a>
<ul>
<li class="chapter" data-level="15.1" data-path="exercise-with-variancepartition-and-complexheatmap.html"><a href="exercise-with-variancepartition-and-complexheatmap.html#steps"><i class="fa fa-check"></i><b>15.1</b> Steps:</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="miscellaneous.html"><a href="miscellaneous.html"><i class="fa fa-check"></i><b>16</b> Miscellaneous</a>
<ul>
<li class="chapter" data-level="16.1" data-path="miscellaneous.html"><a href="miscellaneous.html#postcards"><i class="fa fa-check"></i><b>16.1</b> postcards</a></li>
<li class="chapter" data-level="16.2" data-path="miscellaneous.html"><a href="miscellaneous.html#organizing-your-work"><i class="fa fa-check"></i><b>16.2</b> Organizing your work</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="introduction-to-the-world-of-spatially-resolved-transcriptomics-with-visium-data.html"><a href="introduction-to-the-world-of-spatially-resolved-transcriptomics-with-visium-data.html"><i class="fa fa-check"></i><b>17</b> Introduction to the world of spatially-resolved transcriptomics with Visium data</a>
<ul>
<li class="chapter" data-level="17.1" data-path="introduction-to-the-world-of-spatially-resolved-transcriptomics-with-visium-data.html"><a href="introduction-to-the-world-of-spatially-resolved-transcriptomics-with-visium-data.html#community-5"><i class="fa fa-check"></i><b>17.1</b> Community</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html"><a href="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html"><i class="fa fa-check"></i><b>18</b> Downloading public Visium spatial data and visualizing it with spatialLIBD</a>
<ul>
<li class="chapter" data-level="18.1" data-path="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html"><a href="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html#download-data-from-10x-genomics"><i class="fa fa-check"></i><b>18.1</b> Download data from 10x Genomics</a></li>
<li class="chapter" data-level="18.2" data-path="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html"><a href="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html#add-gene-annotation-information"><i class="fa fa-check"></i><b>18.2</b> Add gene annotation information</a>
<ul>
<li class="chapter" data-level="18.2.1" data-path="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html"><a href="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html#from-10x"><i class="fa fa-check"></i><b>18.2.1</b> From 10x</a></li>
<li class="chapter" data-level="18.2.2" data-path="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html"><a href="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html#from-gencode"><i class="fa fa-check"></i><b>18.2.2</b> From Gencode</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html"><a href="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html#wrapper-functions-for-reading-the-data"><i class="fa fa-check"></i><b>18.3</b> Wrapper functions for reading the data</a></li>
<li class="chapter" data-level="18.4" data-path="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html"><a href="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html#visualize-spatial-plots"><i class="fa fa-check"></i><b>18.4</b> Visualize spatial plots</a></li>
<li class="chapter" data-level="18.5" data-path="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html"><a href="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html#exercise-3"><i class="fa fa-check"></i><b>18.5</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="re-use-of-bulk-rna-seq-methods-for-spatial-data-exercise.html"><a href="re-use-of-bulk-rna-seq-methods-for-spatial-data-exercise.html"><i class="fa fa-check"></i><b>19</b> Re-use of bulk RNA-seq methods for spatial data exercise</a>
<ul>
<li class="chapter" data-level="19.1" data-path="re-use-of-bulk-rna-seq-methods-for-spatial-data-exercise.html"><a href="re-use-of-bulk-rna-seq-methods-for-spatial-data-exercise.html#spatial-registration"><i class="fa fa-check"></i><b>19.1</b> Spatial registration</a></li>
<li class="chapter" data-level="19.2" data-path="re-use-of-bulk-rna-seq-methods-for-spatial-data-exercise.html"><a href="re-use-of-bulk-rna-seq-methods-for-spatial-data-exercise.html#exercise-4"><i class="fa fa-check"></i><b>19.2</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="final-r-session.html"><a href="final-r-session.html"><i class="fa fa-check"></i>Final R Session</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Analysis of Genome Scale Data 2023</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="rse-plotting-basics-with-smokingmouse" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">6</span> RSE plotting basics with smokingMouse<a href="rse-plotting-basics-with-smokingmouse.html#rse-plotting-basics-with-smokingmouse" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Instructor: Daianna</p>
<div id="download-the-smokingmouse-data" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Download the smokingMouse data<a href="rse-plotting-basics-with-smokingmouse.html#download-the-smokingmouse-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We’ve used these commands already in an earlier chapter. Here we’ll re-download
the data, though technically we are using the cached data we had previously
downloaded so this time the code below will run faster.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="rse-plotting-basics-with-smokingmouse.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Load the container package for this type of data</span></span>
<span id="cb38-2"><a href="rse-plotting-basics-with-smokingmouse.html#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;SummarizedExperiment&quot;</span>)</span>
<span id="cb38-3"><a href="rse-plotting-basics-with-smokingmouse.html#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="rse-plotting-basics-with-smokingmouse.html#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Download data</span></span>
<span id="cb38-5"><a href="rse-plotting-basics-with-smokingmouse.html#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;BiocFileCache&quot;</span>)</span>
<span id="cb38-6"><a href="rse-plotting-basics-with-smokingmouse.html#cb38-6" aria-hidden="true" tabindex="-1"></a>bfc <span class="ot">&lt;-</span> BiocFileCache<span class="sc">::</span><span class="fu">BiocFileCache</span>()</span>
<span id="cb38-7"><a href="rse-plotting-basics-with-smokingmouse.html#cb38-7" aria-hidden="true" tabindex="-1"></a>cached_rse_gene <span class="ot">&lt;-</span> BiocFileCache<span class="sc">::</span><span class="fu">bfcrpath</span>(</span>
<span id="cb38-8"><a href="rse-plotting-basics-with-smokingmouse.html#cb38-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> bfc,</span>
<span id="cb38-9"><a href="rse-plotting-basics-with-smokingmouse.html#cb38-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;https://github.com/LieberInstitute/SPEAQeasyWorkshop2023/raw/devel/provisional_data/rse_gene_mouse_RNAseq_nic-smo.Rdata&quot;</span></span>
<span id="cb38-10"><a href="rse-plotting-basics-with-smokingmouse.html#cb38-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-11"><a href="rse-plotting-basics-with-smokingmouse.html#cb38-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-12"><a href="rse-plotting-basics-with-smokingmouse.html#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Check the local path on our cache</span></span>
<span id="cb38-13"><a href="rse-plotting-basics-with-smokingmouse.html#cb38-13" aria-hidden="true" tabindex="-1"></a>cached_rse_gene</span>
<span id="cb38-14"><a href="rse-plotting-basics-with-smokingmouse.html#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                                                                  BFC2 </span></span>
<span id="cb38-15"><a href="rse-plotting-basics-with-smokingmouse.html#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &quot;/github/home/.cache/R/BiocFileCache/4632880fabb_rse_gene_mouse_RNAseq_nic-smo.Rdata&quot;</span></span>
<span id="cb38-16"><a href="rse-plotting-basics-with-smokingmouse.html#cb38-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-17"><a href="rse-plotting-basics-with-smokingmouse.html#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="do">## Load the rse_gene object</span></span>
<span id="cb38-18"><a href="rse-plotting-basics-with-smokingmouse.html#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(cached_rse_gene, <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span>
<span id="cb38-19"><a href="rse-plotting-basics-with-smokingmouse.html#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Loading objects:</span></span>
<span id="cb38-20"><a href="rse-plotting-basics-with-smokingmouse.html#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   rse_gene</span></span>
<span id="cb38-21"><a href="rse-plotting-basics-with-smokingmouse.html#cb38-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-22"><a href="rse-plotting-basics-with-smokingmouse.html#cb38-22" aria-hidden="true" tabindex="-1"></a><span class="do">## Nicotine data</span></span>
<span id="cb38-23"><a href="rse-plotting-basics-with-smokingmouse.html#cb38-23" aria-hidden="true" tabindex="-1"></a>rse_gene_nic <span class="ot">&lt;-</span> rse_gene[, <span class="fu">which</span>(rse_gene<span class="sc">$</span>Expt <span class="sc">==</span> <span class="st">&quot;Nicotine&quot;</span>)]</span></code></pre></div>
<p>In this part of the course you’ll have a plotting session in which you’ll learn what type of plots you can create to explore your data, but please note that this is not a differential expression analysis itself. The steps that will be performed are shown in <strong>Figure 1</strong>.
The main objective of this first part is to explore the quality of the samples, their differences in gene expression variations and the impact of sample variables on gene expression variance. You’ll also learn how to visualize gene expression counts.</p>
<figure>
<img src="Figures/all_analyses.png" width="700px" align=center />
<figcaption style="color: gray; line-height: 0.9; text-align: justify">
<font size="-1.8">
<b>Figure 1</b>: <b> Summary of the analyses for differential expression. </b> Steps in yellow will be properly performed.
<b> 1. Data Preparation</b>: in this initial part counts are normalized and scaled and low-expressed genes are filtered.
<b> 2. Exploratory Data Analysis</b>: the quality of the samples is compared, poor-quality samples are removed and both gene-level and sample-level effects are explored.
<b> 3. Differential Expression Analysis</b>: a linear model is fitted for each gene and log fold changes are obtained for the contrast of interest; other statistics are also computed and compared. Here the differentially expressed genes (DEGs) are determined and quantified.
<b> 4. GO &amp; KEGG Analyses</b>: in this part Gene Ontology and KEGG enrichment analyses are performed to identify biological processes and functions in which DEGs are significantly involved.
<b> 5. DEG visualization</b>: heatmaps are created to visually contrast gene expression levels of DEGs in control and experimental samples. </font>
<font size="0.8">
Abbreviations: CPM: counts per million; QC: quality control; PC: principal component;
DEG: differentially expressed genes; GO: Gene Ontology; KEGG: Kyoto Encyclopedia of Genes and Genomes.
</font>
</figcaption>
</figure>
</div>
<div id="data-preparation" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Data preparation<a href="rse-plotting-basics-with-smokingmouse.html#data-preparation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Even before exploring the samples, we must normalize the counts and filter non-expressed genes; we won’t do the processes themselves since we already have normalized and filtered data but let’s check why these steps are important and where to extract the data we need for posterior analyses.</p>
<div id="data-normalization" class="section level3 hasAnchor" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> Data normalization<a href="rse-plotting-basics-with-smokingmouse.html#data-normalization" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Data normalization is a relevant preliminary step when working with expression data because raw counts do not necessarily reflect real expression measures of the genes, since there are technical differences in the way the libraries are prepared and sequenced, as well as intrinsic differences in the genes that are translated into more or less mapped reads. Particularly, there are <em>within-sample effects</em> that are the differences between genes in the same sample, such as their <strong>length</strong> (the longer the gene, the more reads it will have) and <strong>GC content</strong>, factors that contribute to variations in their counts. On the other hand, <em>between-sample effects</em> are differences between samples such as the <strong>sequencing depth</strong>, i.e., the total number of molecules sequenced, and the <strong>library size</strong>, i.e., the total number of reads of each sample [1].</p>
<p>These variables lead to virtually different mRNA amounts but of course are not due to the biological or treatment conditions of interest (such as nicotine administration in this example) so in order to remove, or at least, to minimize this technical bias and obtain measures comparable and consistent across samples, raw counts must be normalized by these factors. The data that we’ll use in this case are already normalized in <code>assays(rse_gene)$logcounts</code>. Specifically, the assay contains counts per million (CPM), also known as reads per million (RPM), one basic gene expression unit that only normalizes by the sequencing depth and is computed by dividing the read counts of a gene in a sample by a scaling factor given by the total mapping reads of the sample per million [2]:</p>
<p><span class="math display">\[CPM = \frac{read \ \ counts \ \ of \ \ gene \ \ \times \ \ 10^6 }{Total \ \ mapping \ \ reads \ \ of \ \ sample}\]</span></p>
<p>As outlined in <strong>Data overview and download</strong>, the scaling factors were obtained with <code>calcNormFactors()</code> applying the Trimmed Mean of M-Values (TMM) method, the <em><a href="https://bioconductor.org/packages/3.17/edgeR">edgeR</a></em> package’s default normalization method that assumes that most genes are not differentially expressed. The effective library sizes of the samples and the CPM of each observation were computed with the <em><a href="https://bioconductor.org/packages/3.17/edgeR">edgeR</a></em> function <code>cpm()</code> setting the <code>log</code> argument to <code>TRUE</code> and <code>prior.count</code> to 0.5 to receive values in <span class="math inline">\(log_2(CPM+0.5)\)</span>.</p>
<p>After data normalization and scaling, we’d expect the read counts to follow a normal distribution, something we can confirm by comparing the counts’ distribution before and after the normalization. Consider both datasets contain the exact same genes.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="rse-plotting-basics-with-smokingmouse.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb39-2"><a href="rse-plotting-basics-with-smokingmouse.html#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="rse-plotting-basics-with-smokingmouse.html#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Histogram and density plot of read counts before and after normalization</span></span>
<span id="cb39-4"><a href="rse-plotting-basics-with-smokingmouse.html#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="rse-plotting-basics-with-smokingmouse.html#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Raw counts</span></span>
<span id="cb39-6"><a href="rse-plotting-basics-with-smokingmouse.html#cb39-6" aria-hidden="true" tabindex="-1"></a>counts_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">counts =</span> <span class="fu">as.vector</span>(<span class="fu">assays</span>(rse_gene_nic)<span class="sc">$</span>counts))</span>
<span id="cb39-7"><a href="rse-plotting-basics-with-smokingmouse.html#cb39-7" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(counts_data, <span class="fu">aes</span>(<span class="at">x =</span> counts)) <span class="sc">+</span></span>
<span id="cb39-8"><a href="rse-plotting-basics-with-smokingmouse.html#cb39-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;lightgray&quot;</span>) <span class="sc">+</span></span>
<span id="cb39-9"><a href="rse-plotting-basics-with-smokingmouse.html#cb39-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;read counts&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Frecuency&quot;</span>) <span class="sc">+</span></span>
<span id="cb39-10"><a href="rse-plotting-basics-with-smokingmouse.html#cb39-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>()</span>
<span id="cb39-11"><a href="rse-plotting-basics-with-smokingmouse.html#cb39-11" aria-hidden="true" tabindex="-1"></a>plot <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">4</span>), <span class="st">&quot;cm&quot;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/Data%20preparation-1.png" width="672" /></p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="rse-plotting-basics-with-smokingmouse.html#cb40-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-2"><a href="rse-plotting-basics-with-smokingmouse.html#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Normalized counts</span></span>
<span id="cb40-3"><a href="rse-plotting-basics-with-smokingmouse.html#cb40-3" aria-hidden="true" tabindex="-1"></a>logcounts_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">logcounts =</span> <span class="fu">as.vector</span>(<span class="fu">assays</span>(rse_gene_nic)<span class="sc">$</span>logcounts))</span>
<span id="cb40-4"><a href="rse-plotting-basics-with-smokingmouse.html#cb40-4" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(logcounts_data, <span class="fu">aes</span>(<span class="at">x =</span> logcounts)) <span class="sc">+</span></span>
<span id="cb40-5"><a href="rse-plotting-basics-with-smokingmouse.html#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..density..), <span class="at">colour =</span> <span class="st">&quot;darkgray&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;lightgray&quot;</span>) <span class="sc">+</span></span>
<span id="cb40-6"><a href="rse-plotting-basics-with-smokingmouse.html#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb40-7"><a href="rse-plotting-basics-with-smokingmouse.html#cb40-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">&quot;#69b3a2&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb40-8"><a href="rse-plotting-basics-with-smokingmouse.html#cb40-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;log(CPM+0.5)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Frecuency&quot;</span>)</span>
<span id="cb40-9"><a href="rse-plotting-basics-with-smokingmouse.html#cb40-9" aria-hidden="true" tabindex="-1"></a>plot <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">4</span>), <span class="st">&quot;cm&quot;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/Data%20preparation-2.png" width="672" /></p>
<p>As presented, after data transformation, we can now see a more widespread distribution of the counts, but note that most of them are zeros in the first plot (the one with the raw counts) and those zeros remain after normalization, corresponding to counts below 0 in the second plot. That is because we haven’t filtered the low and zero-expressed genes.</p>
</div>
<div id="gene-filtering" class="section level3 hasAnchor" number="6.2.2">
<h3><span class="header-section-number">6.2.2</span> Gene filtering<a href="rse-plotting-basics-with-smokingmouse.html#gene-filtering" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Lowly-expressed or non-expressed genes in many samples are not of biological interest in a study of differential expression because they don’t inform about the gene expression changes and they are, by definition, not differentially expressed, so we have to drop them using <code>filterByExpr()</code> from <em><a href="https://bioconductor.org/packages/3.17/edgeR">edgeR</a></em> that only keeps genes with at least <em>K</em> CPM in <em>n</em> samples and with a minimum total number of counts across all samples.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="rse-plotting-basics-with-smokingmouse.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Retain genes that passed filtering step</span></span>
<span id="cb41-2"><a href="rse-plotting-basics-with-smokingmouse.html#cb41-2" aria-hidden="true" tabindex="-1"></a>rse_gene_filt <span class="ot">&lt;-</span> rse_gene_nic[<span class="fu">rowData</span>(rse_gene_nic)<span class="sc">$</span>retained_after_feature_filtering <span class="sc">==</span> <span class="cn">TRUE</span>, ]</span>
<span id="cb41-3"><a href="rse-plotting-basics-with-smokingmouse.html#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="rse-plotting-basics-with-smokingmouse.html#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Normalized counts and filtered genes</span></span>
<span id="cb41-5"><a href="rse-plotting-basics-with-smokingmouse.html#cb41-5" aria-hidden="true" tabindex="-1"></a>filt_logcounts_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">logcounts =</span> <span class="fu">as.vector</span>(<span class="fu">assays</span>(rse_gene_filt)<span class="sc">$</span>logcounts))</span>
<span id="cb41-6"><a href="rse-plotting-basics-with-smokingmouse.html#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="rse-plotting-basics-with-smokingmouse.html#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot</span></span>
<span id="cb41-8"><a href="rse-plotting-basics-with-smokingmouse.html#cb41-8" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(filt_logcounts_data, <span class="fu">aes</span>(<span class="at">x =</span> logcounts)) <span class="sc">+</span></span>
<span id="cb41-9"><a href="rse-plotting-basics-with-smokingmouse.html#cb41-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..density..), <span class="at">colour =</span> <span class="st">&quot;darkgray&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;lightgray&quot;</span>) <span class="sc">+</span></span>
<span id="cb41-10"><a href="rse-plotting-basics-with-smokingmouse.html#cb41-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb41-11"><a href="rse-plotting-basics-with-smokingmouse.html#cb41-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">&quot;#69b3a2&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb41-12"><a href="rse-plotting-basics-with-smokingmouse.html#cb41-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;log(CPM+0.5)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Frecuency&quot;</span>)</span>
<span id="cb41-13"><a href="rse-plotting-basics-with-smokingmouse.html#cb41-13" aria-hidden="true" tabindex="-1"></a>plot <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">4</span>), <span class="st">&quot;cm&quot;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>In this third plot we can observe a curve that is closer (though not completely) to a normal distribution and with less lowly-expressed genes.</p>
<p>With the object <code>rse_gene_filt</code> we can proceed with downstream analyses.</p>
</div>
</div>
<div id="exploratory-data-analysis" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Exploratory Data Analysis<a href="rse-plotting-basics-with-smokingmouse.html#exploratory-data-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The first formal step that we will be performing is the sample exploration. This crucial initial part of the analysis consists of an examination of differences and relationships between Quality-Control (QC) metrics of the samples from different groups in order to identify poor-quality samples that must be removed before DEA. After that, the sample variables in the metadata also need to be analyzed and filtered based on the percentage of gene expression variance that they explain for each gene.</p>
</div>
<div id="quality-control-analysis" class="section level2 hasAnchor" number="6.4">
<h2><span class="header-section-number">6.4</span> Quality Control Analysis<a href="rse-plotting-basics-with-smokingmouse.html#quality-control-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>First we have to explore and compare the the quality-control metrics of the samples in the different groups given by covariates such as age, sex, pregnancy state, group, plate and flowcell. See <strong>Sample Information</strong> section in chapter 04 for a description of these variables.</p>
<style>
p.comment {
background-color: #E6E6E6;
padding: 10px;
border: 1px solid black;
margin-left: 25px;
border-radius: 5px;
font-family: sans-serif;
}

</style>
<p class="comment">
❓ <strong><em>Why is that relevant?</em></strong> As you could imagine, technical and methodological differences in all the steps that were carried out during the experimental stages are potential sources of variation in the quality of the samples. Just imagine all that could have been gone wrong or unexpected while experimenting with mice, during the sampling, in the RNA extraction using different batches, when treating samples in different mediums, when preparing libraries in different plates and sequencing in different flowcells. Moreover, the inherent features of the mice from which the samples come from such as age, tissue, sex and pregnancy state could also affect the samples’ metrics if, for example, they were separately analyzed and processed.
</p>
<p class="comment">
❓<strong><em>But why do we care about mitochodrial and ribosomal counts as QC metrics?</em></strong> In the process of mRNA extraction, either by mRNA enrichment (capturing polyadenilated mRNAs) or rRNA-depletion (removing rRNA), we’d expect to have a low number of ribosomal counts, i.e., counts that map to rDNA, and if we don’t, something must have gone wrong with the procedures. In the case of mitochondrial counts something similar occurs: higher mitochondrial rates will be obtained if the cytoplasmic mRNA capture was deficient or if the transcripts were lost by some technical issue, increasing the proportion of mitochondrial mRNAs. As a result, high <mark style= "background-color: #FCF3CF"> <span style="font-family: monospace"> mitoRate</span> </mark> and <mark style= "background-color: #FCF3CF"> <span style="font-family: monospace"> rRNA_rate</span> </mark> imply poor quality in the samples.
</p>
<div class="alert alert-info">
<p><strong>Note:</strong> the QC metrics were computed with the unprocessed datasets (neither filtered nor normalized) to preserve the original estimates of the samples.</p>
</div>
<div id="evaluate-qc-metrics-for-groups-of-samples" class="section level3 hasAnchor" number="6.4.1">
<h3><span class="header-section-number">6.4.1</span> Evaluate QC metrics for groups of samples<a href="rse-plotting-basics-with-smokingmouse.html#evaluate-qc-metrics-for-groups-of-samples" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Fortunately, we can identify to some extent possible factors that could have influenced on the quality of the samples, as well as isolated samples that are problematic. To do that, we will create boxplots that present the distribution of the samples’ metrics separating them by sample variables.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;Hmisc&quot;</span>)</span>
<span id="cb42-2"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;stringr&quot;</span>)</span>
<span id="cb42-3"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;cowplot&quot;</span>)</span>
<span id="cb42-4"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Define QC metrics of interest</span></span>
<span id="cb42-6"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-6" aria-hidden="true" tabindex="-1"></a>qc_metrics <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;mitoRate&quot;</span>, <span class="st">&quot;overallMapRate&quot;</span>, <span class="st">&quot;totalAssignedGene&quot;</span>, <span class="st">&quot;rRNA_rate&quot;</span>, <span class="st">&quot;sum&quot;</span>, <span class="st">&quot;detected&quot;</span>, <span class="st">&quot;ERCCsumLogErr&quot;</span>)</span>
<span id="cb42-7"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Define sample variables of interest</span></span>
<span id="cb42-9"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-9" aria-hidden="true" tabindex="-1"></a>sample_variables <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Group&quot;</span>, <span class="st">&quot;Age&quot;</span>, <span class="st">&quot;Sex&quot;</span>, <span class="st">&quot;Pregnancy&quot;</span>, <span class="st">&quot;plate&quot;</span>, <span class="st">&quot;flowcell&quot;</span>)</span>
<span id="cb42-10"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-11"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-12"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Function to create boxplots of QC metrics for groups of samples</span></span>
<span id="cb42-13"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-14"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-14" aria-hidden="true" tabindex="-1"></a>QC_boxplots <span class="ot">&lt;-</span> <span class="cf">function</span>(qc_metric, sample_var) {</span>
<span id="cb42-15"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-15" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Define sample colors depending on the sample variable</span></span>
<span id="cb42-16"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (sample_var <span class="sc">==</span> <span class="st">&quot;Group&quot;</span>) {</span>
<span id="cb42-17"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-17" aria-hidden="true" tabindex="-1"></a>        colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Control&quot;</span> <span class="ot">=</span> <span class="st">&quot;brown2&quot;</span>, <span class="st">&quot;Experimental&quot;</span> <span class="ot">=</span> <span class="st">&quot;deepskyblue3&quot;</span>)</span>
<span id="cb42-18"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-18" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (sample_var <span class="sc">==</span> <span class="st">&quot;Age&quot;</span>) {</span>
<span id="cb42-19"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-19" aria-hidden="true" tabindex="-1"></a>        colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Adult&quot;</span> <span class="ot">=</span> <span class="st">&quot;slateblue3&quot;</span>, <span class="st">&quot;Pup&quot;</span> <span class="ot">=</span> <span class="st">&quot;yellow3&quot;</span>)</span>
<span id="cb42-20"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-20" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (sample_var <span class="sc">==</span> <span class="st">&quot;Sex&quot;</span>) {</span>
<span id="cb42-21"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-21" aria-hidden="true" tabindex="-1"></a>        colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;F&quot;</span> <span class="ot">=</span> <span class="st">&quot;hotpink1&quot;</span>, <span class="st">&quot;M&quot;</span> <span class="ot">=</span> <span class="st">&quot;dodgerblue&quot;</span>)</span>
<span id="cb42-22"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-22" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (sample_var <span class="sc">==</span> <span class="st">&quot;Pregnancy&quot;</span>) {</span>
<span id="cb42-23"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-23" aria-hidden="true" tabindex="-1"></a>        colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Yes&quot;</span> <span class="ot">=</span> <span class="st">&quot;darkorchid3&quot;</span>, <span class="st">&quot;No&quot;</span> <span class="ot">=</span> <span class="st">&quot;darkolivegreen4&quot;</span>)</span>
<span id="cb42-24"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-24" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (sample_var <span class="sc">==</span> <span class="st">&quot;plate&quot;</span>) {</span>
<span id="cb42-25"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-25" aria-hidden="true" tabindex="-1"></a>        colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Plate1&quot;</span> <span class="ot">=</span> <span class="st">&quot;darkorange&quot;</span>, <span class="st">&quot;Plate2&quot;</span> <span class="ot">=</span> <span class="st">&quot;lightskyblue&quot;</span>, <span class="st">&quot;Plate3&quot;</span> <span class="ot">=</span> <span class="st">&quot;deeppink1&quot;</span>)</span>
<span id="cb42-26"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-26" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (sample_var <span class="sc">==</span> <span class="st">&quot;flowcell&quot;</span>) {</span>
<span id="cb42-27"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-27" aria-hidden="true" tabindex="-1"></a>        colors <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb42-28"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-28" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;HKCG7DSXX&quot;</span> <span class="ot">=</span> <span class="st">&quot;chartreuse2&quot;</span>, <span class="st">&quot;HKCMHDSXX&quot;</span> <span class="ot">=</span> <span class="st">&quot;magenta&quot;</span>, <span class="st">&quot;HKCNKDSXX&quot;</span> <span class="ot">=</span> <span class="st">&quot;turquoise3&quot;</span>,</span>
<span id="cb42-29"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-29" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;HKCTMDSXX&quot;</span> <span class="ot">=</span> <span class="st">&quot;tomato&quot;</span></span>
<span id="cb42-30"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-30" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb42-31"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-31" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb42-32"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-33"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-33" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Axis labels</span></span>
<span id="cb42-34"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-34" aria-hidden="true" tabindex="-1"></a>    x_label <span class="ot">&lt;-</span> <span class="fu">capitalize</span>(sample_var)</span>
<span id="cb42-35"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-35" aria-hidden="true" tabindex="-1"></a>    y_label <span class="ot">&lt;-</span> <span class="fu">str_replace_all</span>(qc_metric, <span class="fu">c</span>(<span class="st">&quot;_&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb42-36"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-37"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-37" aria-hidden="true" tabindex="-1"></a>    <span class="do">## x-axis text angle and position</span></span>
<span id="cb42-38"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (sample_var <span class="sc">==</span> <span class="st">&quot;flowcell&quot;</span>) {</span>
<span id="cb42-39"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-39" aria-hidden="true" tabindex="-1"></a>        x_axis_angle <span class="ot">&lt;-</span> <span class="dv">18</span></span>
<span id="cb42-40"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-40" aria-hidden="true" tabindex="-1"></a>        x_axis_hjust <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb42-41"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-41" aria-hidden="true" tabindex="-1"></a>        x_axis_vjust <span class="ot">&lt;-</span> <span class="fl">0.7</span></span>
<span id="cb42-42"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-42" aria-hidden="true" tabindex="-1"></a>        x_axis_size <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb42-43"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-43" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb42-44"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-44" aria-hidden="true" tabindex="-1"></a>        x_axis_angle <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb42-45"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-45" aria-hidden="true" tabindex="-1"></a>        x_axis_hjust <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb42-46"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-46" aria-hidden="true" tabindex="-1"></a>        x_axis_vjust <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb42-47"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-47" aria-hidden="true" tabindex="-1"></a>        x_axis_size <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb42-48"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-48" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb42-49"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-50"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-50" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Extract sample data in colData(rse_gene_filt)</span></span>
<span id="cb42-51"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-51" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">colData</span>(rse_gene_filt))</span>
<span id="cb42-52"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-53"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-53" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Sample variable separating samples in x-axis and QC metric in y-axis</span></span>
<span id="cb42-54"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-54" aria-hidden="true" tabindex="-1"></a>    <span class="do">## (Coloring by sample variable)</span></span>
<span id="cb42-55"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-55" aria-hidden="true" tabindex="-1"></a>    plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">!!</span>rlang<span class="sc">::</span><span class="fu">sym</span>(sample_var), <span class="at">y =</span> <span class="sc">!!</span>rlang<span class="sc">::</span><span class="fu">sym</span>(qc_metric), <span class="at">color =</span> <span class="sc">!!</span>rlang<span class="sc">::</span><span class="fu">sym</span>(sample_var))) <span class="sc">+</span></span>
<span id="cb42-56"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-56" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Add violin plots</span></span>
<span id="cb42-57"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-57" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_violin</span>(<span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="fl">0.4</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">width =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb42-58"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-58" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Spread dots</span></span>
<span id="cb42-59"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-59" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.08</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="fl">1.3</span>) <span class="sc">+</span></span>
<span id="cb42-60"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-60" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Add boxplots</span></span>
<span id="cb42-61"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-61" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_boxplot</span>(<span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="fl">0.4</span>, <span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb42-62"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-62" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Set colors</span></span>
<span id="cb42-63"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-63" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_color_manual</span>(<span class="at">values =</span> colors) <span class="sc">+</span></span>
<span id="cb42-64"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-64" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Define axis labels</span></span>
<span id="cb42-65"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-65" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">y =</span> y_label, <span class="at">x =</span> x_label) <span class="sc">+</span></span>
<span id="cb42-66"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-66" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Get rid of the background</span></span>
<span id="cb42-67"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-67" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb42-68"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-68" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Hide legend and define plot margins and size of axis title and text</span></span>
<span id="cb42-69"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-69" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(</span>
<span id="cb42-70"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-70" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb42-71"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-71" aria-hidden="true" tabindex="-1"></a>            <span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.4</span>), <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb42-72"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-72" aria-hidden="true" tabindex="-1"></a>            <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>),</span>
<span id="cb42-73"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-73" aria-hidden="true" tabindex="-1"></a>            <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> x_axis_size),</span>
<span id="cb42-74"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-74" aria-hidden="true" tabindex="-1"></a>            <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> x_axis_angle, <span class="at">hjust =</span> x_axis_hjust, <span class="at">vjust =</span> x_axis_vjust)</span>
<span id="cb42-75"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-75" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb42-76"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-77"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(plot)</span>
<span id="cb42-78"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-78" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-79"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-80"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-81"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-82"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-82" aria-hidden="true" tabindex="-1"></a><span class="do">## Plots of all QC metrics for each sample variable</span></span>
<span id="cb42-83"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-83" aria-hidden="true" tabindex="-1"></a>multiple_QC_boxplots <span class="ot">&lt;-</span> <span class="cf">function</span>(sample_var) {</span>
<span id="cb42-84"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-84" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb42-85"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-85" aria-hidden="true" tabindex="-1"></a>    plots <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb42-86"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (qc_metric <span class="cf">in</span> qc_metrics) {</span>
<span id="cb42-87"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-87" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Call function to create each individual plot</span></span>
<span id="cb42-88"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-88" aria-hidden="true" tabindex="-1"></a>        plots[[i]] <span class="ot">&lt;-</span> <span class="fu">QC_boxplots</span>(qc_metric, sample_var)</span>
<span id="cb42-89"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-89" aria-hidden="true" tabindex="-1"></a>        i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb42-90"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-90" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb42-91"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-91" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Arrange multiple plots into a grid</span></span>
<span id="cb42-92"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-92" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">plot_grid</span>(plots[[<span class="dv">1</span>]], plots[[<span class="dv">2</span>]], plots[[<span class="dv">3</span>]], plots[[<span class="dv">4</span>]], plots[[<span class="dv">5</span>]], plots[[<span class="dv">6</span>]], plots[[<span class="dv">7</span>]], <span class="at">nrow =</span> <span class="dv">2</span>))</span>
<span id="cb42-93"><a href="rse-plotting-basics-with-smokingmouse.html#cb42-93" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="rse-plotting-basics-with-smokingmouse.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">multiple_QC_boxplots</span>(<span class="st">&quot;Age&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>Initially, when we separate samples by Age, we can appreciate a clear segregation of adult and pup samples in <mark style= "background-color: #FCF3CF"> <span style="font-family: monospace"> mitoRate</span> </mark>, with higher mitochondrial rates for adult samples and thus, being lower quality samples than the pup ones. We can also see that pup samples have higher <mark style= "background-color: #FCF3CF"> <span style="font-family: monospace"> totalAssignedGene</span> </mark>, again being higher quality. The samples are very similar in the rest of the QC metrics.
The former differences must be taken into account because they guide further sample separation by Age, which is necessary to avoid dropping most of the adult samples (that are lower quality) in the <strong>QC-based sample filtering</strong> (see below) and to prevent misinterpreting sample variation given by quality and not by mouse age itself.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="rse-plotting-basics-with-smokingmouse.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">multiple_QC_boxplots</span>(<span class="st">&quot;Sex&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>With Sex, female and male samples have similar QC metrics but there are some female samples that have high <mark style= "background-color: #FCF3CF"> <span style="font-family: monospace"> mitoRate</span> </mark> and low <mark style= "background-color: #FCF3CF"> <span style="font-family: monospace"> totalAssignedGene</span> </mark>, but males don´t. That is consistent with the fact that all males are pups and as we previously observed, pup samples present better QC metrics, but since not all pups are males, some female pups also have smaller <mark style= "background-color: #FCF3CF"> <span style="font-family: monospace"> mitoRate</span> </mark> and greater <mark style= "background-color: #FCF3CF"> <span style="font-family: monospace"> totalAssignedGene</span> </mark>. So in this case samples’ differences are actually dictated by Age and not by Sex.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="rse-plotting-basics-with-smokingmouse.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">multiple_QC_boxplots</span>(<span class="st">&quot;Group&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>Notably, for Group no evident contrasts are seen in the quality of the samples, which means that both control and exposed samples have similar metrics and therefore the differences between them won’t be determined by technical factors but effectively by gene expression changes.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="rse-plotting-basics-with-smokingmouse.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">multiple_QC_boxplots</span>(<span class="st">&quot;Pregnancy&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>Pregnancy variable is interesting because pregnant dams were obviously females and adults, which we already noted are lower quality. Accordingly to that, pregnant samples present overall higher <mark style= "background-color: #FCF3CF"> <span style="font-family: monospace"> mitoRate</span> </mark> and lower <mark style= "background-color: #FCF3CF"> <span style="font-family: monospace"> totalAssignedGene</span> </mark>, <mark style= "background-color: #DFF0FE"> <span style="font-family: monospace"> sum</span> </mark> (library size) and <mark style= "background-color: #DFF0FE"> <span style="font-family: monospace"> detected</span> </mark> (number of expressed genes) than some samples coming from non-pregnant mice. However, these samples have smaller |<mark style= "background-color: #FCF3CF"> <span style="font-family: monospace"> ERCCsumLogErr</span> </mark>|, which means that they had smaller differences between expected and observed concentrations of control transcripts.</p>
<p>Notwithstanding, we must clarify one more time that as in Sex, the trends observed in Pregnancy are all given by Age: it is Age the variable that fully segregates samples in <mark style= "background-color: #FCF3CF"> <span style="font-family: monospace"> mitoRate</span> </mark> and almost completely in </mark>, lower <mark style= "background-color: #FCF3CF"> <span style="font-family: monospace"> totalAssignedGene</span> </mark>. Because all pregnant dams were adults, their metrics will be positioned where the adult samples were, but there were also not-pregnant adults that share similar QC values.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="rse-plotting-basics-with-smokingmouse.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">multiple_QC_boxplots</span>(<span class="st">&quot;plate&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>In plate, no alarming differences are presented but some samples from the 1st plate
have low (though not much lower) <mark style= "background-color: #FCF3CF"> <span style="font-family: monospace"> overallMapRate</span> </mark>, <mark style= "background-color: #FCF3CF"> <span style="font-family: monospace"> totalAssignedGene</span> </mark> and <mark style= "background-color: #DFF0FE"> <span style="font-family: monospace"> sum</span> </mark>.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="rse-plotting-basics-with-smokingmouse.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">multiple_QC_boxplots</span>(<span class="st">&quot;flowcell&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>For the flowcell, again no worrying distinctions are seen, with the exception of a few individual samples far from the rest.</p>
<p>In all the previous plots we can appreciate a group of samples placed below in <mark style= "background-color: #FCF3CF"> <span style="font-family: monospace"> mitoRate</span> </mark> that correspond to pup samples. The relationship is more fuzzy in <mark style= "background-color: #FCF3CF"> <span style="font-family: monospace"> totalAssignedGene</span> </mark>.</p>
</div>
<div id="examine-relationships-between-qc-metrics-of-samples" class="section level3 hasAnchor" number="6.4.2">
<h3><span class="header-section-number">6.4.2</span> Examine relationships between QC metrics of samples<a href="rse-plotting-basics-with-smokingmouse.html#examine-relationships-between-qc-metrics-of-samples" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Secondly, we want to analyze if there are relationships between QC variables that explain the presence of samples with two or more particular QC metrics. For that, scatterplots are useful because they enable the evaluation of pairs of samples’ QC metrics.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Scatterplots for a pair of QC metrics</span></span>
<span id="cb49-2"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-3" aria-hidden="true" tabindex="-1"></a>QC_scatterplots <span class="ot">&lt;-</span> <span class="cf">function</span>(sample_var, qc_metric1, qc_metric2) {</span>
<span id="cb49-4"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-4" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Define sample colors</span></span>
<span id="cb49-5"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (sample_var <span class="sc">==</span> <span class="st">&quot;Group&quot;</span>) {</span>
<span id="cb49-6"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-6" aria-hidden="true" tabindex="-1"></a>        colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Control&quot;</span> <span class="ot">=</span> <span class="st">&quot;brown2&quot;</span>, <span class="st">&quot;Experimental&quot;</span> <span class="ot">=</span> <span class="st">&quot;deepskyblue3&quot;</span>)</span>
<span id="cb49-7"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-7" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (sample_var <span class="sc">==</span> <span class="st">&quot;Age&quot;</span>) {</span>
<span id="cb49-8"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-8" aria-hidden="true" tabindex="-1"></a>        colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Adult&quot;</span> <span class="ot">=</span> <span class="st">&quot;slateblue3&quot;</span>, <span class="st">&quot;Pup&quot;</span> <span class="ot">=</span> <span class="st">&quot;yellow3&quot;</span>)</span>
<span id="cb49-9"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-9" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (sample_var <span class="sc">==</span> <span class="st">&quot;Sex&quot;</span>) {</span>
<span id="cb49-10"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-10" aria-hidden="true" tabindex="-1"></a>        colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;F&quot;</span> <span class="ot">=</span> <span class="st">&quot;hotpink1&quot;</span>, <span class="st">&quot;M&quot;</span> <span class="ot">=</span> <span class="st">&quot;dodgerblue&quot;</span>)</span>
<span id="cb49-11"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-11" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (sample_var <span class="sc">==</span> <span class="st">&quot;Pregnancy&quot;</span>) {</span>
<span id="cb49-12"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-12" aria-hidden="true" tabindex="-1"></a>        colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Yes&quot;</span> <span class="ot">=</span> <span class="st">&quot;darkorchid3&quot;</span>, <span class="st">&quot;No&quot;</span> <span class="ot">=</span> <span class="st">&quot;darkolivegreen4&quot;</span>)</span>
<span id="cb49-13"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-13" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (sample_var <span class="sc">==</span> <span class="st">&quot;plate&quot;</span>) {</span>
<span id="cb49-14"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-14" aria-hidden="true" tabindex="-1"></a>        colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Plate1&quot;</span> <span class="ot">=</span> <span class="st">&quot;darkorange&quot;</span>, <span class="st">&quot;Plate2&quot;</span> <span class="ot">=</span> <span class="st">&quot;lightskyblue&quot;</span>, <span class="st">&quot;Plate3&quot;</span> <span class="ot">=</span> <span class="st">&quot;deeppink1&quot;</span>)</span>
<span id="cb49-15"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-15" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (sample_var <span class="sc">==</span> <span class="st">&quot;flowcell&quot;</span>) {</span>
<span id="cb49-16"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-16" aria-hidden="true" tabindex="-1"></a>        colors <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb49-17"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;HKCG7DSXX&quot;</span> <span class="ot">=</span> <span class="st">&quot;chartreuse2&quot;</span>, <span class="st">&quot;HKCMHDSXX&quot;</span> <span class="ot">=</span> <span class="st">&quot;magenta&quot;</span>, <span class="st">&quot;HKCNKDSXX&quot;</span> <span class="ot">=</span> <span class="st">&quot;turquoise3&quot;</span>,</span>
<span id="cb49-18"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;HKCTMDSXX&quot;</span> <span class="ot">=</span> <span class="st">&quot;tomato&quot;</span></span>
<span id="cb49-19"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-19" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb49-20"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb49-21"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-22"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-22" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">colData</span>(rse_gene_filt)</span>
<span id="cb49-23"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-24"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-24" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Scatterplots for continuous variable vs continuous variable</span></span>
<span id="cb49-25"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-25" aria-hidden="true" tabindex="-1"></a>    <span class="do">## First QC metric in x-axis and second QC metric in y-axis</span></span>
<span id="cb49-26"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-26" aria-hidden="true" tabindex="-1"></a>    plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">as.data.frame</span>(data), <span class="fu">aes</span>(</span>
<span id="cb49-27"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="sc">!!</span>rlang<span class="sc">::</span><span class="fu">sym</span>(qc_metric1),</span>
<span id="cb49-28"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="sc">!!</span>rlang<span class="sc">::</span><span class="fu">sym</span>(qc_metric2),</span>
<span id="cb49-29"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-29" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Color samples by a variable</span></span>
<span id="cb49-30"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="sc">!!</span>rlang<span class="sc">::</span><span class="fu">sym</span>(sample_var)</span>
<span id="cb49-31"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-31" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">+</span></span>
<span id="cb49-32"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-32" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Add scatterplot</span></span>
<span id="cb49-33"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-33" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb49-34"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-34" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Add regression line</span></span>
<span id="cb49-35"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-35" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stat_smooth</span>(<span class="at">geom =</span> <span class="st">&quot;line&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">size =</span> <span class="fl">0.4</span>, <span class="at">span =</span> <span class="fl">0.25</span>, <span class="at">method =</span> lm, <span class="at">color =</span> <span class="st">&quot;orangered3&quot;</span>) <span class="sc">+</span></span>
<span id="cb49-36"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-36" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Colors</span></span>
<span id="cb49-37"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-37" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_color_manual</span>(<span class="at">name =</span> sample_var, <span class="at">values =</span> colors) <span class="sc">+</span></span>
<span id="cb49-38"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-38" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb49-39"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-39" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Add Pearson correlation coefficient between the metrics as subtitle</span></span>
<span id="cb49-40"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-40" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(</span>
<span id="cb49-41"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-41" aria-hidden="true" tabindex="-1"></a>            <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">&quot;Corr: &quot;</span>, <span class="fu">signif</span>(<span class="fu">cor</span>(data[, qc_metric1], data[, qc_metric2], <span class="at">method =</span> <span class="st">&quot;pearson&quot;</span>), <span class="at">digits =</span> <span class="dv">3</span>)),</span>
<span id="cb49-42"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-42" aria-hidden="true" tabindex="-1"></a>            <span class="do">## Add axis labels</span></span>
<span id="cb49-43"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-43" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="fu">gsub</span>(<span class="st">&quot;_&quot;</span>, <span class="st">&quot; &quot;</span>, qc_metric2),</span>
<span id="cb49-44"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-44" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> <span class="fu">gsub</span>(<span class="st">&quot;_&quot;</span>, <span class="st">&quot; &quot;</span>, qc_metric1)</span>
<span id="cb49-45"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-45" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb49-46"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-46" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Plot margins and text size</span></span>
<span id="cb49-47"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-47" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(</span>
<span id="cb49-48"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-48" aria-hidden="true" tabindex="-1"></a>            <span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">1.2</span>, <span class="fl">0.1</span>, <span class="fl">1.2</span>), <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb49-49"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-49" aria-hidden="true" tabindex="-1"></a>            <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> (<span class="dv">7</span>)),</span>
<span id="cb49-50"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-50" aria-hidden="true" tabindex="-1"></a>            <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> (<span class="dv">6</span>)),</span>
<span id="cb49-51"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-51" aria-hidden="true" tabindex="-1"></a>            <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> <span class="st">&quot;gray40&quot;</span>),</span>
<span id="cb49-52"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-52" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>),</span>
<span id="cb49-53"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-53" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>)</span>
<span id="cb49-54"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-54" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb49-55"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(plot)</span>
<span id="cb49-56"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-56" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb49-57"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-58"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-59"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-60"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-60" aria-hidden="true" tabindex="-1"></a><span class="do">## QC scatterplots coloring by all sample variables</span></span>
<span id="cb49-61"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-61" aria-hidden="true" tabindex="-1"></a>multiple_QC_scatterplots <span class="ot">&lt;-</span> <span class="cf">function</span>(qc_metric1, qc_metric2) {</span>
<span id="cb49-62"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-62" aria-hidden="true" tabindex="-1"></a>    sample_variables <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Age&quot;</span>, <span class="st">&quot;Sex&quot;</span>, <span class="st">&quot;plate&quot;</span>, <span class="st">&quot;Pregnancy&quot;</span>, <span class="st">&quot;Group&quot;</span>, <span class="st">&quot;flowcell&quot;</span>)</span>
<span id="cb49-63"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-64"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-64" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb49-65"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-65" aria-hidden="true" tabindex="-1"></a>    plots <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb49-66"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (sample_var <span class="cf">in</span> sample_variables) {</span>
<span id="cb49-67"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-67" aria-hidden="true" tabindex="-1"></a>        plots[[i]] <span class="ot">&lt;-</span> <span class="fu">QC_scatterplots</span>(sample_var, qc_metric1, qc_metric2)</span>
<span id="cb49-68"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-68" aria-hidden="true" tabindex="-1"></a>        i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb49-69"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-69" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb49-70"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_grid</span>(plots[[<span class="dv">1</span>]], plots[[<span class="dv">2</span>]], plots[[<span class="dv">3</span>]], plots[[<span class="dv">4</span>]], plots[[<span class="dv">5</span>]], plots[[<span class="dv">6</span>]], <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb49-71"><a href="rse-plotting-basics-with-smokingmouse.html#cb49-71" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="rse-plotting-basics-with-smokingmouse.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">multiple_QC_scatterplots</span>(<span class="st">&quot;mitoRate&quot;</span>, <span class="st">&quot;rRNA_rate&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>For <mark style= "background-color: #FCF3CF"> <span style="font-family: monospace"> mitoRate</span> </mark> vs <mark style= "background-color: #FCF3CF"> <span style="font-family: monospace"> rRNA_rate</span> </mark> plots there’s a negligible positive correlation which was anticipated since no obvious relationship exists between them, though if cytoplasmic mRNAs weren’t well captured (lowering the total number of mapping reads) we could expect an increase in both mitochondrial and ribosomal rates.</p>
<p>Note the complete separation of samples in <mark style= "background-color: #FCF3CF"> <span style="font-family: monospace"> mitoRate</span> </mark> (but not in <mark style= "background-color: #FCF3CF"> <span style="font-family: monospace"> rRNA_rate</span> </mark>) by Age, which in turn causes the grouping of male samples (all pups).</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="rse-plotting-basics-with-smokingmouse.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">multiple_QC_scatterplots</span>(<span class="st">&quot;mitoRate&quot;</span>, <span class="st">&quot;totalAssignedGene&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>Forcefully, <mark style= "background-color: #FCF3CF"> <span style="font-family: monospace"> mitoRate</span> </mark> and <mark style= "background-color: #FCF3CF"> <span style="font-family: monospace"> totalAssignedGene</span> </mark> have a strong negative correlation, which reveals the existence of very bad quality samples (with small <mark style= "background-color: #FCF3CF"> <span style="font-family: monospace"> totalAssignedGene</span> </mark> and high <mark style= "background-color: #FCF3CF"> <span style="font-family: monospace"> mitoRate</span> </mark>).</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="rse-plotting-basics-with-smokingmouse.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">multiple_QC_scatterplots</span>(<span class="st">&quot;sum&quot;</span>, <span class="st">&quot;detected&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>Noticeably, a positive correlation is present for <mark style= "background-color: #DFF0FE"> <span style="font-family: monospace"> sum</span> </mark> and <mark style= "background-color: #DFF0FE"> <span style="font-family: monospace"> detected</span> </mark> and that is also congruent because a higher number of expressed-genes implies bigger library sizes, but that is not necessarily true in the other way around: just a few highly expressed genes (small number of <mark style= "background-color: #DFF0FE"> <span style="font-family: monospace"> detected</span> </mark> genes) could increase the library size. Interestingly, in this case samples are diagonally separated by age.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="rse-plotting-basics-with-smokingmouse.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">multiple_QC_scatterplots</span>(<span class="st">&quot;sum&quot;</span>, <span class="st">&quot;totalAssignedGene&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>Contrary to expectations, <mark style= "background-color: #DFF0FE"> <span style="font-family: monospace"> sum</span> </mark> is not correlated to <mark style= "background-color: #FCF3CF"> <span style="font-family: monospace"> totalAssignedGene</span> </mark> and this is unexpected because higher proportions of genes’ reads could initially increase library size. However, since <mark style= "background-color: #FCF3CF"> <span style="font-family: monospace"> totalAssignedGene</span> </mark> is a fraction of the total reads, it could be that a high fraction of reads mapping to genes reflects a small number of total reads and does not necessarily imply more expressed genes (and therefore bigger libraries). In other words, even when <mark style= "background-color: #FCF3CF"> <span style="font-family: monospace"> totalAssignedGene</span> </mark> equals 1, if the total number of reads is small, the genes won’t be widely covered by them and the libraries won’t be sizeable. Observe the separarion of samples by Age.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="rse-plotting-basics-with-smokingmouse.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">multiple_QC_scatterplots</span>(<span class="st">&quot;detected&quot;</span>, <span class="st">&quot;totalAssignedGene&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>Lastly, there’s a slight positive correlation between <mark style= "background-color: #FCF3CF"> <span style="font-family: monospace"> totalAssignedGene</span> </mark> and <mark style= "background-color: #DFF0FE"> <span style="font-family: monospace"> detected</span> </mark>, which makes sense because reads assigned to genes rise the number of non-zero expressed genes but as mentioned, those genes are not necessarily highly expressed and thus, library sizes are not perforce so much bigger. Also note that the correlation wouldn’t be conserved within pup samples.</p>
<style>
p.exercise  {
background-color: #E4EDE2;
padding: 10px;
border: 1px solid black;
border-radius: 10px;
font-family: sans-serif;
}

</style>
<p class="exercise">
📑 <strong>Exercise 1</strong>: What’s the correlation between <mark style= "background-color: #DFF0FE"> <span style="font-family: monospace"> subsets_Mito_sum</span> </mark> and <mark style= "background-color: #FCF3CF"> <span style="font-family: monospace"> mitoMapped</span> </mark>? What factor could explain that correlation? Why are <mark style= "background-color: #FCF3CF"> <span style="font-family: monospace"> mitoMapped</span> </mark> numbers bigger than <mark style= "background-color: #DFF0FE"> <span style="font-family: monospace"> subsets_Mito_sum</span> </mark> values?
</p>
<p>Remarkably, samples were not differentiated by any other variable (including Group!) but the differences between adult and pup metrics suggest that they must be splitted into two different groups for the following analyses.</p>
</div>
<div id="qc-sample-filtering" class="section level3 hasAnchor" number="6.4.3">
<h3><span class="header-section-number">6.4.3</span> QC sample filtering<a href="rse-plotting-basics-with-smokingmouse.html#qc-sample-filtering" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>After assessing how different or similar are the QC values between samples, we can now proceed to sample filtering based precisely, on these metrics. For that, we will use <code>isOutlier()</code> from <em><a href="https://bioconductor.org/packages/3.17/scater">scater</a></em> to identify outlier samples only at the lower end or the higher end, depending on the QC metric.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;scater&quot;</span>)</span>
<span id="cb55-2"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;rlang&quot;</span>)</span>
<span id="cb55-3"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;ggrepel&quot;</span>)</span>
<span id="cb55-4"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Separate data by Age</span></span>
<span id="cb55-6"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-6" aria-hidden="true" tabindex="-1"></a>rse_gene_pups <span class="ot">&lt;-</span> rse_gene_filt[, <span class="fu">which</span>(rse_gene_filt<span class="sc">$</span>Age <span class="sc">==</span> <span class="st">&quot;Pup&quot;</span>)]</span>
<span id="cb55-7"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-7" aria-hidden="true" tabindex="-1"></a>rse_gene_adults <span class="ot">&lt;-</span> rse_gene_filt[, <span class="fu">which</span>(rse_gene_filt<span class="sc">$</span>Age <span class="sc">==</span> <span class="st">&quot;Adult&quot;</span>)]</span>
<span id="cb55-8"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-9"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-10"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Find outlier samples based on their QC metrics (samples that are 3 median-absolute-deviations away from the median)</span></span>
<span id="cb55-11"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-12"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-13"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-13" aria-hidden="true" tabindex="-1"></a><span class="do">## Filter all samples together</span></span>
<span id="cb55-14"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-15"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-15" aria-hidden="true" tabindex="-1"></a><span class="do">## Drop samples with lower library sizes (sum), detected number of genes and totalAssignedGene</span></span>
<span id="cb55-16"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-16" aria-hidden="true" tabindex="-1"></a>outliers_library_size <span class="ot">&lt;-</span> <span class="fu">isOutlier</span>(rse_gene_filt<span class="sc">$</span>sum, <span class="at">nmads =</span> <span class="dv">3</span>, <span class="at">type =</span> <span class="st">&quot;lower&quot;</span>)</span>
<span id="cb55-17"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-17" aria-hidden="true" tabindex="-1"></a>outliers_detected_num <span class="ot">&lt;-</span> <span class="fu">isOutlier</span>(rse_gene_filt<span class="sc">$</span>detected, <span class="at">nmads =</span> <span class="dv">3</span>, <span class="at">type =</span> <span class="st">&quot;lower&quot;</span>)</span>
<span id="cb55-18"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-18" aria-hidden="true" tabindex="-1"></a>outliers_totalAssignedGene <span class="ot">&lt;-</span> <span class="fu">isOutlier</span>(rse_gene_filt<span class="sc">$</span>totalAssignedGene, <span class="at">nmads =</span> <span class="dv">3</span>, <span class="at">type =</span> <span class="st">&quot;lower&quot;</span>)</span>
<span id="cb55-19"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-19" aria-hidden="true" tabindex="-1"></a><span class="do">## Drop samples with higher mitoRates and rRNA rates</span></span>
<span id="cb55-20"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-20" aria-hidden="true" tabindex="-1"></a>outliers_mito <span class="ot">&lt;-</span> <span class="fu">isOutlier</span>(rse_gene_filt<span class="sc">$</span>mitoRate, <span class="at">nmads =</span> <span class="dv">3</span>, <span class="at">type =</span> <span class="st">&quot;higher&quot;</span>)</span>
<span id="cb55-21"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-21" aria-hidden="true" tabindex="-1"></a>outliers_rRNArate <span class="ot">&lt;-</span> <span class="fu">isOutlier</span>(rse_gene_filt<span class="sc">$</span>rRNA_rate, <span class="at">nmads =</span> <span class="dv">3</span>, <span class="at">type =</span> <span class="st">&quot;higher&quot;</span>)</span>
<span id="cb55-22"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-23"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-23" aria-hidden="true" tabindex="-1"></a><span class="do">## Keep not outlier samples</span></span>
<span id="cb55-24"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-24" aria-hidden="true" tabindex="-1"></a>not_outliers <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="sc">!</span>(outliers_library_size <span class="sc">|</span> outliers_detected_num <span class="sc">|</span> outliers_totalAssignedGene <span class="sc">|</span> outliers_mito <span class="sc">|</span> outliers_rRNArate))</span>
<span id="cb55-25"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-25" aria-hidden="true" tabindex="-1"></a>rse_gene_qc <span class="ot">&lt;-</span> rse_gene_filt[, not_outliers]</span>
<span id="cb55-26"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-27"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-27" aria-hidden="true" tabindex="-1"></a><span class="do">## Number of samples retained</span></span>
<span id="cb55-28"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-28" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(rse_gene_qc)[<span class="dv">2</span>]</span>
<span id="cb55-29"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 39</span></span>
<span id="cb55-30"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-31"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-31" aria-hidden="true" tabindex="-1"></a><span class="do">## Add new variables to rse_gene_filt with info of samples retained/dropped</span></span>
<span id="cb55-32"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-32" aria-hidden="true" tabindex="-1"></a>rse_gene_filt<span class="sc">$</span>Retention_after_QC_filtering <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">sapply</span>(rse_gene_filt<span class="sc">$</span>SAMPLE_ID, <span class="cf">function</span>(x) {</span>
<span id="cb55-33"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (x <span class="sc">%in%</span> rse_gene_qc<span class="sc">$</span>SAMPLE_ID) {</span>
<span id="cb55-34"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-34" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Retained&quot;</span></span>
<span id="cb55-35"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-35" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb55-36"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Dropped&quot;</span></span>
<span id="cb55-37"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-37" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb55-38"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-38" aria-hidden="true" tabindex="-1"></a>}))</span>
<span id="cb55-39"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-40"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-41"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-42"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-42" aria-hidden="true" tabindex="-1"></a><span class="do">## Filter adult samples</span></span>
<span id="cb55-43"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-44"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-44" aria-hidden="true" tabindex="-1"></a>outliers_library_size <span class="ot">&lt;-</span> <span class="fu">isOutlier</span>(rse_gene_adults<span class="sc">$</span>sum, <span class="at">nmads =</span> <span class="dv">3</span>, <span class="at">type =</span> <span class="st">&quot;lower&quot;</span>)</span>
<span id="cb55-45"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-45" aria-hidden="true" tabindex="-1"></a>outliers_detected_num <span class="ot">&lt;-</span> <span class="fu">isOutlier</span>(rse_gene_adults<span class="sc">$</span>detected, <span class="at">nmads =</span> <span class="dv">3</span>, <span class="at">type =</span> <span class="st">&quot;lower&quot;</span>)</span>
<span id="cb55-46"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-46" aria-hidden="true" tabindex="-1"></a>outliers_totalAssignedGene <span class="ot">&lt;-</span> <span class="fu">isOutlier</span>(rse_gene_adults<span class="sc">$</span>totalAssignedGene, <span class="at">nmads =</span> <span class="dv">3</span>, <span class="at">type =</span> <span class="st">&quot;lower&quot;</span>)</span>
<span id="cb55-47"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-47" aria-hidden="true" tabindex="-1"></a>outliers_mito <span class="ot">&lt;-</span> <span class="fu">isOutlier</span>(rse_gene_adults<span class="sc">$</span>mitoRate, <span class="at">nmads =</span> <span class="dv">3</span>, <span class="at">type =</span> <span class="st">&quot;higher&quot;</span>)</span>
<span id="cb55-48"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-48" aria-hidden="true" tabindex="-1"></a>outliers_rRNArate <span class="ot">&lt;-</span> <span class="fu">isOutlier</span>(rse_gene_adults<span class="sc">$</span>rRNA_rate, <span class="at">nmads =</span> <span class="dv">3</span>, <span class="at">type =</span> <span class="st">&quot;higher&quot;</span>)</span>
<span id="cb55-49"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-50"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-50" aria-hidden="true" tabindex="-1"></a>not_outliers <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="sc">!</span>(outliers_library_size <span class="sc">|</span> outliers_detected_num <span class="sc">|</span> outliers_totalAssignedGene <span class="sc">|</span> outliers_mito <span class="sc">|</span> outliers_rRNArate))</span>
<span id="cb55-51"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-51" aria-hidden="true" tabindex="-1"></a>rse_gene_adults_qc <span class="ot">&lt;-</span> rse_gene_adults[, not_outliers]</span>
<span id="cb55-52"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-53"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-53" aria-hidden="true" tabindex="-1"></a><span class="do">## Number of samples retained</span></span>
<span id="cb55-54"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-54" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(rse_gene_adults_qc)[<span class="dv">2</span>]</span>
<span id="cb55-55"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 20</span></span>
<span id="cb55-56"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-57"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-57" aria-hidden="true" tabindex="-1"></a>rse_gene_adults<span class="sc">$</span>Retention_after_QC_filtering <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">sapply</span>(rse_gene_adults<span class="sc">$</span>SAMPLE_ID, <span class="cf">function</span>(x) {</span>
<span id="cb55-58"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (x <span class="sc">%in%</span> rse_gene_adults_qc<span class="sc">$</span>SAMPLE_ID) {</span>
<span id="cb55-59"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-59" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Retained&quot;</span></span>
<span id="cb55-60"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-60" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb55-61"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-61" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Dropped&quot;</span></span>
<span id="cb55-62"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-62" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb55-63"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-63" aria-hidden="true" tabindex="-1"></a>}))</span>
<span id="cb55-64"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-65"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-66"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-67"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-67" aria-hidden="true" tabindex="-1"></a><span class="do">## Filter pup samples</span></span>
<span id="cb55-68"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-69"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-69" aria-hidden="true" tabindex="-1"></a>outliers_library_size <span class="ot">&lt;-</span> <span class="fu">isOutlier</span>(rse_gene_pups<span class="sc">$</span>sum, <span class="at">nmads =</span> <span class="dv">3</span>, <span class="at">type =</span> <span class="st">&quot;lower&quot;</span>)</span>
<span id="cb55-70"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-70" aria-hidden="true" tabindex="-1"></a>outliers_detected_num <span class="ot">&lt;-</span> <span class="fu">isOutlier</span>(rse_gene_pups<span class="sc">$</span>detected, <span class="at">nmads =</span> <span class="dv">3</span>, <span class="at">type =</span> <span class="st">&quot;lower&quot;</span>)</span>
<span id="cb55-71"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-71" aria-hidden="true" tabindex="-1"></a>outliers_totalAssignedGene <span class="ot">&lt;-</span> <span class="fu">isOutlier</span>(rse_gene_pups<span class="sc">$</span>totalAssignedGene, <span class="at">nmads =</span> <span class="dv">3</span>, <span class="at">type =</span> <span class="st">&quot;lower&quot;</span>)</span>
<span id="cb55-72"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-72" aria-hidden="true" tabindex="-1"></a>outliers_mito <span class="ot">&lt;-</span> <span class="fu">isOutlier</span>(rse_gene_pups<span class="sc">$</span>mitoRate, <span class="at">nmads =</span> <span class="dv">3</span>, <span class="at">type =</span> <span class="st">&quot;higher&quot;</span>)</span>
<span id="cb55-73"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-73" aria-hidden="true" tabindex="-1"></a>outliers_rRNArate <span class="ot">&lt;-</span> <span class="fu">isOutlier</span>(rse_gene_pups<span class="sc">$</span>rRNA_rate, <span class="at">nmads =</span> <span class="dv">3</span>, <span class="at">type =</span> <span class="st">&quot;higher&quot;</span>)</span>
<span id="cb55-74"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-75"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-75" aria-hidden="true" tabindex="-1"></a>not_outliers <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="sc">!</span>(outliers_library_size <span class="sc">|</span> outliers_detected_num <span class="sc">|</span> outliers_totalAssignedGene <span class="sc">|</span> outliers_mito <span class="sc">|</span> outliers_rRNArate))</span>
<span id="cb55-76"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-76" aria-hidden="true" tabindex="-1"></a>rse_gene_pups_qc <span class="ot">&lt;-</span> rse_gene_pups[, not_outliers]</span>
<span id="cb55-77"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-78"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-78" aria-hidden="true" tabindex="-1"></a><span class="do">## Number of samples retained</span></span>
<span id="cb55-79"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-79" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(rse_gene_pups_qc)[<span class="dv">2</span>]</span>
<span id="cb55-80"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-80" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 41</span></span>
<span id="cb55-81"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-82"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-82" aria-hidden="true" tabindex="-1"></a>rse_gene_pups<span class="sc">$</span>Retention_after_QC_filtering <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">sapply</span>(rse_gene_pups<span class="sc">$</span>SAMPLE_ID, <span class="cf">function</span>(x) {</span>
<span id="cb55-83"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-83" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (x <span class="sc">%in%</span> rse_gene_pups_qc<span class="sc">$</span>SAMPLE_ID) {</span>
<span id="cb55-84"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-84" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Retained&quot;</span></span>
<span id="cb55-85"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-85" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb55-86"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-86" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Dropped&quot;</span></span>
<span id="cb55-87"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-87" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb55-88"><a href="rse-plotting-basics-with-smokingmouse.html#cb55-88" aria-hidden="true" tabindex="-1"></a>}))</span></code></pre></div>
<p>We already filtered outlier samples … but what have we removed?
It is always important to trace the QC metrics of the filtered samples to verify that they really are poor quality. We don’t want to get rid of useful samples! So let’s go back to the QC boxplots but now color samples according to whether they passed or not the filtering step and also distinguishing samples’ groups by shape.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Boxplots of QC metrics after sample filtering</span></span>
<span id="cb56-2"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Boxplots</span></span>
<span id="cb56-4"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-4" aria-hidden="true" tabindex="-1"></a>boxplots_after_QC_filtering <span class="ot">&lt;-</span> <span class="cf">function</span>(rse_gene, qc_metric, sample_var) {</span>
<span id="cb56-5"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-5" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Color samples</span></span>
<span id="cb56-6"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-6" aria-hidden="true" tabindex="-1"></a>    colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Retained&quot;</span> <span class="ot">=</span> <span class="st">&quot;deepskyblue&quot;</span>, <span class="st">&quot;Dropped&quot;</span> <span class="ot">=</span> <span class="st">&quot;brown2&quot;</span>)</span>
<span id="cb56-7"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-8"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-8" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Sample shape by sample variables</span></span>
<span id="cb56-9"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (sample_var <span class="sc">==</span> <span class="st">&quot;Group&quot;</span>) {</span>
<span id="cb56-10"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-10" aria-hidden="true" tabindex="-1"></a>        shapes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Control&quot;</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">&quot;Experimental&quot;</span> <span class="ot">=</span> <span class="dv">15</span>)</span>
<span id="cb56-11"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-11" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (sample_var <span class="sc">==</span> <span class="st">&quot;Age&quot;</span>) {</span>
<span id="cb56-12"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-12" aria-hidden="true" tabindex="-1"></a>        shapes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Adult&quot;</span> <span class="ot">=</span> <span class="dv">16</span>, <span class="st">&quot;Pup&quot;</span> <span class="ot">=</span> <span class="dv">1</span>)</span>
<span id="cb56-13"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-13" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (sample_var <span class="sc">==</span> <span class="st">&quot;Sex&quot;</span>) {</span>
<span id="cb56-14"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-14" aria-hidden="true" tabindex="-1"></a>        shapes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;F&quot;</span> <span class="ot">=</span> <span class="dv">11</span>, <span class="st">&quot;M&quot;</span> <span class="ot">=</span> <span class="dv">19</span>)</span>
<span id="cb56-15"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-15" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (sample_var <span class="sc">==</span> <span class="st">&quot;Pregnancy&quot;</span>) {</span>
<span id="cb56-16"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-16" aria-hidden="true" tabindex="-1"></a>        shapes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Yes&quot;</span> <span class="ot">=</span> <span class="dv">10</span>, <span class="st">&quot;No&quot;</span> <span class="ot">=</span> <span class="dv">1</span>)</span>
<span id="cb56-17"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-17" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (sample_var <span class="sc">==</span> <span class="st">&quot;plate&quot;</span>) {</span>
<span id="cb56-18"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-18" aria-hidden="true" tabindex="-1"></a>        shapes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Plate1&quot;</span> <span class="ot">=</span> <span class="dv">12</span>, <span class="st">&quot;Plate2&quot;</span> <span class="ot">=</span> <span class="dv">5</span>, <span class="st">&quot;Plate3&quot;</span> <span class="ot">=</span> <span class="dv">4</span>)</span>
<span id="cb56-19"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-19" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (sample_var <span class="sc">==</span> <span class="st">&quot;flowcell&quot;</span>) {</span>
<span id="cb56-20"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-20" aria-hidden="true" tabindex="-1"></a>        shapes <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb56-21"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;HKCG7DSXX&quot;</span> <span class="ot">=</span> <span class="dv">3</span>, <span class="st">&quot;HKCMHDSXX&quot;</span> <span class="ot">=</span> <span class="dv">8</span>, <span class="st">&quot;HKCNKDSXX&quot;</span> <span class="ot">=</span> <span class="dv">14</span>,</span>
<span id="cb56-22"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;HKCTMDSXX&quot;</span> <span class="ot">=</span> <span class="dv">17</span></span>
<span id="cb56-23"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-23" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb56-24"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb56-25"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-26"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-26" aria-hidden="true" tabindex="-1"></a>    y_label <span class="ot">&lt;-</span> <span class="fu">str_replace_all</span>(qc_metric, <span class="fu">c</span>(<span class="st">&quot;_&quot;</span> <span class="ot">=</span> <span class="st">&quot; &quot;</span>))</span>
<span id="cb56-27"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-28"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-28" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">colData</span>(rse_gene))</span>
<span id="cb56-29"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-30"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-30" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Median of the QC var values</span></span>
<span id="cb56-31"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-31" aria-hidden="true" tabindex="-1"></a>    median <span class="ot">&lt;-</span> <span class="fu">median</span>(<span class="fu">eval</span>(<span class="fu">parse_expr</span>(<span class="fu">paste</span>(<span class="st">&quot;rse_gene$&quot;</span>, qc_metric, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>))))</span>
<span id="cb56-32"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-32" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Median-absolute-deviation of the QC var values</span></span>
<span id="cb56-33"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-33" aria-hidden="true" tabindex="-1"></a>    mad <span class="ot">&lt;-</span> <span class="fu">mad</span>(<span class="fu">eval</span>(<span class="fu">parse_expr</span>(<span class="fu">paste</span>(<span class="st">&quot;rse_gene$&quot;</span>, qc_metric, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>))))</span>
<span id="cb56-34"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-35"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-35" aria-hidden="true" tabindex="-1"></a>    plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb56-36"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="sc">!!</span>rlang<span class="sc">::</span><span class="fu">sym</span>(qc_metric),</span>
<span id="cb56-37"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="sc">!!</span>rlang<span class="sc">::</span><span class="fu">sym</span>(<span class="st">&quot;Retention_after_QC_filtering&quot;</span>)</span>
<span id="cb56-38"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-38" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">+</span></span>
<span id="cb56-39"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-39" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="fu">aes</span>(<span class="at">shape =</span> <span class="fu">eval</span>(<span class="fu">parse_expr</span>((sample_var))))) <span class="sc">+</span></span>
<span id="cb56-40"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-40" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_boxplot</span>(<span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="fl">0.15</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb56-41"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-41" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_color_manual</span>(<span class="at">values =</span> colors) <span class="sc">+</span></span>
<span id="cb56-42"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-42" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> shapes) <span class="sc">+</span></span>
<span id="cb56-43"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-43" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> y_label, <span class="at">color =</span> <span class="st">&quot;Retention after QC filtering&quot;</span>, <span class="at">shape =</span> sample_var) <span class="sc">+</span></span>
<span id="cb56-44"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-44" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb56-45"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-45" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Median line</span></span>
<span id="cb56-46"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-46" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> median, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb56-47"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-47" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Line of median + 3 MADs</span></span>
<span id="cb56-48"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-48" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> median <span class="sc">+</span> (<span class="dv">3</span> <span class="sc">*</span> mad), <span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb56-49"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-49" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Line of median - 3 MADs</span></span>
<span id="cb56-50"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-50" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> median <span class="sc">-</span> (<span class="dv">3</span> <span class="sc">*</span> mad), <span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb56-51"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-51" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(</span>
<span id="cb56-52"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-52" aria-hidden="true" tabindex="-1"></a>            <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> (<span class="dv">9</span>)),</span>
<span id="cb56-53"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-53" aria-hidden="true" tabindex="-1"></a>            <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> (<span class="dv">8</span>)),</span>
<span id="cb56-54"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-54" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.position =</span> <span class="st">&quot;right&quot;</span>,</span>
<span id="cb56-55"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-55" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb56-56"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-56" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>)</span>
<span id="cb56-57"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-57" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb56-58"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-59"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(plot)</span>
<span id="cb56-60"><a href="rse-plotting-basics-with-smokingmouse.html#cb56-60" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>In the following plot we can confirm that taking all samples together (both adults and pups) all adult samples are dropped by their high <mark style= "background-color: #FCF3CF"> <span style="font-family: monospace"> mitoRate</span> </mark>, but that is not desirable because we want to analyze these samples too, so we need to analyze pup and adult samples separately.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="rse-plotting-basics-with-smokingmouse.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Plots</span></span>
<span id="cb57-2"><a href="rse-plotting-basics-with-smokingmouse.html#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="rse-plotting-basics-with-smokingmouse.html#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="do">## All samples together</span></span>
<span id="cb57-4"><a href="rse-plotting-basics-with-smokingmouse.html#cb57-4" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">boxplots_after_QC_filtering</span>(rse_gene_filt, <span class="st">&quot;mitoRate&quot;</span>, <span class="st">&quot;Age&quot;</span>)</span>
<span id="cb57-5"><a href="rse-plotting-basics-with-smokingmouse.html#cb57-5" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">4</span>), <span class="st">&quot;cm&quot;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<p>For adults, only 3 controls are dropped, 3 of them by their <mark style= "background-color: #FCF3CF"> <span style="font-family: monospace"> mitoRate</span> </mark>.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="rse-plotting-basics-with-smokingmouse.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Adult samples</span></span>
<span id="cb58-2"><a href="rse-plotting-basics-with-smokingmouse.html#cb58-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">boxplots_after_QC_filtering</span>(rse_gene_adults, <span class="st">&quot;mitoRate&quot;</span>, <span class="st">&quot;Group&quot;</span>)</span>
<span id="cb58-3"><a href="rse-plotting-basics-with-smokingmouse.html#cb58-3" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">4</span>), <span class="st">&quot;cm&quot;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<p>For pups, 1 experimental sample was dropped by its <mark style= "background-color: #FCF3CF"> <span style="font-family: monospace"> rRNA_rate</span> </mark>.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="rse-plotting-basics-with-smokingmouse.html#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Pup samples</span></span>
<span id="cb59-2"><a href="rse-plotting-basics-with-smokingmouse.html#cb59-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">boxplots_after_QC_filtering</span>(rse_gene_pups, <span class="st">&quot;rRNA_rate&quot;</span>, <span class="st">&quot;Group&quot;</span>)</span>
<span id="cb59-3"><a href="rse-plotting-basics-with-smokingmouse.html#cb59-3" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">4</span>), <span class="st">&quot;cm&quot;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p class="exercise">
📑 <strong>Exercise 2</strong>: Were the filtered adult samples from pregnant or not pregnant mice? From which plates and flowcells? What were their library sizes?
</p>
<div class="alert alert-info">
<p>Try the function yourself with different QC metrics and sample variables!</p>
</div>
</div>
</div>
<div id="miscellaneous-about-cpm-values" class="section level2 hasAnchor" number="6.5">
<h2><span class="header-section-number">6.5</span> Miscellaneous about CPM values<a href="rse-plotting-basics-with-smokingmouse.html#miscellaneous-about-cpm-values" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Why do we see log(CPM + 0.5) values smaller than -1?</span></span>
<span id="cb60-2"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">log2</span>(<span class="fl">0.5</span>)</span>
<span id="cb60-3"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] -1</span></span>
<span id="cb60-4"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-5"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Maybe the prior count is getting shrunk</span></span>
<span id="cb60-6"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="fu">log2</span>(<span class="fl">0.05</span>)</span>
<span id="cb60-7"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] -4.321928</span></span>
<span id="cb60-8"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-9"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="do">## logcounts values we see across all samples</span></span>
<span id="cb60-10"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">as.vector</span>(<span class="fu">assays</span>(rse_gene)<span class="sc">$</span>logcounts))</span>
<span id="cb60-11"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb60-12"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; -5.9853 -5.9853 -5.9853 -2.7514  0.4171 18.2732</span></span>
<span id="cb60-13"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-14"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Sample 203 in particular has some cases like it</span></span>
<span id="cb60-15"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-15" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">assays</span>(rse_gene)<span class="sc">$</span>logcounts[, <span class="dv">203</span>])</span>
<span id="cb60-16"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb60-17"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; -5.9853 -5.9853 -5.9853 -2.6620  0.6067 12.5785</span></span>
<span id="cb60-18"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-19"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-19" aria-hidden="true" tabindex="-1"></a><span class="do">## Where we find one gene in sample 203 with that property</span></span>
<span id="cb60-20"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-20" aria-hidden="true" tabindex="-1"></a>i_gene <span class="ot">&lt;-</span> <span class="fu">which.min</span>(<span class="fu">assays</span>(rse_gene)<span class="sc">$</span>logcounts[, <span class="dv">203</span>])</span>
<span id="cb60-21"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-22"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-22" aria-hidden="true" tabindex="-1"></a><span class="do">## We can check the logcounts and counts</span></span>
<span id="cb60-23"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-23" aria-hidden="true" tabindex="-1"></a><span class="fu">assays</span>(rse_gene)<span class="sc">$</span>logcounts[i_gene, <span class="dv">203</span>]</span>
<span id="cb60-24"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ENSMUSG00000102693.1 </span></span>
<span id="cb60-25"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;            -5.985331</span></span>
<span id="cb60-26"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-26" aria-hidden="true" tabindex="-1"></a><span class="fu">assays</span>(rse_gene)<span class="sc">$</span>counts[i_gene, <span class="dv">203</span>]</span>
<span id="cb60-27"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ENSMUSG00000102693.1 </span></span>
<span id="cb60-28"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                    0</span></span>
<span id="cb60-29"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-30"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-30" aria-hidden="true" tabindex="-1"></a><span class="do">## What if we try to reverse engineer the number?</span></span>
<span id="cb60-31"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-31" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">^</span><span class="fu">assays</span>(rse_gene)<span class="sc">$</span>logcounts[i_gene, <span class="dv">203</span>]</span>
<span id="cb60-32"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ENSMUSG00000102693.1 </span></span>
<span id="cb60-33"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;           0.01578469</span></span>
<span id="cb60-34"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-34" aria-hidden="true" tabindex="-1"></a><span class="fu">log2</span>(<span class="fl">0.01578469</span>)</span>
<span id="cb60-35"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] -5.98533</span></span>
<span id="cb60-36"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-36" aria-hidden="true" tabindex="-1"></a><span class="fl">0.01578469</span> <span class="sc">/</span> <span class="fl">0.5</span></span>
<span id="cb60-37"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.03156938</span></span>
<span id="cb60-38"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-38" aria-hidden="true" tabindex="-1"></a><span class="fl">0.5</span> <span class="sc">*</span> <span class="fl">0.03156938</span></span>
<span id="cb60-39"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.01578469</span></span>
<span id="cb60-40"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-41"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-41" aria-hidden="true" tabindex="-1"></a><span class="do">## Hm... 31 doesn&#39;t ring any bells</span></span>
<span id="cb60-42"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-42" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">/</span> <span class="fl">0.03156938</span></span>
<span id="cb60-43"><a href="rse-plotting-basics-with-smokingmouse.html#cb60-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 31.67626</span></span></code></pre></div>
<ul>
<li>Bioconductor website for browsing code: <a href="https://code.bioconductor.org/" class="uri">https://code.bioconductor.org/</a></li>
<li>Bioconductor support website: <a href="https://support.bioconductor.org/" class="uri">https://support.bioconductor.org/</a></li>
</ul>
<p>Links Leo showed:</p>
<ul>
<li><code>smokingMouse_indirects</code> code for computing the <code>logcounts</code> <a href="https://github.com/LieberInstitute/smokingMouse_Indirects/blob/704692a357ec391348ebc3568188d41827328ba5/code/02_build_objects/02_build_objects.R#L100" class="uri">https://github.com/LieberInstitute/smokingMouse_Indirects/blob/704692a357ec391348ebc3568188d41827328ba5/code/02_build_objects/02_build_objects.R#L100</a></li>
<li><a href="https://code.bioconductor.org/browse/edgeR/blob/devel/R/cpm.R#L9" class="uri">https://code.bioconductor.org/browse/edgeR/blob/devel/R/cpm.R#L9</a></li>
<li><a href="https://code.bioconductor.org/browse/edgeR/blob/devel/R/cpm.R#L14" class="uri">https://code.bioconductor.org/browse/edgeR/blob/devel/R/cpm.R#L14</a></li>
<li><a href="https://code.bioconductor.org/browse/edgeR/blob/devel/R/cpm.R#L78" class="uri">https://code.bioconductor.org/browse/edgeR/blob/devel/R/cpm.R#L78</a></li>
<li><a href="https://code.bioconductor.org/browse/edgeR/blob/devel/src/R_calculate_cpm.cpp#L30" class="uri">https://code.bioconductor.org/browse/edgeR/blob/devel/src/R_calculate_cpm.cpp#L30</a></li>
<li><a href="https://code.bioconductor.org/browse/edgeR/blob/devel/src/add_prior.cpp#L29" class="uri">https://code.bioconductor.org/browse/edgeR/blob/devel/src/add_prior.cpp#L29</a></li>
<li><a href="https://support.bioconductor.org/post/search/?query=prior.count+edgeR" class="uri">https://support.bioconductor.org/post/search/?query=prior.count+edgeR</a></li>
<li><a href="https://support.bioconductor.org/p/59846/" class="uri">https://support.bioconductor.org/p/59846/</a></li>
<li><a href="https://support.bioconductor.org/p/59846/" class="uri">https://support.bioconductor.org/p/59846/</a></li>
</ul>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Check the documentation</span></span>
<span id="cb61-2"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="do">## ?edgeR::cpm</span></span>
<span id="cb61-3"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="do">## &gt; If log-values are computed, then a small count, given by prior.count but scaled to be proportional to the library size, is added to y to avoid taking the log of zero.</span></span>
<span id="cb61-4"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="do">## https://github.com/LieberInstitute/smokingMouse_Indirects/blob/704692a357ec391348ebc3568188d41827328ba5/code/02_build_objects/02_build_objects.R#L100C51-L100C135</span></span>
<span id="cb61-6"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Let&#39;s save the output of calcNormFactors</span></span>
<span id="cb61-7"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-7" aria-hidden="true" tabindex="-1"></a>DGElist_with_norm <span class="ot">&lt;-</span> edgeR<span class="sc">::</span><span class="fu">calcNormFactors</span>(rse_gene, <span class="at">method =</span> <span class="st">&quot;TMM&quot;</span>)</span>
<span id="cb61-8"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(DGElist_with_norm)</span>
<span id="cb61-9"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;DGEList&quot;</span></span>
<span id="cb61-10"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; attr(,&quot;package&quot;)</span></span>
<span id="cb61-11"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;edgeR&quot;</span></span>
<span id="cb61-12"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-13"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-13" aria-hidden="true" tabindex="-1"></a><span class="do">## https://code.bioconductor.org/browse/edgeR/blob/devel/R/cpm.R#L9</span></span>
<span id="cb61-14"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-14" aria-hidden="true" tabindex="-1"></a><span class="do">## We can see that it has the lib.size and norm.factors values there</span></span>
<span id="cb61-15"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-15" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(DGElist_with_norm<span class="sc">$</span>samples[, <span class="fu">seq_len</span>(<span class="dv">3</span>)])</span>
<span id="cb61-16"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         group lib.size norm.factors</span></span>
<span id="cb61-17"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Sample1     1 37119948    0.9601434</span></span>
<span id="cb61-18"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Sample2     1 24904754    0.9783991</span></span>
<span id="cb61-19"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Sample3     1 27083602    0.9740923</span></span>
<span id="cb61-20"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Sample4     1 48312479    0.9408362</span></span>
<span id="cb61-21"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Sample5     1 34921004    0.9772143</span></span>
<span id="cb61-22"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Sample6     1 31558549    0.9246274</span></span>
<span id="cb61-23"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-24"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-24" aria-hidden="true" tabindex="-1"></a><span class="do">## Exploring lib.size across all samples</span></span>
<span id="cb61-25"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-25" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(DGElist_with_norm<span class="sc">$</span>samples<span class="sc">$</span>lib.size)</span>
<span id="cb61-26"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. </span></span>
<span id="cb61-27"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   6908739  26209304  29205003  29475155  34809355 114202414</span></span>
<span id="cb61-28"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-28" aria-hidden="true" tabindex="-1"></a>DGElist_with_norm<span class="sc">$</span>samples<span class="sc">$</span>lib.size[<span class="dv">203</span>]</span>
<span id="cb61-29"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 34869201</span></span>
<span id="cb61-30"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-31"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-31" aria-hidden="true" tabindex="-1"></a><span class="do">## https://code.bioconductor.org/browse/edgeR/blob/devel/R/cpm.R#L14</span></span>
<span id="cb61-32"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-32" aria-hidden="true" tabindex="-1"></a><span class="do">## We can see there how edgeR::cpm() computes the adjusted library sizes</span></span>
<span id="cb61-33"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-33" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(DGElist_with_norm<span class="sc">$</span>samples<span class="sc">$</span>norm.factors)</span>
<span id="cb61-34"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb61-35"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  0.3595  0.9656  1.1230  1.0306  1.1589  1.2336</span></span>
<span id="cb61-36"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-36" aria-hidden="true" tabindex="-1"></a>DGElist_with_norm<span class="sc">$</span>samples<span class="sc">$</span>norm.factors[<span class="dv">203</span>]</span>
<span id="cb61-37"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1.19894</span></span>
<span id="cb61-38"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-39"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-39" aria-hidden="true" tabindex="-1"></a><span class="do">## adjusted library sizes</span></span>
<span id="cb61-40"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-40" aria-hidden="true" tabindex="-1"></a>DGElist_with_norm<span class="sc">$</span>samples<span class="sc">$</span>lib.size[<span class="dv">203</span>] <span class="sc">*</span> DGElist_with_norm<span class="sc">$</span>samples<span class="sc">$</span>norm.factors[<span class="dv">203</span>]</span>
<span id="cb61-41"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 41806065</span></span>
<span id="cb61-42"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-43"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-43" aria-hidden="true" tabindex="-1"></a><span class="do">## Let&#39;s save these values for all samples</span></span>
<span id="cb61-44"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-44" aria-hidden="true" tabindex="-1"></a>adj_lib_size <span class="ot">&lt;-</span> DGElist_with_norm<span class="sc">$</span>samples<span class="sc">$</span>lib.size <span class="sc">*</span> DGElist_with_norm<span class="sc">$</span>samples<span class="sc">$</span>norm.factors</span>
<span id="cb61-45"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-45" aria-hidden="true" tabindex="-1"></a>adj_lib_size[<span class="dv">203</span>]</span>
<span id="cb61-46"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 41806065</span></span>
<span id="cb61-47"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-48"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-48" aria-hidden="true" tabindex="-1"></a><span class="do">## Proportional adjusted library size to the mean adjusted library size</span></span>
<span id="cb61-49"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-49" aria-hidden="true" tabindex="-1"></a>adj_lib_size[<span class="dv">203</span>] <span class="sc">/</span> <span class="fu">mean</span>(adj_lib_size)</span>
<span id="cb61-50"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1.319791</span></span>
<span id="cb61-51"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-51" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">/</span> (adj_lib_size[<span class="dv">203</span>] <span class="sc">/</span> <span class="fu">mean</span>(adj_lib_size))</span>
<span id="cb61-52"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.7576956</span></span>
<span id="cb61-53"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-53" aria-hidden="true" tabindex="-1"></a><span class="do">## Hm.... we are missing something to get to the values we saw earlier when we</span></span>
<span id="cb61-54"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-54" aria-hidden="true" tabindex="-1"></a><span class="do">## tried to reverse engineer the issue.</span></span>
<span id="cb61-55"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-56"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-56" aria-hidden="true" tabindex="-1"></a><span class="do">## Hm.... I couldn&#39;t recalculate that -5.98 value manually</span></span>
<span id="cb61-57"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-57" aria-hidden="true" tabindex="-1"></a><span class="fu">log2</span>(<span class="fl">0.5</span> <span class="sc">/</span> (adj_lib_size[<span class="dv">203</span>] <span class="sc">/</span> <span class="fu">mean</span>(adj_lib_size) <span class="sc">*</span> <span class="dv">2</span>))</span>
<span id="cb61-58"><a href="rse-plotting-basics-with-smokingmouse.html#cb61-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] -2.40031</span></span></code></pre></div>
<p>In the end, I (Leo) don’t know enough C++ to fully understand the math of what <code>edgeR</code> is doing. But well, the point is that it is scaling that <code>prior.count</code> (<code>0.5</code> in the <code>smokingMouse</code> case instead of the default value of <code>2</code>) which results in a smaller number, and hence why the <code>log2()</code> value of it is smaller than <code>-1</code>.</p>
<script defer class="speakerdeck-embed" data-slide="24" data-id="434ae0541ae64731a95f35431acb754d" data-ratio="1.33333333333333" src="//speakerdeck.com/assets/embed.js"></script>
</div>
<div id="references" class="section level2 unnumbered hasAnchor">
<h2>References<a href="rse-plotting-basics-with-smokingmouse.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li><p>Evans, C., Hardin, J., &amp; Stoebel, D. M. (2018). Selecting between-sample RNA-Seq normalization methods from the perspective of their assumptions. <em>Briefings in bioinformatics</em>, 19(5), 776-792.</p></li>
<li><p>Bedre, R. (2023). Gene expression units explained: RPM, RPKM, FPKM, TPM, <em>DESeq</em>, TMM, SCnorm, GeTMM, and ComBat-Seq. Web site: <a href="https://www.reneshbedre.com/blog/expression_units.html" class="uri">https://www.reneshbedre.com/blog/expression_units.html</a></p></li>
</ol>

</div>
</div>
<div class="container">
    <footer class="site-footer">

      <center>
<p class="powered-by">
© 2011-2023. All thoughts and opinions here are my own. The icon was designed by <a href="https://www.linkedin.com/in/mauricio-guzman-6529b551/">Mauricio Guzmán</a> and is inspired by <a href="https://en.wikipedia.org/wiki/Huichol">Huichol culture</a>; it represents my community building interests.
</p>

<p class="powered-by copyright-license-text">
This work is licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0" rel="noopener noreferrer" target="_blank">CC BY NC SA 4.0</a>
</p>

<p class="powered-by footer-license-icons">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0" rel="noopener noreferrer" target="_blank">
      <img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg" alt="CC icon" width="32px">
      <img src="https://mirrors.creativecommons.org/presskit/icons/by.svg" alt="CC by icon" width="32px">
      <img src="https://mirrors.creativecommons.org/presskit/icons/nc.svg" alt="CC NC icon" width="32px">
      <img src="https://mirrors.creativecommons.org/presskit/icons/sa.svg" alt="CC SA icon" width="32px">
    </a>
</p>

<div id="clustrmaps-widget"></div><script type='text/javascript' id='clustrmaps' src='//cdn.clustrmaps.com/map_v2.js?cl=ffffff&w=300&t=m&d=Zo-deincaJGsqhqjIWsujtdoNOMJsnnZLefKmxDKVv8&co=124b73&cmo=dd53ff&cmn=4ec724'></script>

<p class="powered-by">
Published with <a href="https://bookdown.org/" target="_blank" rel="noopener">Bookdown</a>
</p>

</center>



<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-45299226-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-45299226-1');
</script>

</footer>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="isee-introduction.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="biocthis-introduction.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
