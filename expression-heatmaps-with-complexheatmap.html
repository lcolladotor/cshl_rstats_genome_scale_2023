<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>13 Expression heatmaps with ComplexHeatmap | Statistical Analysis of Genome Scale Data 2023</title>
  <meta name="description" content="13 Expression heatmaps with ComplexHeatmap | Statistical Analysis of Genome Scale Data 2023" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="13 Expression heatmaps with ComplexHeatmap | Statistical Analysis of Genome Scale Data 2023" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="lcolladotor/cshl_rstats_genome_scale_2023" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="13 Expression heatmaps with ComplexHeatmap | Statistical Analysis of Genome Scale Data 2023" />
  
  
  

<meta name="author" content="Leonardo Collado-Torres" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="icon_32.png" type="image/x-icon" />
<link rel="prev" href="de-model-building-with-variancepartition.html"/>
<link rel="next" href="complexheatmap-exercise-solution.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#download-course-materials"><i class="fa fa-check"></i>Download course materials</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#code-of-conduct"><i class="fa fa-check"></i>Code of Conduct</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-schedule"><i class="fa fa-check"></i>Course Schedule</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#external-links"><i class="fa fa-check"></i>External links</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-prerequisites"><i class="fa fa-check"></i>Course Prerequisites</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#r-session-information"><i class="fa fa-check"></i>R session information</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="speaqeasy-introduction.html"><a href="speaqeasy-introduction.html"><i class="fa fa-check"></i><b>1</b> SPEAQeasy introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="speaqeasy-introduction.html"><a href="speaqeasy-introduction.html#overview-slides"><i class="fa fa-check"></i><b>1.1</b> 2022-04-20 overview slides</a></li>
<li class="chapter" data-level="1.2" data-path="speaqeasy-introduction.html"><a href="speaqeasy-introduction.html#speaqeasy-main-links"><i class="fa fa-check"></i><b>1.2</b> SPEAQeasy main links</a></li>
<li class="chapter" data-level="1.3" data-path="speaqeasy-introduction.html"><a href="speaqeasy-introduction.html#pipeline-outputs"><i class="fa fa-check"></i><b>1.3</b> Pipeline outputs</a></li>
<li class="chapter" data-level="1.4" data-path="speaqeasy-introduction.html"><a href="speaqeasy-introduction.html#exercises"><i class="fa fa-check"></i><b>1.4</b> Exercises</a></li>
<li class="chapter" data-level="1.5" data-path="speaqeasy-introduction.html"><a href="speaqeasy-introduction.html#solutions"><i class="fa fa-check"></i><b>1.5</b> Solutions</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="smokingmouse-study.html"><a href="smokingmouse-study.html"><i class="fa fa-check"></i><b>2</b> smokingMouse study</a>
<ul>
<li class="chapter" data-level="2.1" data-path="smokingmouse-study.html"><a href="smokingmouse-study.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="smokingmouse-study.html"><a href="smokingmouse-study.html#overview-1"><i class="fa fa-check"></i><b>2.2</b> Overview</a></li>
<li class="chapter" data-level="2.3" data-path="smokingmouse-study.html"><a href="smokingmouse-study.html#goals"><i class="fa fa-check"></i><b>2.3</b> Goals</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="smokingmouse-study.html"><a href="smokingmouse-study.html#main-objective"><i class="fa fa-check"></i><b>2.3.1</b> Main objective</a></li>
<li class="chapter" data-level="2.3.2" data-path="smokingmouse-study.html"><a href="smokingmouse-study.html#secondary-objectives"><i class="fa fa-check"></i><b>2.3.2</b> Secondary objectives</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="smokingmouse-study.html"><a href="smokingmouse-study.html#study-design"><i class="fa fa-check"></i><b>2.4</b> Study design</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="summarizedexperiment-review.html"><a href="summarizedexperiment-review.html"><i class="fa fa-check"></i><b>3</b> SummarizedExperiment review</a>
<ul>
<li class="chapter" data-level="3.1" data-path="summarizedexperiment-review.html"><a href="summarizedexperiment-review.html#overview-2"><i class="fa fa-check"></i><b>3.1</b> Overview</a></li>
<li class="chapter" data-level="3.2" data-path="summarizedexperiment-review.html"><a href="summarizedexperiment-review.html#quiz"><i class="fa fa-check"></i><b>3.2</b> Quiz</a></li>
<li class="chapter" data-level="3.3" data-path="summarizedexperiment-review.html"><a href="summarizedexperiment-review.html#exercises-1"><i class="fa fa-check"></i><b>3.3</b> Exercises</a></li>
<li class="chapter" data-level="3.4" data-path="summarizedexperiment-review.html"><a href="summarizedexperiment-review.html#solutions-1"><i class="fa fa-check"></i><b>3.4</b> Solutions</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="smokingmouse-rse.html"><a href="smokingmouse-rse.html"><i class="fa fa-check"></i><b>4</b> smokingMouse RSE</a>
<ul>
<li class="chapter" data-level="4.1" data-path="smokingmouse-rse.html"><a href="smokingmouse-rse.html#download-data"><i class="fa fa-check"></i><b>4.1</b> Download data</a></li>
<li class="chapter" data-level="4.2" data-path="smokingmouse-rse.html"><a href="smokingmouse-rse.html#data-overview"><i class="fa fa-check"></i><b>4.2</b> Data overview</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="smokingmouse-rse.html"><a href="smokingmouse-rse.html#assays"><i class="fa fa-check"></i><b>4.2.1</b> Assays</a></li>
<li class="chapter" data-level="4.2.2" data-path="smokingmouse-rse.html"><a href="smokingmouse-rse.html#sample-data"><i class="fa fa-check"></i><b>4.2.2</b> Sample data</a></li>
<li class="chapter" data-level="4.2.3" data-path="smokingmouse-rse.html"><a href="smokingmouse-rse.html#gene-information"><i class="fa fa-check"></i><b>4.2.3</b> Gene Information</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="isee-introduction.html"><a href="isee-introduction.html"><i class="fa fa-check"></i><b>5</b> iSEE introduction</a>
<ul>
<li class="chapter" data-level="5.1" data-path="isee-introduction.html"><a href="isee-introduction.html#toy-rse-data"><i class="fa fa-check"></i><b>5.1</b> Toy RSE data</a></li>
<li class="chapter" data-level="5.2" data-path="isee-introduction.html"><a href="isee-introduction.html#isee"><i class="fa fa-check"></i><b>5.2</b> iSEE</a></li>
<li class="chapter" data-level="5.3" data-path="isee-introduction.html"><a href="isee-introduction.html#exercise-with-data-from-spatiallibd"><i class="fa fa-check"></i><b>5.3</b> Exercise with data from spatialLIBD</a></li>
<li class="chapter" data-level="5.4" data-path="isee-introduction.html"><a href="isee-introduction.html#community"><i class="fa fa-check"></i><b>5.4</b> Community</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="rse-plotting-basics-with-smokingmouse.html"><a href="rse-plotting-basics-with-smokingmouse.html"><i class="fa fa-check"></i><b>6</b> RSE plotting basics with smokingMouse</a>
<ul>
<li class="chapter" data-level="6.1" data-path="rse-plotting-basics-with-smokingmouse.html"><a href="rse-plotting-basics-with-smokingmouse.html#download-the-smokingmouse-data"><i class="fa fa-check"></i><b>6.1</b> Download the smokingMouse data</a></li>
<li class="chapter" data-level="6.2" data-path="rse-plotting-basics-with-smokingmouse.html"><a href="rse-plotting-basics-with-smokingmouse.html#data-preparation"><i class="fa fa-check"></i><b>6.2</b> Data preparation</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="rse-plotting-basics-with-smokingmouse.html"><a href="rse-plotting-basics-with-smokingmouse.html#data-normalization"><i class="fa fa-check"></i><b>6.2.1</b> Data normalization</a></li>
<li class="chapter" data-level="6.2.2" data-path="rse-plotting-basics-with-smokingmouse.html"><a href="rse-plotting-basics-with-smokingmouse.html#gene-filtering"><i class="fa fa-check"></i><b>6.2.2</b> Gene filtering</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="rse-plotting-basics-with-smokingmouse.html"><a href="rse-plotting-basics-with-smokingmouse.html#exploratory-data-analysis"><i class="fa fa-check"></i><b>6.3</b> Exploratory Data Analysis</a></li>
<li class="chapter" data-level="6.4" data-path="rse-plotting-basics-with-smokingmouse.html"><a href="rse-plotting-basics-with-smokingmouse.html#quality-control-analysis"><i class="fa fa-check"></i><b>6.4</b> Quality Control Analysis</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="rse-plotting-basics-with-smokingmouse.html"><a href="rse-plotting-basics-with-smokingmouse.html#evaluate-qc-metrics-for-groups-of-samples"><i class="fa fa-check"></i><b>6.4.1</b> Evaluate QC metrics for groups of samples</a></li>
<li class="chapter" data-level="6.4.2" data-path="rse-plotting-basics-with-smokingmouse.html"><a href="rse-plotting-basics-with-smokingmouse.html#examine-relationships-between-qc-metrics-of-samples"><i class="fa fa-check"></i><b>6.4.2</b> Examine relationships between QC metrics of samples</a></li>
<li class="chapter" data-level="6.4.3" data-path="rse-plotting-basics-with-smokingmouse.html"><a href="rse-plotting-basics-with-smokingmouse.html#qc-sample-filtering"><i class="fa fa-check"></i><b>6.4.3</b> QC sample filtering</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="rse-plotting-basics-with-smokingmouse.html"><a href="rse-plotting-basics-with-smokingmouse.html#miscellaneous-about-cpm-values"><i class="fa fa-check"></i><b>6.5</b> Miscellaneous about CPM values</a></li>
<li class="chapter" data-level="" data-path="rse-plotting-basics-with-smokingmouse.html"><a href="rse-plotting-basics-with-smokingmouse.html#references"><i class="fa fa-check"></i>References</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="biocthis-introduction.html"><a href="biocthis-introduction.html"><i class="fa fa-check"></i><b>7</b> biocthis introduction</a>
<ul>
<li class="chapter" data-level="7.1" data-path="biocthis-introduction.html"><a href="biocthis-introduction.html#related-past-materials"><i class="fa fa-check"></i><b>7.1</b> Related past materials</a></li>
<li class="chapter" data-level="7.2" data-path="biocthis-introduction.html"><a href="biocthis-introduction.html#biocthis-main-commands"><i class="fa fa-check"></i><b>7.2</b> biocthis main commands</a></li>
<li class="chapter" data-level="7.3" data-path="biocthis-introduction.html"><a href="biocthis-introduction.html#live-demo"><i class="fa fa-check"></i><b>7.3</b> Live demo</a></li>
<li class="chapter" data-level="7.4" data-path="biocthis-introduction.html"><a href="biocthis-introduction.html#community-1"><i class="fa fa-check"></i><b>7.4</b> Community</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="recount3-introduction.html"><a href="recount3-introduction.html"><i class="fa fa-check"></i><b>8</b> recount3 introduction</a>
<ul>
<li class="chapter" data-level="8.1" data-path="recount3-introduction.html"><a href="recount3-introduction.html#recount-projects"><i class="fa fa-check"></i><b>8.1</b> recount projects</a></li>
<li class="chapter" data-level="8.2" data-path="recount3-introduction.html"><a href="recount3-introduction.html#using-recount3"><i class="fa fa-check"></i><b>8.2</b> Using recount3</a></li>
<li class="chapter" data-level="8.3" data-path="recount3-introduction.html"><a href="recount3-introduction.html#exercise"><i class="fa fa-check"></i><b>8.3</b> Exercise</a></li>
<li class="chapter" data-level="8.4" data-path="recount3-introduction.html"><a href="recount3-introduction.html#community-2"><i class="fa fa-check"></i><b>8.4</b> Community</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="interpreting-model-coefficients-with-exploremodelmatrix.html"><a href="interpreting-model-coefficients-with-exploremodelmatrix.html"><i class="fa fa-check"></i><b>9</b> Interpreting model coefficients with ExploreModelMatrix</a>
<ul>
<li class="chapter" data-level="9.1" data-path="interpreting-model-coefficients-with-exploremodelmatrix.html"><a href="interpreting-model-coefficients-with-exploremodelmatrix.html#model-objects-in-r"><i class="fa fa-check"></i><b>9.1</b> Model objects in R</a></li>
<li class="chapter" data-level="9.2" data-path="interpreting-model-coefficients-with-exploremodelmatrix.html"><a href="interpreting-model-coefficients-with-exploremodelmatrix.html#exploremodelmatrix"><i class="fa fa-check"></i><b>9.2</b> ExploreModelMatrix</a></li>
<li class="chapter" data-level="9.3" data-path="interpreting-model-coefficients-with-exploremodelmatrix.html"><a href="interpreting-model-coefficients-with-exploremodelmatrix.html#example-1"><i class="fa fa-check"></i><b>9.3</b> Example 1</a></li>
<li class="chapter" data-level="9.4" data-path="interpreting-model-coefficients-with-exploremodelmatrix.html"><a href="interpreting-model-coefficients-with-exploremodelmatrix.html#example-2"><i class="fa fa-check"></i><b>9.4</b> Example 2</a></li>
<li class="chapter" data-level="9.5" data-path="interpreting-model-coefficients-with-exploremodelmatrix.html"><a href="interpreting-model-coefficients-with-exploremodelmatrix.html#example-3"><i class="fa fa-check"></i><b>9.5</b> Example 3</a></li>
<li class="chapter" data-level="9.6" data-path="interpreting-model-coefficients-with-exploremodelmatrix.html"><a href="interpreting-model-coefficients-with-exploremodelmatrix.html#exercise-1"><i class="fa fa-check"></i><b>9.6</b> Exercise</a></li>
<li class="chapter" data-level="9.7" data-path="interpreting-model-coefficients-with-exploremodelmatrix.html"><a href="interpreting-model-coefficients-with-exploremodelmatrix.html#to-learn-more"><i class="fa fa-check"></i><b>9.7</b> To learn more</a></li>
<li class="chapter" data-level="9.8" data-path="interpreting-model-coefficients-with-exploremodelmatrix.html"><a href="interpreting-model-coefficients-with-exploremodelmatrix.html#community-3"><i class="fa fa-check"></i><b>9.8</b> Community</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="differential-gene-expression-analysis-with-limma.html"><a href="differential-gene-expression-analysis-with-limma.html"><i class="fa fa-check"></i><b>10</b> Differential gene expression analysis with limma</a>
<ul>
<li class="chapter" data-level="10.1" data-path="differential-gene-expression-analysis-with-limma.html"><a href="differential-gene-expression-analysis-with-limma.html#srp045638-data"><i class="fa fa-check"></i><b>10.1</b> SRP045638 data</a></li>
<li class="chapter" data-level="10.2" data-path="differential-gene-expression-analysis-with-limma.html"><a href="differential-gene-expression-analysis-with-limma.html#data-normalization-1"><i class="fa fa-check"></i><b>10.2</b> Data normalization</a></li>
<li class="chapter" data-level="10.3" data-path="differential-gene-expression-analysis-with-limma.html"><a href="differential-gene-expression-analysis-with-limma.html#differential-expression"><i class="fa fa-check"></i><b>10.3</b> Differential expression</a></li>
<li class="chapter" data-level="10.4" data-path="differential-gene-expression-analysis-with-limma.html"><a href="differential-gene-expression-analysis-with-limma.html#visualizing-degs"><i class="fa fa-check"></i><b>10.4</b> Visualizing DEGs</a></li>
<li class="chapter" data-level="10.5" data-path="differential-gene-expression-analysis-with-limma.html"><a href="differential-gene-expression-analysis-with-limma.html#community-4"><i class="fa fa-check"></i><b>10.5</b> Community</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="differential-gene-expression-exercise.html"><a href="differential-gene-expression-exercise.html"><i class="fa fa-check"></i><b>11</b> Differential gene expression exercise</a>
<ul>
<li class="chapter" data-level="11.1" data-path="differential-gene-expression-exercise.html"><a href="differential-gene-expression-exercise.html#recap"><i class="fa fa-check"></i><b>11.1</b> Recap</a></li>
<li class="chapter" data-level="11.2" data-path="differential-gene-expression-exercise.html"><a href="differential-gene-expression-exercise.html#exercise-2"><i class="fa fa-check"></i><b>11.2</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="de-model-building-with-variancepartition.html"><a href="de-model-building-with-variancepartition.html"><i class="fa fa-check"></i><b>12</b> DE model building with variancePartition</a>
<ul>
<li class="chapter" data-level="12.1" data-path="de-model-building-with-variancepartition.html"><a href="de-model-building-with-variancepartition.html#download-the-smokingmouse-data-and-subset-it"><i class="fa fa-check"></i><b>12.1</b> Download the smokingMouse data and subset it</a></li>
<li class="chapter" data-level="12.2" data-path="de-model-building-with-variancepartition.html"><a href="de-model-building-with-variancepartition.html#explore-gene-level-effects"><i class="fa fa-check"></i><b>12.2</b> Explore gene-level effects</a></li>
<li class="chapter" data-level="12.3" data-path="de-model-building-with-variancepartition.html"><a href="de-model-building-with-variancepartition.html#variance-partition-analysis"><i class="fa fa-check"></i><b>12.3</b> Variance Partition Analysis</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="de-model-building-with-variancepartition.html"><a href="de-model-building-with-variancepartition.html#canonical-correlation-analysis"><i class="fa fa-check"></i><b>12.3.1</b> Canonical Correlation Analysis</a></li>
<li class="chapter" data-level="12.3.2" data-path="de-model-building-with-variancepartition.html"><a href="de-model-building-with-variancepartition.html#fit-model-and-extract-fraction-of-variance-explained"><i class="fa fa-check"></i><b>12.3.2</b> Fit model and extract fraction of variance explained</a></li>
<li class="chapter" data-level="12.3.3" data-path="de-model-building-with-variancepartition.html"><a href="de-model-building-with-variancepartition.html#examine-expression-of-most-affected-genes-by-each-sample-variable"><i class="fa fa-check"></i><b>12.3.3</b> Examine expression of most affected genes by each sample variable</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="de-model-building-with-variancepartition.html"><a href="de-model-building-with-variancepartition.html#solutions-2"><i class="fa fa-check"></i><b>12.4</b> Solutions</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="de-model-building-with-variancepartition.html"><a href="de-model-building-with-variancepartition.html#exercise-1-1"><i class="fa fa-check"></i><b>12.4.1</b> Exercise 1</a></li>
<li class="chapter" data-level="12.4.2" data-path="de-model-building-with-variancepartition.html"><a href="de-model-building-with-variancepartition.html#exercise-2-1"><i class="fa fa-check"></i><b>12.4.2</b> Exercise 2</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="de-model-building-with-variancepartition.html"><a href="de-model-building-with-variancepartition.html#references-1"><i class="fa fa-check"></i>References</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="expression-heatmaps-with-complexheatmap.html"><a href="expression-heatmaps-with-complexheatmap.html"><i class="fa fa-check"></i><b>13</b> Expression heatmaps with ComplexHeatmap</a>
<ul>
<li class="chapter" data-level="13.1" data-path="expression-heatmaps-with-complexheatmap.html"><a href="expression-heatmaps-with-complexheatmap.html#introduction-1"><i class="fa fa-check"></i><b>13.1</b> Introduction</a></li>
<li class="chapter" data-level="13.2" data-path="expression-heatmaps-with-complexheatmap.html"><a href="expression-heatmaps-with-complexheatmap.html#complexheatmap"><i class="fa fa-check"></i><b>13.2</b> ComplexHeatmap</a></li>
<li class="chapter" data-level="13.3" data-path="expression-heatmaps-with-complexheatmap.html"><a href="expression-heatmaps-with-complexheatmap.html#heatmap-with-expression-data"><i class="fa fa-check"></i><b>13.3</b> Heatmap with expression data</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="expression-heatmaps-with-complexheatmap.html"><a href="expression-heatmaps-with-complexheatmap.html#download-data-1"><i class="fa fa-check"></i><b>13.3.1</b> Download data</a></li>
<li class="chapter" data-level="13.3.2" data-path="expression-heatmaps-with-complexheatmap.html"><a href="expression-heatmaps-with-complexheatmap.html#prepare-the-data"><i class="fa fa-check"></i><b>13.3.2</b> Prepare the data</a></li>
<li class="chapter" data-level="13.3.3" data-path="expression-heatmaps-with-complexheatmap.html"><a href="expression-heatmaps-with-complexheatmap.html#create-annotations"><i class="fa fa-check"></i><b>13.3.3</b> Create annotations</a></li>
<li class="chapter" data-level="13.3.4" data-path="expression-heatmaps-with-complexheatmap.html"><a href="expression-heatmaps-with-complexheatmap.html#plot-our-heatmap"><i class="fa fa-check"></i><b>13.3.4</b> Plot our heatmap</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="complexheatmap-exercise-solution.html"><a href="complexheatmap-exercise-solution.html"><i class="fa fa-check"></i><b>14</b> ComplexHeatmap exercise solution</a></li>
<li class="chapter" data-level="15" data-path="exercise-with-variancepartition-and-complexheatmap.html"><a href="exercise-with-variancepartition-and-complexheatmap.html"><i class="fa fa-check"></i><b>15</b> Exercise with variancePartition and ComplexHeatmap</a>
<ul>
<li class="chapter" data-level="15.1" data-path="exercise-with-variancepartition-and-complexheatmap.html"><a href="exercise-with-variancepartition-and-complexheatmap.html#steps"><i class="fa fa-check"></i><b>15.1</b> Steps:</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="miscellaneous.html"><a href="miscellaneous.html"><i class="fa fa-check"></i><b>16</b> Miscellaneous</a>
<ul>
<li class="chapter" data-level="16.1" data-path="miscellaneous.html"><a href="miscellaneous.html#postcards"><i class="fa fa-check"></i><b>16.1</b> postcards</a></li>
<li class="chapter" data-level="16.2" data-path="miscellaneous.html"><a href="miscellaneous.html#organizing-your-work"><i class="fa fa-check"></i><b>16.2</b> Organizing your work</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="introduction-to-the-world-of-spatially-resolved-transcriptomics-with-visium-data.html"><a href="introduction-to-the-world-of-spatially-resolved-transcriptomics-with-visium-data.html"><i class="fa fa-check"></i><b>17</b> Introduction to the world of spatially-resolved transcriptomics with Visium data</a>
<ul>
<li class="chapter" data-level="17.1" data-path="introduction-to-the-world-of-spatially-resolved-transcriptomics-with-visium-data.html"><a href="introduction-to-the-world-of-spatially-resolved-transcriptomics-with-visium-data.html#community-5"><i class="fa fa-check"></i><b>17.1</b> Community</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html"><a href="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html"><i class="fa fa-check"></i><b>18</b> Downloading public Visium spatial data and visualizing it with spatialLIBD</a>
<ul>
<li class="chapter" data-level="18.1" data-path="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html"><a href="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html#download-data-from-10x-genomics"><i class="fa fa-check"></i><b>18.1</b> Download data from 10x Genomics</a></li>
<li class="chapter" data-level="18.2" data-path="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html"><a href="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html#add-gene-annotation-information"><i class="fa fa-check"></i><b>18.2</b> Add gene annotation information</a>
<ul>
<li class="chapter" data-level="18.2.1" data-path="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html"><a href="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html#from-10x"><i class="fa fa-check"></i><b>18.2.1</b> From 10x</a></li>
<li class="chapter" data-level="18.2.2" data-path="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html"><a href="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html#from-gencode"><i class="fa fa-check"></i><b>18.2.2</b> From Gencode</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html"><a href="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html#wrapper-functions-for-reading-the-data"><i class="fa fa-check"></i><b>18.3</b> Wrapper functions for reading the data</a></li>
<li class="chapter" data-level="18.4" data-path="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html"><a href="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html#visualize-spatial-plots"><i class="fa fa-check"></i><b>18.4</b> Visualize spatial plots</a></li>
<li class="chapter" data-level="18.5" data-path="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html"><a href="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html#exercise-3"><i class="fa fa-check"></i><b>18.5</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="re-use-of-bulk-rna-seq-methods-for-spatial-data-exercise.html"><a href="re-use-of-bulk-rna-seq-methods-for-spatial-data-exercise.html"><i class="fa fa-check"></i><b>19</b> Re-use of bulk RNA-seq methods for spatial data exercise</a>
<ul>
<li class="chapter" data-level="19.1" data-path="re-use-of-bulk-rna-seq-methods-for-spatial-data-exercise.html"><a href="re-use-of-bulk-rna-seq-methods-for-spatial-data-exercise.html#spatial-registration"><i class="fa fa-check"></i><b>19.1</b> Spatial registration</a></li>
<li class="chapter" data-level="19.2" data-path="re-use-of-bulk-rna-seq-methods-for-spatial-data-exercise.html"><a href="re-use-of-bulk-rna-seq-methods-for-spatial-data-exercise.html#exercise-4"><i class="fa fa-check"></i><b>19.2</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="final-r-session.html"><a href="final-r-session.html"><i class="fa fa-check"></i>Final R Session</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Analysis of Genome Scale Data 2023</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="expression-heatmaps-with-complexheatmap" class="section level1 hasAnchor" number="13">
<h1><span class="header-section-number">13</span> Expression heatmaps with ComplexHeatmap<a href="expression-heatmaps-with-complexheatmap.html#expression-heatmaps-with-complexheatmap" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Instructor: Renee</p>
<blockquote class="twitter-tweet">
<p lang="en" dir="ltr">
Congrats to <a href="https://twitter.com/rodriguez_lion?ref_src=twsrc%5Etfw"><span class="citation">@rodriguez_lion</span></a> - final chapter of his PhD thesis - as well as co-1st author <a href="https://twitter.com/mattntran?ref_src=twsrc%5Etfw"><span class="citation">@mattntran</span></a>, and <a href="https://twitter.com/SubmarineGene?ref_src=twsrc%5Etfw"><span class="citation">@SubmarineGene</span></a> who joined the project late, but was invaluable to getting it finished, and much thanks to <a href="https://twitter.com/CerceoPage?ref_src=twsrc%5Etfw"><span class="citation">@CerceoPage</span></a> <a href="https://twitter.com/lcolladotor?ref_src=twsrc%5Etfw"><span class="citation">@lcolladotor</span></a> for co-supervising!
</p>
— Keri Martinowich (<span class="citation">@martinowk</span>) <a href="https://twitter.com/martinowk/status/1675881303940423680?ref_src=twsrc%5Etfw">July 3, 2023</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<div id="introduction-1" class="section level2 hasAnchor" number="13.1">
<h2><span class="header-section-number">13.1</span> Introduction<a href="expression-heatmaps-with-complexheatmap.html#introduction-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Heatmaps are efficient to visualize associations between different sources of data sets and reveal potential patterns (e.g. patterns of expression in your genes). There are multiple packages in R that allow you to create heatmaps, the most widely use include:</p>
<ul>
<li><p><a href="https://r-graph-gallery.com/79-levelplot-with-ggplot2.html">ggplot2 heatmaps</a></p></li>
<li><p><a href="https://davetang.org/muse/2018/05/15/making-a-heatmap-in-r-with-the-pheatmap-package/">pheatmap</a></p></li>
<li><p><a href="https://jokergoo.github.io/ComplexHeatmap/">ComplexHeatmap</a></p></li>
</ul>
<p>All of these are good and useful, but adding extra information to your heatmaps can get really messy depending on the package you are using.</p>
<p>For example, in the next heatmap we are showing the expression of marker genes in multiple cell types. The columns are separated by the group from which they are markers. Then the rows (cell types), have two different classifications: <code>group</code> and <code>Population</code>, plus a barplot that shows the number of nuclei that cell type contains.</p>
<figure>
<img src="Figures/LS_heatmap.png" width="700px" align=center />
</figure>
</div>
<div id="complexheatmap" class="section level2 hasAnchor" number="13.2">
<h2><span class="header-section-number">13.2</span> ComplexHeatmap<a href="expression-heatmaps-with-complexheatmap.html#complexheatmap" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The ComplexHeatmap package provides a highly flexible way to arrange multiple heatmaps and supports self-defined annotation graphics.The ComplexHeatmap package is implemented in an object-oriented way. To describe a heatmap list, there are following classes:</p>
<p><strong>Heatmap class</strong>: a single heatmap containing heatmap body, row/column names, titles, dendrograms and row/column annotations.</p>
<p><strong>HeatmapAnnotation class</strong>: defines a list of row annotations and column annotations. The heatmap annotations can be components of heatmap, also they can be independent as heatmaps.</p>
<style>
p.exercise  {
background-color: #E4EDE2;
padding: 9px;
border: 1px solid black;
border-radius: 10px;
font-family: sans-serif;
}

</style>
<p class="exercise">
<strong>Exercise 1</strong>:
Explore the <a href="https://bioconductor.org/packages/release/bioc/html/ComplexHeatmap.html">Bioconductor page for this package</a>, go to the vignette and find a function that would allow you to add the barplot on the right side of the heatmap previously shown.
</p>
</div>
<div id="heatmap-with-expression-data" class="section level2 hasAnchor" number="13.3">
<h2><span class="header-section-number">13.3</span> Heatmap with expression data<a href="expression-heatmaps-with-complexheatmap.html#heatmap-with-expression-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now, we are gonna make our own heatmap with the SmokingMouse data. In this heatmap we want to see the difference of expression between both <code>Control</code> and <code>Experimental</code> for all the DEG in <code>Pup</code>, as well as the <code>Sex</code> of the samples and the FDR of the genes.</p>
<p>Let’s download and prepare our data first.</p>
<div id="download-data-1" class="section level3 hasAnchor" number="13.3.1">
<h3><span class="header-section-number">13.3.1</span> Download data<a href="expression-heatmaps-with-complexheatmap.html#download-data-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="expression-heatmaps-with-complexheatmap.html#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;SummarizedExperiment&quot;</span>)</span>
<span id="cb123-2"><a href="expression-heatmaps-with-complexheatmap.html#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;ComplexHeatmap&quot;</span>)</span>
<span id="cb123-3"><a href="expression-heatmaps-with-complexheatmap.html#cb123-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;circlize&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="expression-heatmaps-with-complexheatmap.html#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Download and cache the file</span></span>
<span id="cb124-2"><a href="expression-heatmaps-with-complexheatmap.html#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;BiocFileCache&quot;</span>)</span>
<span id="cb124-3"><a href="expression-heatmaps-with-complexheatmap.html#cb124-3" aria-hidden="true" tabindex="-1"></a>bfc <span class="ot">&lt;-</span> BiocFileCache<span class="sc">::</span><span class="fu">BiocFileCache</span>()</span>
<span id="cb124-4"><a href="expression-heatmaps-with-complexheatmap.html#cb124-4" aria-hidden="true" tabindex="-1"></a>cached_rse_gene <span class="ot">&lt;-</span> BiocFileCache<span class="sc">::</span><span class="fu">bfcrpath</span>(</span>
<span id="cb124-5"><a href="expression-heatmaps-with-complexheatmap.html#cb124-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> bfc,</span>
<span id="cb124-6"><a href="expression-heatmaps-with-complexheatmap.html#cb124-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;https://github.com/LieberInstitute/SPEAQeasyWorkshop2023/raw/devel/provisional_data/rse_gene_mouse_RNAseq_nic-smo.Rdata&quot;</span></span>
<span id="cb124-7"><a href="expression-heatmaps-with-complexheatmap.html#cb124-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb124-8"><a href="expression-heatmaps-with-complexheatmap.html#cb124-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-9"><a href="expression-heatmaps-with-complexheatmap.html#cb124-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Check the local path on our cache</span></span>
<span id="cb124-10"><a href="expression-heatmaps-with-complexheatmap.html#cb124-10" aria-hidden="true" tabindex="-1"></a>cached_rse_gene</span>
<span id="cb124-11"><a href="expression-heatmaps-with-complexheatmap.html#cb124-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                                                                  BFC2 </span></span>
<span id="cb124-12"><a href="expression-heatmaps-with-complexheatmap.html#cb124-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &quot;/github/home/.cache/R/BiocFileCache/4425565153b_rse_gene_mouse_RNAseq_nic-smo.Rdata&quot;</span></span>
<span id="cb124-13"><a href="expression-heatmaps-with-complexheatmap.html#cb124-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-14"><a href="expression-heatmaps-with-complexheatmap.html#cb124-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Load the rse_gene object</span></span>
<span id="cb124-15"><a href="expression-heatmaps-with-complexheatmap.html#cb124-15" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(cached_rse_gene, <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span>
<span id="cb124-16"><a href="expression-heatmaps-with-complexheatmap.html#cb124-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Loading objects:</span></span>
<span id="cb124-17"><a href="expression-heatmaps-with-complexheatmap.html#cb124-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   rse_gene</span></span>
<span id="cb124-18"><a href="expression-heatmaps-with-complexheatmap.html#cb124-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-19"><a href="expression-heatmaps-with-complexheatmap.html#cb124-19" aria-hidden="true" tabindex="-1"></a><span class="do">## General overview of the object</span></span>
<span id="cb124-20"><a href="expression-heatmaps-with-complexheatmap.html#cb124-20" aria-hidden="true" tabindex="-1"></a>rse_gene</span>
<span id="cb124-21"><a href="expression-heatmaps-with-complexheatmap.html#cb124-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; class: RangedSummarizedExperiment </span></span>
<span id="cb124-22"><a href="expression-heatmaps-with-complexheatmap.html#cb124-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; dim: 55401 208 </span></span>
<span id="cb124-23"><a href="expression-heatmaps-with-complexheatmap.html#cb124-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; metadata(1): Obtained_from</span></span>
<span id="cb124-24"><a href="expression-heatmaps-with-complexheatmap.html#cb124-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; assays(2): counts logcounts</span></span>
<span id="cb124-25"><a href="expression-heatmaps-with-complexheatmap.html#cb124-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; rownames(55401): ENSMUSG00000102693.1 ENSMUSG00000064842.1 ... ENSMUSG00000064371.1 ENSMUSG00000064372.1</span></span>
<span id="cb124-26"><a href="expression-heatmaps-with-complexheatmap.html#cb124-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; rowData names(13): Length gencodeID ... DE_in_pup_brain_nicotine DE_in_pup_brain_smoking</span></span>
<span id="cb124-27"><a href="expression-heatmaps-with-complexheatmap.html#cb124-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; colnames: NULL</span></span>
<span id="cb124-28"><a href="expression-heatmaps-with-complexheatmap.html#cb124-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; colData names(71): SAMPLE_ID FQCbasicStats ... retained_after_QC_sample_filtering</span></span>
<span id="cb124-29"><a href="expression-heatmaps-with-complexheatmap.html#cb124-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   retained_after_manual_sample_filtering</span></span></code></pre></div>
</div>
<div id="prepare-the-data" class="section level3 hasAnchor" number="13.3.2">
<h3><span class="header-section-number">13.3.2</span> Prepare the data<a href="expression-heatmaps-with-complexheatmap.html#prepare-the-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="expression-heatmaps-with-complexheatmap.html#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Extract genes and samples of interest</span></span>
<span id="cb125-2"><a href="expression-heatmaps-with-complexheatmap.html#cb125-2" aria-hidden="true" tabindex="-1"></a>rse_gene_pup_nic <span class="ot">&lt;-</span> rse_gene[<span class="fu">rowData</span>(rse_gene)<span class="sc">$</span>DE_in_pup_brain_nicotine <span class="sc">==</span> <span class="cn">TRUE</span>, rse_gene<span class="sc">$</span>Age <span class="sc">==</span> <span class="st">&quot;Pup&quot;</span> <span class="sc">&amp;</span> rse_gene<span class="sc">$</span>Expt <span class="sc">==</span> <span class="st">&quot;Nicotine&quot;</span>]</span>
<span id="cb125-3"><a href="expression-heatmaps-with-complexheatmap.html#cb125-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-4"><a href="expression-heatmaps-with-complexheatmap.html#cb125-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Extract logcounts and add name columns</span></span>
<span id="cb125-5"><a href="expression-heatmaps-with-complexheatmap.html#cb125-5" aria-hidden="true" tabindex="-1"></a>logs_pup_nic <span class="ot">&lt;-</span> <span class="fu">assay</span>(rse_gene_pup_nic, <span class="dv">2</span>)</span>
<span id="cb125-6"><a href="expression-heatmaps-with-complexheatmap.html#cb125-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(logs_pup_nic) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;Pup_&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(rse_gene_pup_nic)[<span class="dv">2</span>])</span>
<span id="cb125-7"><a href="expression-heatmaps-with-complexheatmap.html#cb125-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-8"><a href="expression-heatmaps-with-complexheatmap.html#cb125-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Create function to remove technical variables&#39; contributions,</span></span>
<span id="cb125-9"><a href="expression-heatmaps-with-complexheatmap.html#cb125-9" aria-hidden="true" tabindex="-1"></a><span class="do">## this is from jaffelab package (https://github.com/LieberInstitute/jaffelab)</span></span>
<span id="cb125-10"><a href="expression-heatmaps-with-complexheatmap.html#cb125-10" aria-hidden="true" tabindex="-1"></a>cleaningY <span class="ot">&lt;-</span> <span class="cf">function</span>(y, mod, P) {</span>
<span id="cb125-11"><a href="expression-heatmaps-with-complexheatmap.html#cb125-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(P <span class="sc">&lt;=</span> <span class="fu">ncol</span>(mod))</span>
<span id="cb125-12"><a href="expression-heatmaps-with-complexheatmap.html#cb125-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="st">`</span><span class="at">Input matrix is not full rank</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">qr</span>(mod)<span class="sc">$</span>rank <span class="sc">==</span></span>
<span id="cb125-13"><a href="expression-heatmaps-with-complexheatmap.html#cb125-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ncol</span>(mod))</span>
<span id="cb125-14"><a href="expression-heatmaps-with-complexheatmap.html#cb125-14" aria-hidden="true" tabindex="-1"></a>    Hat <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">t</span>(mod) <span class="sc">%*%</span> mod) <span class="sc">%*%</span> <span class="fu">t</span>(mod)</span>
<span id="cb125-15"><a href="expression-heatmaps-with-complexheatmap.html#cb125-15" aria-hidden="true" tabindex="-1"></a>    ty <span class="ot">&lt;-</span> <span class="fu">t</span>(y)</span>
<span id="cb125-16"><a href="expression-heatmaps-with-complexheatmap.html#cb125-16" aria-hidden="true" tabindex="-1"></a>    ty[<span class="fu">is.na</span>(ty)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb125-17"><a href="expression-heatmaps-with-complexheatmap.html#cb125-17" aria-hidden="true" tabindex="-1"></a>    beta <span class="ot">&lt;-</span> (Hat <span class="sc">%*%</span> ty)</span>
<span id="cb125-18"><a href="expression-heatmaps-with-complexheatmap.html#cb125-18" aria-hidden="true" tabindex="-1"></a>    cleany <span class="ot">&lt;-</span> y <span class="sc">-</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(mod[, <span class="sc">-</span><span class="fu">c</span>(<span class="fu">seq_len</span>(P))]) <span class="sc">%*%</span> beta[<span class="sc">-</span><span class="fu">seq_len</span>(P), ])</span>
<span id="cb125-19"><a href="expression-heatmaps-with-complexheatmap.html#cb125-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(cleany)</span>
<span id="cb125-20"><a href="expression-heatmaps-with-complexheatmap.html#cb125-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb125-21"><a href="expression-heatmaps-with-complexheatmap.html#cb125-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-22"><a href="expression-heatmaps-with-complexheatmap.html#cb125-22" aria-hidden="true" tabindex="-1"></a><span class="do">## Remove contribution of technical variables</span></span>
<span id="cb125-23"><a href="expression-heatmaps-with-complexheatmap.html#cb125-23" aria-hidden="true" tabindex="-1"></a>formula <span class="ot">&lt;-</span> <span class="er">~</span> Group <span class="sc">+</span> Sex <span class="sc">+</span> plate <span class="sc">+</span> flowcell <span class="sc">+</span> rRNA_rate <span class="sc">+</span> totalAssignedGene <span class="sc">+</span> ERCCsumLogErr <span class="sc">+</span></span>
<span id="cb125-24"><a href="expression-heatmaps-with-complexheatmap.html#cb125-24" aria-hidden="true" tabindex="-1"></a>    overallMapRate <span class="sc">+</span> mitoRate</span>
<span id="cb125-25"><a href="expression-heatmaps-with-complexheatmap.html#cb125-25" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(formula, <span class="at">data =</span> <span class="fu">colData</span>(rse_gene_pup_nic))</span>
<span id="cb125-26"><a href="expression-heatmaps-with-complexheatmap.html#cb125-26" aria-hidden="true" tabindex="-1"></a>logs_pup_nic <span class="ot">&lt;-</span> <span class="fu">cleaningY</span>(logs_pup_nic, model, <span class="at">P =</span> <span class="dv">2</span>)</span>
<span id="cb125-27"><a href="expression-heatmaps-with-complexheatmap.html#cb125-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-28"><a href="expression-heatmaps-with-complexheatmap.html#cb125-28" aria-hidden="true" tabindex="-1"></a><span class="do">## Center the data to make differences more evident</span></span>
<span id="cb125-29"><a href="expression-heatmaps-with-complexheatmap.html#cb125-29" aria-hidden="true" tabindex="-1"></a>logs_pup_nic <span class="ot">&lt;-</span> (logs_pup_nic <span class="sc">-</span> <span class="fu">rowMeans</span>(logs_pup_nic)) <span class="sc">/</span> <span class="fu">rowSds</span>(logs_pup_nic)</span></code></pre></div>
</div>
<div id="create-annotations" class="section level3 hasAnchor" number="13.3.3">
<h3><span class="header-section-number">13.3.3</span> Create annotations<a href="expression-heatmaps-with-complexheatmap.html#create-annotations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="expression-heatmaps-with-complexheatmap.html#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Prepare annotation for our heatmap</span></span>
<span id="cb126-2"><a href="expression-heatmaps-with-complexheatmap.html#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="do">## For this heatmap I want to be able to see the Group to which each sample belongs</span></span>
<span id="cb126-3"><a href="expression-heatmaps-with-complexheatmap.html#cb126-3" aria-hidden="true" tabindex="-1"></a><span class="do">## as well as the Sex of the pup</span></span>
<span id="cb126-4"><a href="expression-heatmaps-with-complexheatmap.html#cb126-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-5"><a href="expression-heatmaps-with-complexheatmap.html#cb126-5" aria-hidden="true" tabindex="-1"></a>top_ans <span class="ot">&lt;-</span> <span class="fu">HeatmapAnnotation</span>(</span>
<span id="cb126-6"><a href="expression-heatmaps-with-complexheatmap.html#cb126-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">df =</span> <span class="fu">as.data.frame</span>(<span class="fu">colData</span>(rse_gene_pup_nic)[, <span class="fu">c</span>(<span class="st">&quot;Sex&quot;</span>, <span class="st">&quot;Group&quot;</span>)]),</span>
<span id="cb126-7"><a href="expression-heatmaps-with-complexheatmap.html#cb126-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="fu">list</span>(</span>
<span id="cb126-8"><a href="expression-heatmaps-with-complexheatmap.html#cb126-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Sex&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;F&quot;</span> <span class="ot">=</span> <span class="st">&quot;hotpink1&quot;</span>, <span class="st">&quot;M&quot;</span> <span class="ot">=</span> <span class="st">&quot;dodgerblue&quot;</span>),</span>
<span id="cb126-9"><a href="expression-heatmaps-with-complexheatmap.html#cb126-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Group&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Control&quot;</span> <span class="ot">=</span> <span class="st">&quot;brown2&quot;</span>, <span class="st">&quot;Experimental&quot;</span> <span class="ot">=</span> <span class="st">&quot;deepskyblue3&quot;</span>)</span>
<span id="cb126-10"><a href="expression-heatmaps-with-complexheatmap.html#cb126-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb126-11"><a href="expression-heatmaps-with-complexheatmap.html#cb126-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb126-12"><a href="expression-heatmaps-with-complexheatmap.html#cb126-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-13"><a href="expression-heatmaps-with-complexheatmap.html#cb126-13" aria-hidden="true" tabindex="-1"></a><span class="do">## Also, I want to add the FDR associated to each gene</span></span>
<span id="cb126-14"><a href="expression-heatmaps-with-complexheatmap.html#cb126-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Even though we do have that data, for this particular exercise we are gonna simulate it</span></span>
<span id="cb126-15"><a href="expression-heatmaps-with-complexheatmap.html#cb126-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-16"><a href="expression-heatmaps-with-complexheatmap.html#cb126-16" aria-hidden="true" tabindex="-1"></a><span class="fu">rowData</span>(rse_gene_pup_nic)<span class="sc">$</span>FDR <span class="ot">&lt;-</span> <span class="fu">sample</span>(</span>
<span id="cb126-17"><a href="expression-heatmaps-with-complexheatmap.html#cb126-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">5000</span>,</span>
<span id="cb126-18"><a href="expression-heatmaps-with-complexheatmap.html#cb126-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fu">dim</span>(rse_gene_pup_nic)[<span class="dv">1</span>],</span>
<span id="cb126-19"><a href="expression-heatmaps-with-complexheatmap.html#cb126-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">prob =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fl">0.0012</span>, <span class="dv">1001</span>), <span class="fu">rep</span>(<span class="fl">0.00005</span>, <span class="dv">4000</span>))</span>
<span id="cb126-20"><a href="expression-heatmaps-with-complexheatmap.html#cb126-20" aria-hidden="true" tabindex="-1"></a>) <span class="sc">/</span> <span class="dv">10000</span></span>
<span id="cb126-21"><a href="expression-heatmaps-with-complexheatmap.html#cb126-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-22"><a href="expression-heatmaps-with-complexheatmap.html#cb126-22" aria-hidden="true" tabindex="-1"></a>left_ans <span class="ot">&lt;-</span> <span class="fu">rowAnnotation</span>(</span>
<span id="cb126-23"><a href="expression-heatmaps-with-complexheatmap.html#cb126-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">FDR =</span> <span class="fu">rowData</span>(rse_gene_pup_nic)<span class="sc">$</span>FDR,</span>
<span id="cb126-24"><a href="expression-heatmaps-with-complexheatmap.html#cb126-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="fu">list</span>(<span class="at">FDR =</span> <span class="fu">colorRamp2</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.049</span>), <span class="fu">c</span>(<span class="st">&quot;#ecf39e&quot;</span>, <span class="st">&quot;#4f772d&quot;</span>))),</span>
<span id="cb126-25"><a href="expression-heatmaps-with-complexheatmap.html#cb126-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">annotation_legend_param =</span> <span class="fu">list</span>(<span class="at">FDR =</span> <span class="fu">list</span>(<span class="at">at =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.01</span>, <span class="fl">0.02</span>, <span class="fl">0.03</span>, <span class="fl">0.04</span>, <span class="fl">0.05</span>)))</span>
<span id="cb126-26"><a href="expression-heatmaps-with-complexheatmap.html#cb126-26" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="plot-our-heatmap" class="section level3 hasAnchor" number="13.3.4">
<h3><span class="header-section-number">13.3.4</span> Plot our heatmap<a href="expression-heatmaps-with-complexheatmap.html#plot-our-heatmap" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="expression-heatmaps-with-complexheatmap.html#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Finally, let&#39;s plot!</span></span>
<span id="cb127-2"><a href="expression-heatmaps-with-complexheatmap.html#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Heatmap</span>(logs_pup_nic,</span>
<span id="cb127-3"><a href="expression-heatmaps-with-complexheatmap.html#cb127-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">&quot;logcounts&quot;</span>,</span>
<span id="cb127-4"><a href="expression-heatmaps-with-complexheatmap.html#cb127-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">show_row_names =</span> <span class="cn">FALSE</span>,</span>
<span id="cb127-5"><a href="expression-heatmaps-with-complexheatmap.html#cb127-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">top_annotation =</span> top_ans,</span>
<span id="cb127-6"><a href="expression-heatmaps-with-complexheatmap.html#cb127-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">left_annotation =</span> left_ans,</span>
<span id="cb127-7"><a href="expression-heatmaps-with-complexheatmap.html#cb127-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">row_km =</span> <span class="dv">2</span>,</span>
<span id="cb127-8"><a href="expression-heatmaps-with-complexheatmap.html#cb127-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">column_km =</span> <span class="dv">2</span>,</span>
<span id="cb127-9"><a href="expression-heatmaps-with-complexheatmap.html#cb127-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="fu">colorRamp2</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="sc">-</span><span class="fl">0.0001</span>, <span class="dv">00001</span>, <span class="dv">4</span>), <span class="fu">c</span>(<span class="st">&quot;darkblue&quot;</span>, <span class="st">&quot;lightblue&quot;</span>, <span class="st">&quot;lightsalmon&quot;</span>, <span class="st">&quot;darkred&quot;</span>)),</span>
<span id="cb127-10"><a href="expression-heatmaps-with-complexheatmap.html#cb127-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">row_title =</span> <span class="cn">NULL</span>,</span>
<span id="cb127-11"><a href="expression-heatmaps-with-complexheatmap.html#cb127-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">column_title =</span> <span class="cn">NULL</span>,</span>
<span id="cb127-12"><a href="expression-heatmaps-with-complexheatmap.html#cb127-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">column_names_gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> <span class="dv">7</span>)</span>
<span id="cb127-13"><a href="expression-heatmaps-with-complexheatmap.html#cb127-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-59-1.png" width="1000px" /></p>
<p class="exercise">
<strong>Exercise 2</strong>:
<strong>a)</strong> Add a barplot as a <code>topAnnotation</code> with the library sizes (<code>sum</code>) of each sample. Fill the bars with the color of your choice
<strong>b)</strong> Classify the genes according to whether they are <code>proteing_coding</code> or not (<code>not_proteing_coding</code>).
</p>
</div>
</div>
</div>
<div class="container">
    <footer class="site-footer">

      <center>
<p class="powered-by">
© 2011-2023. All thoughts and opinions here are my own. The icon was designed by <a href="https://www.linkedin.com/in/mauricio-guzman-6529b551/">Mauricio Guzmán</a> and is inspired by <a href="https://en.wikipedia.org/wiki/Huichol">Huichol culture</a>; it represents my community building interests.
</p>

<p class="powered-by copyright-license-text">
This work is licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0" rel="noopener noreferrer" target="_blank">CC BY NC SA 4.0</a>
</p>

<p class="powered-by footer-license-icons">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0" rel="noopener noreferrer" target="_blank">
      <img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg" alt="CC icon" width="32px">
      <img src="https://mirrors.creativecommons.org/presskit/icons/by.svg" alt="CC by icon" width="32px">
      <img src="https://mirrors.creativecommons.org/presskit/icons/nc.svg" alt="CC NC icon" width="32px">
      <img src="https://mirrors.creativecommons.org/presskit/icons/sa.svg" alt="CC SA icon" width="32px">
    </a>
</p>

<div id="clustrmaps-widget"></div><script type='text/javascript' id='clustrmaps' src='//cdn.clustrmaps.com/map_v2.js?cl=ffffff&w=300&t=m&d=Zo-deincaJGsqhqjIWsujtdoNOMJsnnZLefKmxDKVv8&co=124b73&cmo=dd53ff&cmn=4ec724'></script>

<p class="powered-by">
Published with <a href="https://bookdown.org/" target="_blank" rel="noopener">Bookdown</a>
</p>

</center>



<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-45299226-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-45299226-1');
</script>

</footer>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="de-model-building-with-variancepartition.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="complexheatmap-exercise-solution.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
