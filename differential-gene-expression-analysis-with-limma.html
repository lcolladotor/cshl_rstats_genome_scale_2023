<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>10 Differential gene expression analysis with limma | Statistical Analysis of Genome Scale Data 2023</title>
  <meta name="description" content="10 Differential gene expression analysis with limma | Statistical Analysis of Genome Scale Data 2023" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="10 Differential gene expression analysis with limma | Statistical Analysis of Genome Scale Data 2023" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="lcolladotor/cshl_rstats_genome_scale_2023" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="10 Differential gene expression analysis with limma | Statistical Analysis of Genome Scale Data 2023" />
  
  
  

<meta name="author" content="Leonardo Collado-Torres" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="icon_32.png" type="image/x-icon" />
<link rel="prev" href="interpreting-model-coefficients-with-exploremodelmatrix.html"/>
<link rel="next" href="differential-gene-expression-exercise.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#download-course-materials"><i class="fa fa-check"></i>Download course materials</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#code-of-conduct"><i class="fa fa-check"></i>Code of Conduct</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-schedule"><i class="fa fa-check"></i>Course Schedule</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#external-links"><i class="fa fa-check"></i>External links</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-prerequisites"><i class="fa fa-check"></i>Course Prerequisites</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#r-session-information"><i class="fa fa-check"></i>R session information</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="speaqeasy-introduction.html"><a href="speaqeasy-introduction.html"><i class="fa fa-check"></i><b>1</b> SPEAQeasy introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="speaqeasy-introduction.html"><a href="speaqeasy-introduction.html#overview-slides"><i class="fa fa-check"></i><b>1.1</b> 2022-04-20 overview slides</a></li>
<li class="chapter" data-level="1.2" data-path="speaqeasy-introduction.html"><a href="speaqeasy-introduction.html#speaqeasy-main-links"><i class="fa fa-check"></i><b>1.2</b> SPEAQeasy main links</a></li>
<li class="chapter" data-level="1.3" data-path="speaqeasy-introduction.html"><a href="speaqeasy-introduction.html#pipeline-outputs"><i class="fa fa-check"></i><b>1.3</b> Pipeline outputs</a></li>
<li class="chapter" data-level="1.4" data-path="speaqeasy-introduction.html"><a href="speaqeasy-introduction.html#exercises"><i class="fa fa-check"></i><b>1.4</b> Exercises</a></li>
<li class="chapter" data-level="1.5" data-path="speaqeasy-introduction.html"><a href="speaqeasy-introduction.html#solutions"><i class="fa fa-check"></i><b>1.5</b> Solutions</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="smokingmouse-study.html"><a href="smokingmouse-study.html"><i class="fa fa-check"></i><b>2</b> smokingMouse study</a>
<ul>
<li class="chapter" data-level="2.1" data-path="smokingmouse-study.html"><a href="smokingmouse-study.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="smokingmouse-study.html"><a href="smokingmouse-study.html#overview-1"><i class="fa fa-check"></i><b>2.2</b> Overview</a></li>
<li class="chapter" data-level="2.3" data-path="smokingmouse-study.html"><a href="smokingmouse-study.html#goals"><i class="fa fa-check"></i><b>2.3</b> Goals</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="smokingmouse-study.html"><a href="smokingmouse-study.html#main-objective"><i class="fa fa-check"></i><b>2.3.1</b> Main objective</a></li>
<li class="chapter" data-level="2.3.2" data-path="smokingmouse-study.html"><a href="smokingmouse-study.html#secondary-objectives"><i class="fa fa-check"></i><b>2.3.2</b> Secondary objectives</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="smokingmouse-study.html"><a href="smokingmouse-study.html#study-design"><i class="fa fa-check"></i><b>2.4</b> Study design</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="summarizedexperiment-review.html"><a href="summarizedexperiment-review.html"><i class="fa fa-check"></i><b>3</b> SummarizedExperiment review</a>
<ul>
<li class="chapter" data-level="3.1" data-path="summarizedexperiment-review.html"><a href="summarizedexperiment-review.html#overview-2"><i class="fa fa-check"></i><b>3.1</b> Overview</a></li>
<li class="chapter" data-level="3.2" data-path="summarizedexperiment-review.html"><a href="summarizedexperiment-review.html#quiz"><i class="fa fa-check"></i><b>3.2</b> Quiz</a></li>
<li class="chapter" data-level="3.3" data-path="summarizedexperiment-review.html"><a href="summarizedexperiment-review.html#exercises-1"><i class="fa fa-check"></i><b>3.3</b> Exercises</a></li>
<li class="chapter" data-level="3.4" data-path="summarizedexperiment-review.html"><a href="summarizedexperiment-review.html#solutions-1"><i class="fa fa-check"></i><b>3.4</b> Solutions</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="smokingmouse-rse.html"><a href="smokingmouse-rse.html"><i class="fa fa-check"></i><b>4</b> smokingMouse RSE</a>
<ul>
<li class="chapter" data-level="4.1" data-path="smokingmouse-rse.html"><a href="smokingmouse-rse.html#download-data"><i class="fa fa-check"></i><b>4.1</b> Download data</a></li>
<li class="chapter" data-level="4.2" data-path="smokingmouse-rse.html"><a href="smokingmouse-rse.html#data-overview"><i class="fa fa-check"></i><b>4.2</b> Data overview</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="smokingmouse-rse.html"><a href="smokingmouse-rse.html#assays"><i class="fa fa-check"></i><b>4.2.1</b> Assays</a></li>
<li class="chapter" data-level="4.2.2" data-path="smokingmouse-rse.html"><a href="smokingmouse-rse.html#sample-data"><i class="fa fa-check"></i><b>4.2.2</b> Sample data</a></li>
<li class="chapter" data-level="4.2.3" data-path="smokingmouse-rse.html"><a href="smokingmouse-rse.html#gene-information"><i class="fa fa-check"></i><b>4.2.3</b> Gene Information</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="isee-introduction.html"><a href="isee-introduction.html"><i class="fa fa-check"></i><b>5</b> iSEE introduction</a>
<ul>
<li class="chapter" data-level="5.1" data-path="isee-introduction.html"><a href="isee-introduction.html#toy-rse-data"><i class="fa fa-check"></i><b>5.1</b> Toy RSE data</a></li>
<li class="chapter" data-level="5.2" data-path="isee-introduction.html"><a href="isee-introduction.html#isee"><i class="fa fa-check"></i><b>5.2</b> iSEE</a></li>
<li class="chapter" data-level="5.3" data-path="isee-introduction.html"><a href="isee-introduction.html#exercise-with-data-from-spatiallibd"><i class="fa fa-check"></i><b>5.3</b> Exercise with data from spatialLIBD</a></li>
<li class="chapter" data-level="5.4" data-path="isee-introduction.html"><a href="isee-introduction.html#community"><i class="fa fa-check"></i><b>5.4</b> Community</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="rse-plotting-basics-with-smokingmouse.html"><a href="rse-plotting-basics-with-smokingmouse.html"><i class="fa fa-check"></i><b>6</b> RSE plotting basics with smokingMouse</a>
<ul>
<li class="chapter" data-level="6.1" data-path="rse-plotting-basics-with-smokingmouse.html"><a href="rse-plotting-basics-with-smokingmouse.html#download-the-smokingmouse-data"><i class="fa fa-check"></i><b>6.1</b> Download the smokingMouse data</a></li>
<li class="chapter" data-level="6.2" data-path="rse-plotting-basics-with-smokingmouse.html"><a href="rse-plotting-basics-with-smokingmouse.html#data-preparation"><i class="fa fa-check"></i><b>6.2</b> Data preparation</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="rse-plotting-basics-with-smokingmouse.html"><a href="rse-plotting-basics-with-smokingmouse.html#data-normalization"><i class="fa fa-check"></i><b>6.2.1</b> Data normalization</a></li>
<li class="chapter" data-level="6.2.2" data-path="rse-plotting-basics-with-smokingmouse.html"><a href="rse-plotting-basics-with-smokingmouse.html#gene-filtering"><i class="fa fa-check"></i><b>6.2.2</b> Gene filtering</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="rse-plotting-basics-with-smokingmouse.html"><a href="rse-plotting-basics-with-smokingmouse.html#exploratory-data-analysis"><i class="fa fa-check"></i><b>6.3</b> Exploratory Data Analysis</a></li>
<li class="chapter" data-level="6.4" data-path="rse-plotting-basics-with-smokingmouse.html"><a href="rse-plotting-basics-with-smokingmouse.html#quality-control-analysis"><i class="fa fa-check"></i><b>6.4</b> Quality Control Analysis</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="rse-plotting-basics-with-smokingmouse.html"><a href="rse-plotting-basics-with-smokingmouse.html#evaluate-qc-metrics-for-groups-of-samples"><i class="fa fa-check"></i><b>6.4.1</b> Evaluate QC metrics for groups of samples</a></li>
<li class="chapter" data-level="6.4.2" data-path="rse-plotting-basics-with-smokingmouse.html"><a href="rse-plotting-basics-with-smokingmouse.html#examine-relationships-between-qc-metrics-of-samples"><i class="fa fa-check"></i><b>6.4.2</b> Examine relationships between QC metrics of samples</a></li>
<li class="chapter" data-level="6.4.3" data-path="rse-plotting-basics-with-smokingmouse.html"><a href="rse-plotting-basics-with-smokingmouse.html#qc-sample-filtering"><i class="fa fa-check"></i><b>6.4.3</b> QC sample filtering</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="rse-plotting-basics-with-smokingmouse.html"><a href="rse-plotting-basics-with-smokingmouse.html#miscellaneous-about-cpm-values"><i class="fa fa-check"></i><b>6.5</b> Miscellaneous about CPM values</a></li>
<li class="chapter" data-level="" data-path="rse-plotting-basics-with-smokingmouse.html"><a href="rse-plotting-basics-with-smokingmouse.html#references"><i class="fa fa-check"></i>References</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="biocthis-introduction.html"><a href="biocthis-introduction.html"><i class="fa fa-check"></i><b>7</b> biocthis introduction</a>
<ul>
<li class="chapter" data-level="7.1" data-path="biocthis-introduction.html"><a href="biocthis-introduction.html#related-past-materials"><i class="fa fa-check"></i><b>7.1</b> Related past materials</a></li>
<li class="chapter" data-level="7.2" data-path="biocthis-introduction.html"><a href="biocthis-introduction.html#biocthis-main-commands"><i class="fa fa-check"></i><b>7.2</b> biocthis main commands</a></li>
<li class="chapter" data-level="7.3" data-path="biocthis-introduction.html"><a href="biocthis-introduction.html#live-demo"><i class="fa fa-check"></i><b>7.3</b> Live demo</a></li>
<li class="chapter" data-level="7.4" data-path="biocthis-introduction.html"><a href="biocthis-introduction.html#community-1"><i class="fa fa-check"></i><b>7.4</b> Community</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="recount3-introduction.html"><a href="recount3-introduction.html"><i class="fa fa-check"></i><b>8</b> recount3 introduction</a>
<ul>
<li class="chapter" data-level="8.1" data-path="recount3-introduction.html"><a href="recount3-introduction.html#recount-projects"><i class="fa fa-check"></i><b>8.1</b> recount projects</a></li>
<li class="chapter" data-level="8.2" data-path="recount3-introduction.html"><a href="recount3-introduction.html#using-recount3"><i class="fa fa-check"></i><b>8.2</b> Using recount3</a></li>
<li class="chapter" data-level="8.3" data-path="recount3-introduction.html"><a href="recount3-introduction.html#exercise"><i class="fa fa-check"></i><b>8.3</b> Exercise</a></li>
<li class="chapter" data-level="8.4" data-path="recount3-introduction.html"><a href="recount3-introduction.html#community-2"><i class="fa fa-check"></i><b>8.4</b> Community</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="interpreting-model-coefficients-with-exploremodelmatrix.html"><a href="interpreting-model-coefficients-with-exploremodelmatrix.html"><i class="fa fa-check"></i><b>9</b> Interpreting model coefficients with ExploreModelMatrix</a>
<ul>
<li class="chapter" data-level="9.1" data-path="interpreting-model-coefficients-with-exploremodelmatrix.html"><a href="interpreting-model-coefficients-with-exploremodelmatrix.html#model-objects-in-r"><i class="fa fa-check"></i><b>9.1</b> Model objects in R</a></li>
<li class="chapter" data-level="9.2" data-path="interpreting-model-coefficients-with-exploremodelmatrix.html"><a href="interpreting-model-coefficients-with-exploremodelmatrix.html#exploremodelmatrix"><i class="fa fa-check"></i><b>9.2</b> ExploreModelMatrix</a></li>
<li class="chapter" data-level="9.3" data-path="interpreting-model-coefficients-with-exploremodelmatrix.html"><a href="interpreting-model-coefficients-with-exploremodelmatrix.html#example-1"><i class="fa fa-check"></i><b>9.3</b> Example 1</a></li>
<li class="chapter" data-level="9.4" data-path="interpreting-model-coefficients-with-exploremodelmatrix.html"><a href="interpreting-model-coefficients-with-exploremodelmatrix.html#example-2"><i class="fa fa-check"></i><b>9.4</b> Example 2</a></li>
<li class="chapter" data-level="9.5" data-path="interpreting-model-coefficients-with-exploremodelmatrix.html"><a href="interpreting-model-coefficients-with-exploremodelmatrix.html#example-3"><i class="fa fa-check"></i><b>9.5</b> Example 3</a></li>
<li class="chapter" data-level="9.6" data-path="interpreting-model-coefficients-with-exploremodelmatrix.html"><a href="interpreting-model-coefficients-with-exploremodelmatrix.html#exercise-1"><i class="fa fa-check"></i><b>9.6</b> Exercise</a></li>
<li class="chapter" data-level="9.7" data-path="interpreting-model-coefficients-with-exploremodelmatrix.html"><a href="interpreting-model-coefficients-with-exploremodelmatrix.html#to-learn-more"><i class="fa fa-check"></i><b>9.7</b> To learn more</a></li>
<li class="chapter" data-level="9.8" data-path="interpreting-model-coefficients-with-exploremodelmatrix.html"><a href="interpreting-model-coefficients-with-exploremodelmatrix.html#community-3"><i class="fa fa-check"></i><b>9.8</b> Community</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="differential-gene-expression-analysis-with-limma.html"><a href="differential-gene-expression-analysis-with-limma.html"><i class="fa fa-check"></i><b>10</b> Differential gene expression analysis with limma</a>
<ul>
<li class="chapter" data-level="10.1" data-path="differential-gene-expression-analysis-with-limma.html"><a href="differential-gene-expression-analysis-with-limma.html#srp045638-data"><i class="fa fa-check"></i><b>10.1</b> SRP045638 data</a></li>
<li class="chapter" data-level="10.2" data-path="differential-gene-expression-analysis-with-limma.html"><a href="differential-gene-expression-analysis-with-limma.html#data-normalization-1"><i class="fa fa-check"></i><b>10.2</b> Data normalization</a></li>
<li class="chapter" data-level="10.3" data-path="differential-gene-expression-analysis-with-limma.html"><a href="differential-gene-expression-analysis-with-limma.html#differential-expression"><i class="fa fa-check"></i><b>10.3</b> Differential expression</a></li>
<li class="chapter" data-level="10.4" data-path="differential-gene-expression-analysis-with-limma.html"><a href="differential-gene-expression-analysis-with-limma.html#visualizing-degs"><i class="fa fa-check"></i><b>10.4</b> Visualizing DEGs</a></li>
<li class="chapter" data-level="10.5" data-path="differential-gene-expression-analysis-with-limma.html"><a href="differential-gene-expression-analysis-with-limma.html#community-4"><i class="fa fa-check"></i><b>10.5</b> Community</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="differential-gene-expression-exercise.html"><a href="differential-gene-expression-exercise.html"><i class="fa fa-check"></i><b>11</b> Differential gene expression exercise</a>
<ul>
<li class="chapter" data-level="11.1" data-path="differential-gene-expression-exercise.html"><a href="differential-gene-expression-exercise.html#recap"><i class="fa fa-check"></i><b>11.1</b> Recap</a></li>
<li class="chapter" data-level="11.2" data-path="differential-gene-expression-exercise.html"><a href="differential-gene-expression-exercise.html#exercise-2"><i class="fa fa-check"></i><b>11.2</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="de-model-building-with-variancepartition.html"><a href="de-model-building-with-variancepartition.html"><i class="fa fa-check"></i><b>12</b> DE model building with variancePartition</a>
<ul>
<li class="chapter" data-level="12.1" data-path="de-model-building-with-variancepartition.html"><a href="de-model-building-with-variancepartition.html#download-the-smokingmouse-data-and-subset-it"><i class="fa fa-check"></i><b>12.1</b> Download the smokingMouse data and subset it</a></li>
<li class="chapter" data-level="12.2" data-path="de-model-building-with-variancepartition.html"><a href="de-model-building-with-variancepartition.html#explore-gene-level-effects"><i class="fa fa-check"></i><b>12.2</b> Explore gene-level effects</a></li>
<li class="chapter" data-level="12.3" data-path="de-model-building-with-variancepartition.html"><a href="de-model-building-with-variancepartition.html#variance-partition-analysis"><i class="fa fa-check"></i><b>12.3</b> Variance Partition Analysis</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="de-model-building-with-variancepartition.html"><a href="de-model-building-with-variancepartition.html#canonical-correlation-analysis"><i class="fa fa-check"></i><b>12.3.1</b> Canonical Correlation Analysis</a></li>
<li class="chapter" data-level="12.3.2" data-path="de-model-building-with-variancepartition.html"><a href="de-model-building-with-variancepartition.html#fit-model-and-extract-fraction-of-variance-explained"><i class="fa fa-check"></i><b>12.3.2</b> Fit model and extract fraction of variance explained</a></li>
<li class="chapter" data-level="12.3.3" data-path="de-model-building-with-variancepartition.html"><a href="de-model-building-with-variancepartition.html#examine-expression-of-most-affected-genes-by-each-sample-variable"><i class="fa fa-check"></i><b>12.3.3</b> Examine expression of most affected genes by each sample variable</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="de-model-building-with-variancepartition.html"><a href="de-model-building-with-variancepartition.html#solutions-2"><i class="fa fa-check"></i><b>12.4</b> Solutions</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="de-model-building-with-variancepartition.html"><a href="de-model-building-with-variancepartition.html#exercise-1-1"><i class="fa fa-check"></i><b>12.4.1</b> Exercise 1</a></li>
<li class="chapter" data-level="12.4.2" data-path="de-model-building-with-variancepartition.html"><a href="de-model-building-with-variancepartition.html#exercise-2-1"><i class="fa fa-check"></i><b>12.4.2</b> Exercise 2</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="de-model-building-with-variancepartition.html"><a href="de-model-building-with-variancepartition.html#references-1"><i class="fa fa-check"></i>References</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="expression-heatmaps-with-complexheatmap.html"><a href="expression-heatmaps-with-complexheatmap.html"><i class="fa fa-check"></i><b>13</b> Expression heatmaps with ComplexHeatmap</a>
<ul>
<li class="chapter" data-level="13.1" data-path="expression-heatmaps-with-complexheatmap.html"><a href="expression-heatmaps-with-complexheatmap.html#introduction-1"><i class="fa fa-check"></i><b>13.1</b> Introduction</a></li>
<li class="chapter" data-level="13.2" data-path="expression-heatmaps-with-complexheatmap.html"><a href="expression-heatmaps-with-complexheatmap.html#complexheatmap"><i class="fa fa-check"></i><b>13.2</b> ComplexHeatmap</a></li>
<li class="chapter" data-level="13.3" data-path="expression-heatmaps-with-complexheatmap.html"><a href="expression-heatmaps-with-complexheatmap.html#heatmap-with-expression-data"><i class="fa fa-check"></i><b>13.3</b> Heatmap with expression data</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="expression-heatmaps-with-complexheatmap.html"><a href="expression-heatmaps-with-complexheatmap.html#download-data-1"><i class="fa fa-check"></i><b>13.3.1</b> Download data</a></li>
<li class="chapter" data-level="13.3.2" data-path="expression-heatmaps-with-complexheatmap.html"><a href="expression-heatmaps-with-complexheatmap.html#prepare-the-data"><i class="fa fa-check"></i><b>13.3.2</b> Prepare the data</a></li>
<li class="chapter" data-level="13.3.3" data-path="expression-heatmaps-with-complexheatmap.html"><a href="expression-heatmaps-with-complexheatmap.html#create-annotations"><i class="fa fa-check"></i><b>13.3.3</b> Create annotations</a></li>
<li class="chapter" data-level="13.3.4" data-path="expression-heatmaps-with-complexheatmap.html"><a href="expression-heatmaps-with-complexheatmap.html#plot-our-heatmap"><i class="fa fa-check"></i><b>13.3.4</b> Plot our heatmap</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="complexheatmap-exercise-solution.html"><a href="complexheatmap-exercise-solution.html"><i class="fa fa-check"></i><b>14</b> ComplexHeatmap exercise solution</a></li>
<li class="chapter" data-level="15" data-path="exercise-with-variancepartition-and-complexheatmap.html"><a href="exercise-with-variancepartition-and-complexheatmap.html"><i class="fa fa-check"></i><b>15</b> Exercise with variancePartition and ComplexHeatmap</a>
<ul>
<li class="chapter" data-level="15.1" data-path="exercise-with-variancepartition-and-complexheatmap.html"><a href="exercise-with-variancepartition-and-complexheatmap.html#steps"><i class="fa fa-check"></i><b>15.1</b> Steps:</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="miscellaneous.html"><a href="miscellaneous.html"><i class="fa fa-check"></i><b>16</b> Miscellaneous</a>
<ul>
<li class="chapter" data-level="16.1" data-path="miscellaneous.html"><a href="miscellaneous.html#postcards"><i class="fa fa-check"></i><b>16.1</b> postcards</a></li>
<li class="chapter" data-level="16.2" data-path="miscellaneous.html"><a href="miscellaneous.html#organizing-your-work"><i class="fa fa-check"></i><b>16.2</b> Organizing your work</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="introduction-to-the-world-of-spatially-resolved-transcriptomics-with-visium-data.html"><a href="introduction-to-the-world-of-spatially-resolved-transcriptomics-with-visium-data.html"><i class="fa fa-check"></i><b>17</b> Introduction to the world of spatially-resolved transcriptomics with Visium data</a>
<ul>
<li class="chapter" data-level="17.1" data-path="introduction-to-the-world-of-spatially-resolved-transcriptomics-with-visium-data.html"><a href="introduction-to-the-world-of-spatially-resolved-transcriptomics-with-visium-data.html#community-5"><i class="fa fa-check"></i><b>17.1</b> Community</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html"><a href="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html"><i class="fa fa-check"></i><b>18</b> Downloading public Visium spatial data and visualizing it with spatialLIBD</a>
<ul>
<li class="chapter" data-level="18.1" data-path="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html"><a href="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html#download-data-from-10x-genomics"><i class="fa fa-check"></i><b>18.1</b> Download data from 10x Genomics</a></li>
<li class="chapter" data-level="18.2" data-path="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html"><a href="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html#add-gene-annotation-information"><i class="fa fa-check"></i><b>18.2</b> Add gene annotation information</a>
<ul>
<li class="chapter" data-level="18.2.1" data-path="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html"><a href="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html#from-10x"><i class="fa fa-check"></i><b>18.2.1</b> From 10x</a></li>
<li class="chapter" data-level="18.2.2" data-path="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html"><a href="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html#from-gencode"><i class="fa fa-check"></i><b>18.2.2</b> From Gencode</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html"><a href="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html#wrapper-functions-for-reading-the-data"><i class="fa fa-check"></i><b>18.3</b> Wrapper functions for reading the data</a></li>
<li class="chapter" data-level="18.4" data-path="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html"><a href="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html#visualize-spatial-plots"><i class="fa fa-check"></i><b>18.4</b> Visualize spatial plots</a></li>
<li class="chapter" data-level="18.5" data-path="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html"><a href="downloading-public-visium-spatial-data-and-visualizing-it-with-spatiallibd.html#exercise-3"><i class="fa fa-check"></i><b>18.5</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="re-use-of-bulk-rna-seq-methods-for-spatial-data-exercise.html"><a href="re-use-of-bulk-rna-seq-methods-for-spatial-data-exercise.html"><i class="fa fa-check"></i><b>19</b> Re-use of bulk RNA-seq methods for spatial data exercise</a>
<ul>
<li class="chapter" data-level="19.1" data-path="re-use-of-bulk-rna-seq-methods-for-spatial-data-exercise.html"><a href="re-use-of-bulk-rna-seq-methods-for-spatial-data-exercise.html#spatial-registration"><i class="fa fa-check"></i><b>19.1</b> Spatial registration</a></li>
<li class="chapter" data-level="19.2" data-path="re-use-of-bulk-rna-seq-methods-for-spatial-data-exercise.html"><a href="re-use-of-bulk-rna-seq-methods-for-spatial-data-exercise.html#exercise-4"><i class="fa fa-check"></i><b>19.2</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="final-r-session.html"><a href="final-r-session.html"><i class="fa fa-check"></i>Final R Session</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Analysis of Genome Scale Data 2023</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="differential-gene-expression-analysis-with-limma" class="section level1 hasAnchor" number="10">
<h1><span class="header-section-number">10</span> Differential gene expression analysis with limma<a href="differential-gene-expression-analysis-with-limma.html#differential-gene-expression-analysis-with-limma" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Instructor: Leo</p>
<div id="srp045638-data" class="section level2 hasAnchor" number="10.1">
<h2><span class="header-section-number">10.1</span> SRP045638 data<a href="differential-gene-expression-analysis-with-limma.html#srp045638-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We’ll use data from <a href="https://www.ncbi.nlm.nih.gov/sra/?term=SRP045638" class="uri">https://www.ncbi.nlm.nih.gov/sra/?term=SRP045638</a> processed and made available through the <code>recount3</code> project. First, we need to download the data with the same commands we saw earlier.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="differential-gene-expression-analysis-with-limma.html#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;recount3&quot;</span>)</span>
<span id="cb72-2"><a href="differential-gene-expression-analysis-with-limma.html#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="differential-gene-expression-analysis-with-limma.html#cb72-3" aria-hidden="true" tabindex="-1"></a>human_projects <span class="ot">&lt;-</span> <span class="fu">available_projects</span>()</span>
<span id="cb72-4"><a href="differential-gene-expression-analysis-with-limma.html#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2023-07-05 17:31:52.571146 caching file sra.recount_project.MD.gz.</span></span>
<span id="cb72-5"><a href="differential-gene-expression-analysis-with-limma.html#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2023-07-05 17:31:52.856144 caching file gtex.recount_project.MD.gz.</span></span>
<span id="cb72-6"><a href="differential-gene-expression-analysis-with-limma.html#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2023-07-05 17:31:53.159897 caching file tcga.recount_project.MD.gz.</span></span>
<span id="cb72-7"><a href="differential-gene-expression-analysis-with-limma.html#cb72-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-8"><a href="differential-gene-expression-analysis-with-limma.html#cb72-8" aria-hidden="true" tabindex="-1"></a>rse_gene_SRP045638 <span class="ot">&lt;-</span> <span class="fu">create_rse</span>(</span>
<span id="cb72-9"><a href="differential-gene-expression-analysis-with-limma.html#cb72-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">subset</span>(</span>
<span id="cb72-10"><a href="differential-gene-expression-analysis-with-limma.html#cb72-10" aria-hidden="true" tabindex="-1"></a>        human_projects,</span>
<span id="cb72-11"><a href="differential-gene-expression-analysis-with-limma.html#cb72-11" aria-hidden="true" tabindex="-1"></a>        project <span class="sc">==</span> <span class="st">&quot;SRP045638&quot;</span> <span class="sc">&amp;</span> project_type <span class="sc">==</span> <span class="st">&quot;data_sources&quot;</span></span>
<span id="cb72-12"><a href="differential-gene-expression-analysis-with-limma.html#cb72-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb72-13"><a href="differential-gene-expression-analysis-with-limma.html#cb72-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb72-14"><a href="differential-gene-expression-analysis-with-limma.html#cb72-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2023-07-05 17:31:55.805809 downloading and reading the metadata.</span></span>
<span id="cb72-15"><a href="differential-gene-expression-analysis-with-limma.html#cb72-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2023-07-05 17:31:56.089455 caching file sra.sra.SRP045638.MD.gz.</span></span>
<span id="cb72-16"><a href="differential-gene-expression-analysis-with-limma.html#cb72-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; adding rname &#39;http://duffel.rail.bio/recount3/human/data_sources/sra/metadata/38/SRP045638/sra.sra.SRP045638.MD.gz&#39;</span></span>
<span id="cb72-17"><a href="differential-gene-expression-analysis-with-limma.html#cb72-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2023-07-05 17:31:57.157765 caching file sra.recount_project.SRP045638.MD.gz.</span></span>
<span id="cb72-18"><a href="differential-gene-expression-analysis-with-limma.html#cb72-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; adding rname &#39;http://duffel.rail.bio/recount3/human/data_sources/sra/metadata/38/SRP045638/sra.recount_project.SRP045638.MD.gz&#39;</span></span>
<span id="cb72-19"><a href="differential-gene-expression-analysis-with-limma.html#cb72-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2023-07-05 17:31:58.360774 caching file sra.recount_qc.SRP045638.MD.gz.</span></span>
<span id="cb72-20"><a href="differential-gene-expression-analysis-with-limma.html#cb72-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; adding rname &#39;http://duffel.rail.bio/recount3/human/data_sources/sra/metadata/38/SRP045638/sra.recount_qc.SRP045638.MD.gz&#39;</span></span>
<span id="cb72-21"><a href="differential-gene-expression-analysis-with-limma.html#cb72-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2023-07-05 17:31:59.43749 caching file sra.recount_seq_qc.SRP045638.MD.gz.</span></span>
<span id="cb72-22"><a href="differential-gene-expression-analysis-with-limma.html#cb72-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; adding rname &#39;http://duffel.rail.bio/recount3/human/data_sources/sra/metadata/38/SRP045638/sra.recount_seq_qc.SRP045638.MD.gz&#39;</span></span>
<span id="cb72-23"><a href="differential-gene-expression-analysis-with-limma.html#cb72-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2023-07-05 17:32:00.43488 caching file sra.recount_pred.SRP045638.MD.gz.</span></span>
<span id="cb72-24"><a href="differential-gene-expression-analysis-with-limma.html#cb72-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; adding rname &#39;http://duffel.rail.bio/recount3/human/data_sources/sra/metadata/38/SRP045638/sra.recount_pred.SRP045638.MD.gz&#39;</span></span>
<span id="cb72-25"><a href="differential-gene-expression-analysis-with-limma.html#cb72-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2023-07-05 17:32:01.224397 downloading and reading the feature information.</span></span>
<span id="cb72-26"><a href="differential-gene-expression-analysis-with-limma.html#cb72-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2023-07-05 17:32:01.435986 caching file human.gene_sums.G026.gtf.gz.</span></span>
<span id="cb72-27"><a href="differential-gene-expression-analysis-with-limma.html#cb72-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2023-07-05 17:32:01.970885 downloading and reading the counts: 66 samples across 63856 features.</span></span>
<span id="cb72-28"><a href="differential-gene-expression-analysis-with-limma.html#cb72-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2023-07-05 17:32:02.272306 caching file sra.gene_sums.SRP045638.G026.gz.</span></span>
<span id="cb72-29"><a href="differential-gene-expression-analysis-with-limma.html#cb72-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; adding rname &#39;http://duffel.rail.bio/recount3/human/data_sources/sra/gene_sums/38/SRP045638/sra.gene_sums.SRP045638.G026.gz&#39;</span></span>
<span id="cb72-30"><a href="differential-gene-expression-analysis-with-limma.html#cb72-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2023-07-05 17:32:03.792567 constructing the RangedSummarizedExperiment (rse) object.</span></span>
<span id="cb72-31"><a href="differential-gene-expression-analysis-with-limma.html#cb72-31" aria-hidden="true" tabindex="-1"></a><span class="fu">assay</span>(rse_gene_SRP045638, <span class="st">&quot;counts&quot;</span>) <span class="ot">&lt;-</span> <span class="fu">compute_read_counts</span>(rse_gene_SRP045638)</span></code></pre></div>
<p>Now that we have the data and have computed the read counts (which will be needed for downstream analyses), we can use <code>expand_sra_attributes()</code> to make it easier to use the sample information in downstream analyses. However, we have to resolve some issues with this data first.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="differential-gene-expression-analysis-with-limma.html#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Can you notice the problem with the sample information?</span></span>
<span id="cb73-2"><a href="differential-gene-expression-analysis-with-limma.html#cb73-2" aria-hidden="true" tabindex="-1"></a>rse_gene_SRP045638<span class="sc">$</span>sra.sample_attributes[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb73-3"><a href="differential-gene-expression-analysis-with-limma.html#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;age;;67.78|biomaterial_provider;;LIBD|BioSampleModel;;Human|dev_stage;;Fetal|disease;;Control|Fraction;;total|isolate;;DLPFC|race;;AA|RIN;;8.3|sex;;female|tissue;;DLPFC&quot;</span></span>
<span id="cb73-4"><a href="differential-gene-expression-analysis-with-limma.html#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2] &quot;age;;40.42|biomaterial_provider;;LIBD|BioSampleModel;;Human|disease;;Control|Fraction;;total|isolate;;DLPFC|race;;AA|RIN;;8.4|sex;;male|tissue;;DLPFC&quot;                   </span></span>
<span id="cb73-5"><a href="differential-gene-expression-analysis-with-limma.html#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3] &quot;age;;41.58|biomaterial_provider;;LIBD|BioSampleModel;;Human|disease;;control|Fraction;;total|isolate;;R2869|race;;AA|RIN;;8.7|sex;;male|tissue;;DLPFC&quot;</span></span></code></pre></div>
<p>Lets resolve the issue we detected with this sample information. We’ll resolve this by eliminating some information that is only present in a subset of samples and that we don’t need.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="differential-gene-expression-analysis-with-limma.html#cb74-1" aria-hidden="true" tabindex="-1"></a>rse_gene_SRP045638<span class="sc">$</span>sra.sample_attributes <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;dev_stage;;Fetal</span><span class="sc">\\</span><span class="st">|&quot;</span>, <span class="st">&quot;&quot;</span>, rse_gene_SRP045638<span class="sc">$</span>sra.sample_attributes)</span>
<span id="cb74-2"><a href="differential-gene-expression-analysis-with-limma.html#cb74-2" aria-hidden="true" tabindex="-1"></a>rse_gene_SRP045638<span class="sc">$</span>sra.sample_attributes[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb74-3"><a href="differential-gene-expression-analysis-with-limma.html#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;age;;67.78|biomaterial_provider;;LIBD|BioSampleModel;;Human|disease;;Control|Fraction;;total|isolate;;DLPFC|race;;AA|RIN;;8.3|sex;;female|tissue;;DLPFC&quot;</span></span>
<span id="cb74-4"><a href="differential-gene-expression-analysis-with-limma.html#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2] &quot;age;;40.42|biomaterial_provider;;LIBD|BioSampleModel;;Human|disease;;Control|Fraction;;total|isolate;;DLPFC|race;;AA|RIN;;8.4|sex;;male|tissue;;DLPFC&quot;  </span></span>
<span id="cb74-5"><a href="differential-gene-expression-analysis-with-limma.html#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3] &quot;age;;41.58|biomaterial_provider;;LIBD|BioSampleModel;;Human|disease;;control|Fraction;;total|isolate;;R2869|race;;AA|RIN;;8.7|sex;;male|tissue;;DLPFC&quot;</span></span></code></pre></div>
<p>Now we can continue our work using similar code from the one we used earlier.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="differential-gene-expression-analysis-with-limma.html#cb75-1" aria-hidden="true" tabindex="-1"></a>rse_gene_SRP045638 <span class="ot">&lt;-</span> <span class="fu">expand_sra_attributes</span>(rse_gene_SRP045638)</span>
<span id="cb75-2"><a href="differential-gene-expression-analysis-with-limma.html#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="differential-gene-expression-analysis-with-limma.html#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colData</span>(rse_gene_SRP045638)[</span>
<span id="cb75-4"><a href="differential-gene-expression-analysis-with-limma.html#cb75-4" aria-hidden="true" tabindex="-1"></a>    ,</span>
<span id="cb75-5"><a href="differential-gene-expression-analysis-with-limma.html#cb75-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">&quot;^sra_attribute&quot;</span>, <span class="fu">colnames</span>(<span class="fu">colData</span>(rse_gene_SRP045638)))</span>
<span id="cb75-6"><a href="differential-gene-expression-analysis-with-limma.html#cb75-6" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb75-7"><a href="differential-gene-expression-analysis-with-limma.html#cb75-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; DataFrame with 66 rows and 10 columns</span></span>
<span id="cb75-8"><a href="differential-gene-expression-analysis-with-limma.html#cb75-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;            sra_attribute.age sra_attribute.biomaterial_provider sra_attribute.BioSampleModel sra_attribute.disease</span></span>
<span id="cb75-9"><a href="differential-gene-expression-analysis-with-limma.html#cb75-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                  &lt;character&gt;                        &lt;character&gt;                  &lt;character&gt;           &lt;character&gt;</span></span>
<span id="cb75-10"><a href="differential-gene-expression-analysis-with-limma.html#cb75-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; SRR2071341             67.78                               LIBD                        Human               Control</span></span>
<span id="cb75-11"><a href="differential-gene-expression-analysis-with-limma.html#cb75-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; SRR2071345             40.42                               LIBD                        Human               Control</span></span>
<span id="cb75-12"><a href="differential-gene-expression-analysis-with-limma.html#cb75-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; SRR2071346             41.58                               LIBD                        Human               control</span></span>
<span id="cb75-13"><a href="differential-gene-expression-analysis-with-limma.html#cb75-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; SRR2071347             44.17                               LIBD                        Human               control</span></span>
<span id="cb75-14"><a href="differential-gene-expression-analysis-with-limma.html#cb75-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;            sra_attribute.Fraction sra_attribute.isolate sra_attribute.race sra_attribute.RIN sra_attribute.sex</span></span>
<span id="cb75-15"><a href="differential-gene-expression-analysis-with-limma.html#cb75-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                       &lt;character&gt;           &lt;character&gt;        &lt;character&gt;       &lt;character&gt;       &lt;character&gt;</span></span>
<span id="cb75-16"><a href="differential-gene-expression-analysis-with-limma.html#cb75-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; SRR2071341                  total                 DLPFC                 AA               8.3            female</span></span>
<span id="cb75-17"><a href="differential-gene-expression-analysis-with-limma.html#cb75-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; SRR2071345                  total                 DLPFC                 AA               8.4              male</span></span>
<span id="cb75-18"><a href="differential-gene-expression-analysis-with-limma.html#cb75-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; SRR2071346                  total                 R2869                 AA               8.7              male</span></span>
<span id="cb75-19"><a href="differential-gene-expression-analysis-with-limma.html#cb75-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; SRR2071347                  total                 R3098                 AA               5.3            female</span></span>
<span id="cb75-20"><a href="differential-gene-expression-analysis-with-limma.html#cb75-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;            sra_attribute.tissue</span></span>
<span id="cb75-21"><a href="differential-gene-expression-analysis-with-limma.html#cb75-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                     &lt;character&gt;</span></span>
<span id="cb75-22"><a href="differential-gene-expression-analysis-with-limma.html#cb75-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; SRR2071341                DLPFC</span></span>
<span id="cb75-23"><a href="differential-gene-expression-analysis-with-limma.html#cb75-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; SRR2071345                DLPFC</span></span>
<span id="cb75-24"><a href="differential-gene-expression-analysis-with-limma.html#cb75-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; SRR2071346                DLPFC</span></span>
<span id="cb75-25"><a href="differential-gene-expression-analysis-with-limma.html#cb75-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; SRR2071347                DLPFC</span></span>
<span id="cb75-26"><a href="differential-gene-expression-analysis-with-limma.html#cb75-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [ reached getOption(&quot;max.print&quot;) -- omitted 7 rows ]</span></span></code></pre></div>
<p>As well use the sampel information for building our statistical model, it will important that we make sure that it is on the correct format R expects later on.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="differential-gene-expression-analysis-with-limma.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Recast character vectors into numeric or factor ones</span></span>
<span id="cb76-2"><a href="differential-gene-expression-analysis-with-limma.html#cb76-2" aria-hidden="true" tabindex="-1"></a>rse_gene_SRP045638<span class="sc">$</span>sra_attribute.age <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(rse_gene_SRP045638<span class="sc">$</span>sra_attribute.age)</span>
<span id="cb76-3"><a href="differential-gene-expression-analysis-with-limma.html#cb76-3" aria-hidden="true" tabindex="-1"></a>rse_gene_SRP045638<span class="sc">$</span>sra_attribute.disease <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">tolower</span>(rse_gene_SRP045638<span class="sc">$</span>sra_attribute.disease))</span>
<span id="cb76-4"><a href="differential-gene-expression-analysis-with-limma.html#cb76-4" aria-hidden="true" tabindex="-1"></a>rse_gene_SRP045638<span class="sc">$</span>sra_attribute.RIN <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(rse_gene_SRP045638<span class="sc">$</span>sra_attribute.RIN)</span>
<span id="cb76-5"><a href="differential-gene-expression-analysis-with-limma.html#cb76-5" aria-hidden="true" tabindex="-1"></a>rse_gene_SRP045638<span class="sc">$</span>sra_attribute.sex <span class="ot">&lt;-</span> <span class="fu">factor</span>(rse_gene_SRP045638<span class="sc">$</span>sra_attribute.sex)</span>
<span id="cb76-6"><a href="differential-gene-expression-analysis-with-limma.html#cb76-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-7"><a href="differential-gene-expression-analysis-with-limma.html#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Summary of our variables of interest</span></span>
<span id="cb76-8"><a href="differential-gene-expression-analysis-with-limma.html#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">as.data.frame</span>(<span class="fu">colData</span>(rse_gene_SRP045638)[</span>
<span id="cb76-9"><a href="differential-gene-expression-analysis-with-limma.html#cb76-9" aria-hidden="true" tabindex="-1"></a>    ,</span>
<span id="cb76-10"><a href="differential-gene-expression-analysis-with-limma.html#cb76-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">&quot;^sra_attribute.[age|disease|RIN|sex]&quot;</span>, <span class="fu">colnames</span>(<span class="fu">colData</span>(rse_gene_SRP045638)))</span>
<span id="cb76-11"><a href="differential-gene-expression-analysis-with-limma.html#cb76-11" aria-hidden="true" tabindex="-1"></a>]))</span>
<span id="cb76-12"><a href="differential-gene-expression-analysis-with-limma.html#cb76-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  sra_attribute.age sra_attribute.disease sra_attribute.isolate sra_attribute.RIN sra_attribute.sex</span></span>
<span id="cb76-13"><a href="differential-gene-expression-analysis-with-limma.html#cb76-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Min.   :-0.4986   control:66            Length:66             Min.   :5.30      female:22        </span></span>
<span id="cb76-14"><a href="differential-gene-expression-analysis-with-limma.html#cb76-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1st Qu.: 0.3424                         Class :character      1st Qu.:8.00      male  :44        </span></span>
<span id="cb76-15"><a href="differential-gene-expression-analysis-with-limma.html#cb76-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Median :14.9000                         Mode  :character      Median :8.30                       </span></span>
<span id="cb76-16"><a href="differential-gene-expression-analysis-with-limma.html#cb76-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Mean   :22.6286                                               Mean   :8.15                       </span></span>
<span id="cb76-17"><a href="differential-gene-expression-analysis-with-limma.html#cb76-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3rd Qu.:41.2900                                               3rd Qu.:8.70                       </span></span>
<span id="cb76-18"><a href="differential-gene-expression-analysis-with-limma.html#cb76-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Max.   :73.9100                                               Max.   :9.60</span></span></code></pre></div>
<p><a href="https://r4ds.had.co.nz/explore-intro.html"><img src="images/data-science-explore.png" width="800px" /></a></p>
<p>We’ll now create a few variables from this sample information so we can use them in our analysis.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="differential-gene-expression-analysis-with-limma.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="do">## We&#39;ll want to look for differences between prenatal and postnatal samples</span></span>
<span id="cb77-2"><a href="differential-gene-expression-analysis-with-limma.html#cb77-2" aria-hidden="true" tabindex="-1"></a>rse_gene_SRP045638<span class="sc">$</span>prenatal <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(rse_gene_SRP045638<span class="sc">$</span>sra_attribute.age <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="st">&quot;prenatal&quot;</span>, <span class="st">&quot;postnatal&quot;</span>))</span>
<span id="cb77-3"><a href="differential-gene-expression-analysis-with-limma.html#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(rse_gene_SRP045638<span class="sc">$</span>prenatal)</span>
<span id="cb77-4"><a href="differential-gene-expression-analysis-with-limma.html#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb77-5"><a href="differential-gene-expression-analysis-with-limma.html#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; postnatal  prenatal </span></span>
<span id="cb77-6"><a href="differential-gene-expression-analysis-with-limma.html#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        56        10</span></span>
<span id="cb77-7"><a href="differential-gene-expression-analysis-with-limma.html#cb77-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-8"><a href="differential-gene-expression-analysis-with-limma.html#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="do">## http://rna.recount.bio/docs/quality-check-fields.html</span></span>
<span id="cb77-9"><a href="differential-gene-expression-analysis-with-limma.html#cb77-9" aria-hidden="true" tabindex="-1"></a>rse_gene_SRP045638<span class="sc">$</span>assigned_gene_prop <span class="ot">&lt;-</span> rse_gene_SRP045638<span class="sc">$</span>recount_qc.gene_fc_count_all.assigned <span class="sc">/</span> rse_gene_SRP045638<span class="sc">$</span>recount_qc.gene_fc_count_all.total</span>
<span id="cb77-10"><a href="differential-gene-expression-analysis-with-limma.html#cb77-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rse_gene_SRP045638<span class="sc">$</span>assigned_gene_prop)</span>
<span id="cb77-11"><a href="differential-gene-expression-analysis-with-limma.html#cb77-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb77-12"><a href="differential-gene-expression-analysis-with-limma.html#cb77-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  0.1942  0.7004  0.7591  0.7170  0.7991  0.8493</span></span>
<span id="cb77-13"><a href="differential-gene-expression-analysis-with-limma.html#cb77-13" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="fu">colData</span>(rse_gene_SRP045638), <span class="fu">plot</span>(assigned_gene_prop, sra_attribute.RIN))</span></code></pre></div>
<p><img src="_main_files/figure-html/new_variables-1.png" width="672" /></p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="differential-gene-expression-analysis-with-limma.html#cb78-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-2"><a href="differential-gene-expression-analysis-with-limma.html#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Hm... lets check if there is a difference between these two groups</span></span>
<span id="cb78-3"><a href="differential-gene-expression-analysis-with-limma.html#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="fu">colData</span>(rse_gene_SRP045638), <span class="fu">tapply</span>(assigned_gene_prop, prenatal, summary))</span>
<span id="cb78-4"><a href="differential-gene-expression-analysis-with-limma.html#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $postnatal</span></span>
<span id="cb78-5"><a href="differential-gene-expression-analysis-with-limma.html#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb78-6"><a href="differential-gene-expression-analysis-with-limma.html#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  0.1942  0.7072  0.7719  0.7179  0.8017  0.8493 </span></span>
<span id="cb78-7"><a href="differential-gene-expression-analysis-with-limma.html#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb78-8"><a href="differential-gene-expression-analysis-with-limma.html#cb78-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $prenatal</span></span>
<span id="cb78-9"><a href="differential-gene-expression-analysis-with-limma.html#cb78-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb78-10"><a href="differential-gene-expression-analysis-with-limma.html#cb78-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  0.6856  0.7004  0.7088  0.7116  0.7259  0.7347</span></span></code></pre></div>
<p>We can next drop some samples that we consider of low quality as well as genes that have low expression levels.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="differential-gene-expression-analysis-with-limma.html#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Lets save our full object for now in case we change our minds later on</span></span>
<span id="cb79-2"><a href="differential-gene-expression-analysis-with-limma.html#cb79-2" aria-hidden="true" tabindex="-1"></a>rse_gene_SRP045638_unfiltered <span class="ot">&lt;-</span> rse_gene_SRP045638</span>
<span id="cb79-3"><a href="differential-gene-expression-analysis-with-limma.html#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="differential-gene-expression-analysis-with-limma.html#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Lets drop some bad samples. On a real analysis, you would likely use</span></span>
<span id="cb79-5"><a href="differential-gene-expression-analysis-with-limma.html#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="do">## some statistical method for identifying outliers such as scuttle::isOutlier()</span></span>
<span id="cb79-6"><a href="differential-gene-expression-analysis-with-limma.html#cb79-6" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(rse_gene_SRP045638<span class="sc">$</span>assigned_gene_prop)</span></code></pre></div>
<p><img src="_main_files/figure-html/filter_rse-1.png" width="672" /></p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="differential-gene-expression-analysis-with-limma.html#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(rse_gene_SRP045638<span class="sc">$</span>assigned_gene_prop <span class="sc">&lt;</span> <span class="fl">0.3</span>)</span>
<span id="cb80-2"><a href="differential-gene-expression-analysis-with-limma.html#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb80-3"><a href="differential-gene-expression-analysis-with-limma.html#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; FALSE  TRUE </span></span>
<span id="cb80-4"><a href="differential-gene-expression-analysis-with-limma.html#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    65     1</span></span>
<span id="cb80-5"><a href="differential-gene-expression-analysis-with-limma.html#cb80-5" aria-hidden="true" tabindex="-1"></a>rse_gene_SRP045638 <span class="ot">&lt;-</span> rse_gene_SRP045638[, rse_gene_SRP045638<span class="sc">$</span>assigned_gene_prop <span class="sc">&gt;</span> <span class="fl">0.3</span>]</span>
<span id="cb80-6"><a href="differential-gene-expression-analysis-with-limma.html#cb80-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-7"><a href="differential-gene-expression-analysis-with-limma.html#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Lets compute the mean expression levels.</span></span>
<span id="cb80-8"><a href="differential-gene-expression-analysis-with-limma.html#cb80-8" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb80-9"><a href="differential-gene-expression-analysis-with-limma.html#cb80-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Note: in a real analysis we would likely do this with RPKMs or CPMs instead</span></span>
<span id="cb80-10"><a href="differential-gene-expression-analysis-with-limma.html#cb80-10" aria-hidden="true" tabindex="-1"></a><span class="do">## of counts. That is, we would use one of the following options:</span></span>
<span id="cb80-11"><a href="differential-gene-expression-analysis-with-limma.html#cb80-11" aria-hidden="true" tabindex="-1"></a><span class="co"># edgeR::filterByExpr() https://bioconductor.org/packages/edgeR/ https://rdrr.io/bioc/edgeR/man/filterByExpr.html</span></span>
<span id="cb80-12"><a href="differential-gene-expression-analysis-with-limma.html#cb80-12" aria-hidden="true" tabindex="-1"></a><span class="co"># genefilter::genefilter() https://bioconductor.org/packages/genefilter/ https://rdrr.io/bioc/genefilter/man/genefilter.html</span></span>
<span id="cb80-13"><a href="differential-gene-expression-analysis-with-limma.html#cb80-13" aria-hidden="true" tabindex="-1"></a><span class="co"># jaffelab::expression_cutoff() http://research.libd.org/jaffelab/reference/expression_cutoff.html</span></span>
<span id="cb80-14"><a href="differential-gene-expression-analysis-with-limma.html#cb80-14" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb80-15"><a href="differential-gene-expression-analysis-with-limma.html#cb80-15" aria-hidden="true" tabindex="-1"></a>gene_means <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(<span class="fu">assay</span>(rse_gene_SRP045638, <span class="st">&quot;counts&quot;</span>))</span>
<span id="cb80-16"><a href="differential-gene-expression-analysis-with-limma.html#cb80-16" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gene_means)</span>
<span id="cb80-17"><a href="differential-gene-expression-analysis-with-limma.html#cb80-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. </span></span>
<span id="cb80-18"><a href="differential-gene-expression-analysis-with-limma.html#cb80-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       0.0       0.1       2.5     815.2     170.2 1362047.9</span></span>
<span id="cb80-19"><a href="differential-gene-expression-analysis-with-limma.html#cb80-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-20"><a href="differential-gene-expression-analysis-with-limma.html#cb80-20" aria-hidden="true" tabindex="-1"></a><span class="do">## We can now drop genes with low expression levels</span></span>
<span id="cb80-21"><a href="differential-gene-expression-analysis-with-limma.html#cb80-21" aria-hidden="true" tabindex="-1"></a>rse_gene_SRP045638 <span class="ot">&lt;-</span> rse_gene_SRP045638[gene_means <span class="sc">&gt;</span> <span class="fl">0.1</span>, ]</span>
<span id="cb80-22"><a href="differential-gene-expression-analysis-with-limma.html#cb80-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-23"><a href="differential-gene-expression-analysis-with-limma.html#cb80-23" aria-hidden="true" tabindex="-1"></a><span class="do">## Final dimensions of our RSE object</span></span>
<span id="cb80-24"><a href="differential-gene-expression-analysis-with-limma.html#cb80-24" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(rse_gene_SRP045638)</span>
<span id="cb80-25"><a href="differential-gene-expression-analysis-with-limma.html#cb80-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 46929    65</span></span>
<span id="cb80-26"><a href="differential-gene-expression-analysis-with-limma.html#cb80-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-27"><a href="differential-gene-expression-analysis-with-limma.html#cb80-27" aria-hidden="true" tabindex="-1"></a><span class="do">## Percent of genes that we retained:</span></span>
<span id="cb80-28"><a href="differential-gene-expression-analysis-with-limma.html#cb80-28" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">nrow</span>(rse_gene_SRP045638) <span class="sc">/</span> <span class="fu">nrow</span>(rse_gene_SRP045638_unfiltered) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)</span>
<span id="cb80-29"><a href="differential-gene-expression-analysis-with-limma.html#cb80-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 73.49</span></span></code></pre></div>
<p>We are now ready to continue with the differential expression analysis. Well, almost! 😅</p>
</div>
<div id="data-normalization-1" class="section level2 hasAnchor" number="10.2">
<h2><span class="header-section-number">10.2</span> Data normalization<a href="differential-gene-expression-analysis-with-limma.html#data-normalization-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Read the <em>A hypothetical scenario</em> in one of the <code>edgeR</code> papers <a href="https://genomebiology.biomedcentral.com/articles/10.1186/gb-2010-11-3-r25#Sec2" class="uri">https://genomebiology.biomedcentral.com/articles/10.1186/gb-2010-11-3-r25#Sec2</a> to understand the concept of <em>composition bias</em>.</li>
<li>This concept is still relevant nowadays with single cell RNA-seq (scRNA-seq) data as you can see at <a href="http://bioconductor.org/books/3.16/OSCA.multisample/multi-sample-comparisons.html#performing-the-de-analysis" class="uri">http://bioconductor.org/books/3.16/OSCA.multisample/multi-sample-comparisons.html#performing-the-de-analysis</a>. In that chapter they describe a series of steps for re-using bulk RNA-seq methods with scRNA-seq data.</li>
</ul>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="differential-gene-expression-analysis-with-limma.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Use edgeR::calcNormFactors() to address the composition bias</span></span>
<span id="cb81-2"><a href="differential-gene-expression-analysis-with-limma.html#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;edgeR&quot;</span>)</span>
<span id="cb81-3"><a href="differential-gene-expression-analysis-with-limma.html#cb81-3" aria-hidden="true" tabindex="-1"></a>dge <span class="ot">&lt;-</span> <span class="fu">DGEList</span>(</span>
<span id="cb81-4"><a href="differential-gene-expression-analysis-with-limma.html#cb81-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">counts =</span> <span class="fu">assay</span>(rse_gene_SRP045638, <span class="st">&quot;counts&quot;</span>),</span>
<span id="cb81-5"><a href="differential-gene-expression-analysis-with-limma.html#cb81-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">genes =</span> <span class="fu">rowData</span>(rse_gene_SRP045638)</span>
<span id="cb81-6"><a href="differential-gene-expression-analysis-with-limma.html#cb81-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-7"><a href="differential-gene-expression-analysis-with-limma.html#cb81-7" aria-hidden="true" tabindex="-1"></a>dge <span class="ot">&lt;-</span> <span class="fu">calcNormFactors</span>(dge)</span></code></pre></div>
</div>
<div id="differential-expression" class="section level2 hasAnchor" number="10.3">
<h2><span class="header-section-number">10.3</span> Differential expression<a href="differential-gene-expression-analysis-with-limma.html#differential-expression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>First of all, lets define our differential expression model. Typically, we would explore the data more to check that there are no other quality control issues with our samples and to explore in more detail the relationship between our sample phenotype variables.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="differential-gene-expression-analysis-with-limma.html#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb82-2"><a href="differential-gene-expression-analysis-with-limma.html#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">as.data.frame</span>(<span class="fu">colData</span>(rse_gene_SRP045638)), <span class="fu">aes</span>(<span class="at">y =</span> assigned_gene_prop, <span class="at">x =</span> prenatal)) <span class="sc">+</span></span>
<span id="cb82-3"><a href="differential-gene-expression-analysis-with-limma.html#cb82-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb82-4"><a href="differential-gene-expression-analysis-with-limma.html#cb82-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb82-5"><a href="differential-gene-expression-analysis-with-limma.html#cb82-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;Assigned Gene Prop&quot;</span>) <span class="sc">+</span></span>
<span id="cb82-6"><a href="differential-gene-expression-analysis-with-limma.html#cb82-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Age Group&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/explore_gene_prop_by_age-1.png" width="672" /></p>
<p>For example, we would explore the contribution of different variables to the gene expression variability we observe using the <a href="https://bioconductor.org/packages/variancePartition"><code>variancePartition</code></a> and <a href="https://bioconductor.org/packages/scater"><code>scater</code></a> Bioconductor packages, among others. We’ll do more of this tomorrow but you can also check these <a href="https://docs.google.com/document/d/1hil3zwPN6BW6HlwldLbM1FdlLIBWKFNXRUqJJEK_-eY/edit">LIBD rstats club notes</a>.</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/OdNU5LUOHng" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<p>For now, we’ll use the following stastistical model.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="differential-gene-expression-analysis-with-limma.html#cb83-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> prenatal <span class="sc">+</span> sra_attribute.RIN <span class="sc">+</span> sra_attribute.sex <span class="sc">+</span> assigned_gene_prop,</span>
<span id="cb83-2"><a href="differential-gene-expression-analysis-with-limma.html#cb83-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">colData</span>(rse_gene_SRP045638)</span>
<span id="cb83-3"><a href="differential-gene-expression-analysis-with-limma.html#cb83-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb83-4"><a href="differential-gene-expression-analysis-with-limma.html#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mod)</span>
<span id="cb83-5"><a href="differential-gene-expression-analysis-with-limma.html#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;(Intercept)&quot;           &quot;prenatalprenatal&quot;      &quot;sra_attribute.RIN&quot;     &quot;sra_attribute.sexmale&quot;</span></span>
<span id="cb83-6"><a href="differential-gene-expression-analysis-with-limma.html#cb83-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5] &quot;assigned_gene_prop&quot;</span></span></code></pre></div>
<p>Now that we have a model, we can use <code>limma</code> to actually compute the differential expression statistics and extract the results.</p>
<script defer class="speakerdeck-embed" data-slide="57" data-id="3c32410b600740abb4724486e83ebd30" data-ratio="1.77725118483412" src="//speakerdeck.com/assets/embed.js"></script>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="differential-gene-expression-analysis-with-limma.html#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;limma&quot;</span>)</span>
<span id="cb84-2"><a href="differential-gene-expression-analysis-with-limma.html#cb84-2" aria-hidden="true" tabindex="-1"></a>vGene <span class="ot">&lt;-</span> <span class="fu">voom</span>(dge, mod, <span class="at">plot =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/run_limma-1.png" width="672" /></p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="differential-gene-expression-analysis-with-limma.html#cb85-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-2"><a href="differential-gene-expression-analysis-with-limma.html#cb85-2" aria-hidden="true" tabindex="-1"></a>eb_results <span class="ot">&lt;-</span> <span class="fu">eBayes</span>(<span class="fu">lmFit</span>(vGene))</span>
<span id="cb85-3"><a href="differential-gene-expression-analysis-with-limma.html#cb85-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-4"><a href="differential-gene-expression-analysis-with-limma.html#cb85-4" aria-hidden="true" tabindex="-1"></a>de_results <span class="ot">&lt;-</span> <span class="fu">topTable</span>(</span>
<span id="cb85-5"><a href="differential-gene-expression-analysis-with-limma.html#cb85-5" aria-hidden="true" tabindex="-1"></a>    eb_results,</span>
<span id="cb85-6"><a href="differential-gene-expression-analysis-with-limma.html#cb85-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">coef =</span> <span class="dv">2</span>,</span>
<span id="cb85-7"><a href="differential-gene-expression-analysis-with-limma.html#cb85-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">number =</span> <span class="fu">nrow</span>(rse_gene_SRP045638),</span>
<span id="cb85-8"><a href="differential-gene-expression-analysis-with-limma.html#cb85-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">sort.by =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb85-9"><a href="differential-gene-expression-analysis-with-limma.html#cb85-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb85-10"><a href="differential-gene-expression-analysis-with-limma.html#cb85-10" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(de_results)</span>
<span id="cb85-11"><a href="differential-gene-expression-analysis-with-limma.html#cb85-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 46929    16</span></span>
<span id="cb85-12"><a href="differential-gene-expression-analysis-with-limma.html#cb85-12" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(de_results)</span>
<span id="cb85-13"><a href="differential-gene-expression-analysis-with-limma.html#cb85-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                    source type bp_length phase           gene_id                          gene_type gene_name level</span></span>
<span id="cb85-14"><a href="differential-gene-expression-analysis-with-limma.html#cb85-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ENSG00000223972.5  HAVANA gene      1735    NA ENSG00000223972.5 transcribed_unprocessed_pseudogene   DDX11L1     2</span></span>
<span id="cb85-15"><a href="differential-gene-expression-analysis-with-limma.html#cb85-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ENSG00000278267.1 ENSEMBL gene        68    NA ENSG00000278267.1                              miRNA MIR6859-1     3</span></span>
<span id="cb85-16"><a href="differential-gene-expression-analysis-with-limma.html#cb85-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ENSG00000227232.5  HAVANA gene      1351    NA ENSG00000227232.5             unprocessed_pseudogene    WASH7P     2</span></span>
<span id="cb85-17"><a href="differential-gene-expression-analysis-with-limma.html#cb85-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                            havana_gene  tag      logFC   AveExpr         t      P.Value    adj.P.Val         B</span></span>
<span id="cb85-18"><a href="differential-gene-expression-analysis-with-limma.html#cb85-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ENSG00000223972.5 OTTHUMG00000000961.2 &lt;NA&gt; -0.4522185 -3.444164 -1.637034 1.064080e-01 1.348462e-01 -5.554484</span></span>
<span id="cb85-19"><a href="differential-gene-expression-analysis-with-limma.html#cb85-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ENSG00000278267.1                 &lt;NA&gt; &lt;NA&gt;  1.1158860 -1.311645  6.123756 5.743771e-08 2.105690e-07  7.763912</span></span>
<span id="cb85-20"><a href="differential-gene-expression-analysis-with-limma.html#cb85-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ENSG00000227232.5 OTTHUMG00000000958.1 &lt;NA&gt;  0.6860298  3.641131  5.644804 3.816951e-07 1.247133e-06  5.500784</span></span>
<span id="cb85-21"><a href="differential-gene-expression-analysis-with-limma.html#cb85-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 3 rows ]</span></span>
<span id="cb85-22"><a href="differential-gene-expression-analysis-with-limma.html#cb85-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-23"><a href="differential-gene-expression-analysis-with-limma.html#cb85-23" aria-hidden="true" tabindex="-1"></a><span class="do">## Differentially expressed genes between pre and post natal with FDR &lt; 5%</span></span>
<span id="cb85-24"><a href="differential-gene-expression-analysis-with-limma.html#cb85-24" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(de_results<span class="sc">$</span>adj.P.Val <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb85-25"><a href="differential-gene-expression-analysis-with-limma.html#cb85-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb85-26"><a href="differential-gene-expression-analysis-with-limma.html#cb85-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; FALSE  TRUE </span></span>
<span id="cb85-27"><a href="differential-gene-expression-analysis-with-limma.html#cb85-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12851 34078</span></span>
<span id="cb85-28"><a href="differential-gene-expression-analysis-with-limma.html#cb85-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-29"><a href="differential-gene-expression-analysis-with-limma.html#cb85-29" aria-hidden="true" tabindex="-1"></a><span class="do">## We can now visualize the resulting differential expression results</span></span>
<span id="cb85-30"><a href="differential-gene-expression-analysis-with-limma.html#cb85-30" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMA</span>(eb_results, <span class="at">coef =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/run_limma-2.png" width="672" /></p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="differential-gene-expression-analysis-with-limma.html#cb86-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-2"><a href="differential-gene-expression-analysis-with-limma.html#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="do">## We can also make a volcano plot</span></span>
<span id="cb86-3"><a href="differential-gene-expression-analysis-with-limma.html#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="fu">volcanoplot</span>(eb_results, <span class="at">coef =</span> <span class="dv">2</span>, <span class="at">highlight =</span> <span class="dv">3</span>, <span class="at">names =</span> de_results<span class="sc">$</span>gene_name)</span></code></pre></div>
<p><img src="_main_files/figure-html/run_limma-3.png" width="672" /></p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="differential-gene-expression-analysis-with-limma.html#cb87-1" aria-hidden="true" tabindex="-1"></a>de_results[de_results<span class="sc">$</span>gene_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;ZSCAN2&quot;</span>, <span class="st">&quot;VASH2&quot;</span>, <span class="st">&quot;KIAA0922&quot;</span>), ]</span>
<span id="cb87-2"><a href="differential-gene-expression-analysis-with-limma.html#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                    source type bp_length phase            gene_id      gene_type gene_name level          havana_gene</span></span>
<span id="cb87-3"><a href="differential-gene-expression-analysis-with-limma.html#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ENSG00000143494.15 HAVANA gene      9086    NA ENSG00000143494.15 protein_coding     VASH2     2 OTTHUMG00000036925.5</span></span>
<span id="cb87-4"><a href="differential-gene-expression-analysis-with-limma.html#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ENSG00000176371.13 HAVANA gene      4878    NA ENSG00000176371.13 protein_coding    ZSCAN2     1 OTTHUMG00000074027.5</span></span>
<span id="cb87-5"><a href="differential-gene-expression-analysis-with-limma.html#cb87-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ENSG00000121210.15 HAVANA gene      6393    NA ENSG00000121210.15 protein_coding  KIAA0922     2 OTTHUMG00000153244.5</span></span>
<span id="cb87-6"><a href="differential-gene-expression-analysis-with-limma.html#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                     tag    logFC  AveExpr        t      P.Value    adj.P.Val         B</span></span>
<span id="cb87-7"><a href="differential-gene-expression-analysis-with-limma.html#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ENSG00000143494.15 &lt;NA&gt; 5.444271 1.876990 37.85216 2.561452e-46 6.010319e-42  95.10126</span></span>
<span id="cb87-8"><a href="differential-gene-expression-analysis-with-limma.html#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ENSG00000176371.13 &lt;NA&gt; 2.735639 2.751109 36.59344 2.137022e-45 3.342943e-41  92.99949</span></span>
<span id="cb87-9"><a href="differential-gene-expression-analysis-with-limma.html#cb87-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ENSG00000121210.15 &lt;NA&gt; 3.283050 2.945269 41.89725 4.235912e-49 1.987871e-44 101.31124</span></span></code></pre></div>
<ul>
<li><a href="https://www.genecards.org/cgi-bin/carddisp.pl?gene=ZSCAN2" class="uri">https://www.genecards.org/cgi-bin/carddisp.pl?gene=ZSCAN2</a></li>
<li><a href="https://www.genecards.org/cgi-bin/carddisp.pl?gene=VASH2" class="uri">https://www.genecards.org/cgi-bin/carddisp.pl?gene=VASH2</a></li>
<li><a href="https://www.genecards.org/cgi-bin/carddisp.pl?gene=KIAA0922" class="uri">https://www.genecards.org/cgi-bin/carddisp.pl?gene=KIAA0922</a></li>
</ul>
</div>
<div id="visualizing-degs" class="section level2 hasAnchor" number="10.4">
<h2><span class="header-section-number">10.4</span> Visualizing DEGs<a href="differential-gene-expression-analysis-with-limma.html#visualizing-degs" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>From <code>vGene$E</code> we can extract the normalized expression values that <code>limma-voom</code> computed. We can check the top 50 differentially expressed genes (DEGs) for example.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="differential-gene-expression-analysis-with-limma.html#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Extract the normalized expression values from our limma-voom result</span></span>
<span id="cb88-2"><a href="differential-gene-expression-analysis-with-limma.html#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="do">## from earlier</span></span>
<span id="cb88-3"><a href="differential-gene-expression-analysis-with-limma.html#cb88-3" aria-hidden="true" tabindex="-1"></a>exprs_heatmap <span class="ot">&lt;-</span> vGene<span class="sc">$</span>E[<span class="fu">rank</span>(de_results<span class="sc">$</span>adj.P.Val) <span class="sc">&lt;=</span> <span class="dv">50</span>, ]</span>
<span id="cb88-4"><a href="differential-gene-expression-analysis-with-limma.html#cb88-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-5"><a href="differential-gene-expression-analysis-with-limma.html#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="do">## We can now build a table with information about our samples and</span></span>
<span id="cb88-6"><a href="differential-gene-expression-analysis-with-limma.html#cb88-6" aria-hidden="true" tabindex="-1"></a><span class="do">## then make the names a bit more friendly by making them easier to</span></span>
<span id="cb88-7"><a href="differential-gene-expression-analysis-with-limma.html#cb88-7" aria-hidden="true" tabindex="-1"></a><span class="do">## understand</span></span>
<span id="cb88-8"><a href="differential-gene-expression-analysis-with-limma.html#cb88-8" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">colData</span>(rse_gene_SRP045638)[, <span class="fu">c</span>(<span class="st">&quot;prenatal&quot;</span>, <span class="st">&quot;sra_attribute.RIN&quot;</span>, <span class="st">&quot;sra_attribute.sex&quot;</span>)])</span>
<span id="cb88-9"><a href="differential-gene-expression-analysis-with-limma.html#cb88-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;AgeGroup&quot;</span>, <span class="st">&quot;RIN&quot;</span>, <span class="st">&quot;Sex&quot;</span>)</span>
<span id="cb88-10"><a href="differential-gene-expression-analysis-with-limma.html#cb88-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-11"><a href="differential-gene-expression-analysis-with-limma.html#cb88-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Next, we can make a basic heatmap</span></span>
<span id="cb88-12"><a href="differential-gene-expression-analysis-with-limma.html#cb88-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;pheatmap&quot;</span>)</span>
<span id="cb88-13"><a href="differential-gene-expression-analysis-with-limma.html#cb88-13" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(</span>
<span id="cb88-14"><a href="differential-gene-expression-analysis-with-limma.html#cb88-14" aria-hidden="true" tabindex="-1"></a>    exprs_heatmap,</span>
<span id="cb88-15"><a href="differential-gene-expression-analysis-with-limma.html#cb88-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">cluster_rows =</span> <span class="cn">TRUE</span>,</span>
<span id="cb88-16"><a href="differential-gene-expression-analysis-with-limma.html#cb88-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">cluster_cols =</span> <span class="cn">TRUE</span>,</span>
<span id="cb88-17"><a href="differential-gene-expression-analysis-with-limma.html#cb88-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">show_rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb88-18"><a href="differential-gene-expression-analysis-with-limma.html#cb88-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">show_colnames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb88-19"><a href="differential-gene-expression-analysis-with-limma.html#cb88-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">annotation_col =</span> df</span>
<span id="cb88-20"><a href="differential-gene-expression-analysis-with-limma.html#cb88-20" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="_main_files/figure-html/pheatmap-1.png" width="672" /></p>
<p>We’ll learn more about gene expression heatmaps tomorrow!</p>
<p>Overall, these DEG results are not as surprising since there is a huge difference between pre and post natal gene expression in the human DLPFC. We can see that more clearly with a MDS (multidimensional scaling) plot just like its described <a href="http://bioconductor.org/packages/release/workflows/vignettes/RNAseq123/inst/doc/limmaWorkflow.html#unsupervised-clustering-of-samples">in the limma workflow</a>. Tomas will teach you more about dimension reduction tomorrow.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="differential-gene-expression-analysis-with-limma.html#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="do">## For nicer colors</span></span>
<span id="cb89-2"><a href="differential-gene-expression-analysis-with-limma.html#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;RColorBrewer&quot;</span>)</span>
<span id="cb89-3"><a href="differential-gene-expression-analysis-with-limma.html#cb89-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-4"><a href="differential-gene-expression-analysis-with-limma.html#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Mapping age groups into colors</span></span>
<span id="cb89-5"><a href="differential-gene-expression-analysis-with-limma.html#cb89-5" aria-hidden="true" tabindex="-1"></a>col.group <span class="ot">&lt;-</span> df<span class="sc">$</span>AgeGroup</span>
<span id="cb89-6"><a href="differential-gene-expression-analysis-with-limma.html#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(col.group) <span class="ot">&lt;-</span> <span class="fu">brewer.pal</span>(<span class="fu">nlevels</span>(col.group), <span class="st">&quot;Set1&quot;</span>)</span>
<span id="cb89-7"><a href="differential-gene-expression-analysis-with-limma.html#cb89-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in brewer.pal(nlevels(col.group), &quot;Set1&quot;): minimal value for n is 3, returning requested palette with 3 different levels</span></span>
<span id="cb89-8"><a href="differential-gene-expression-analysis-with-limma.html#cb89-8" aria-hidden="true" tabindex="-1"></a>col.group <span class="ot">&lt;-</span> <span class="fu">as.character</span>(col.group)</span>
<span id="cb89-9"><a href="differential-gene-expression-analysis-with-limma.html#cb89-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-10"><a href="differential-gene-expression-analysis-with-limma.html#cb89-10" aria-hidden="true" tabindex="-1"></a><span class="do">## MDS by age groups</span></span>
<span id="cb89-11"><a href="differential-gene-expression-analysis-with-limma.html#cb89-11" aria-hidden="true" tabindex="-1"></a>limma<span class="sc">::</span><span class="fu">plotMDS</span>(vGene<span class="sc">$</span>E, <span class="at">labels =</span> df<span class="sc">$</span>AgeGroup, <span class="at">col =</span> col.group)</span></code></pre></div>
<p><img src="_main_files/figure-html/plot_mds-1.png" width="672" /></p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="differential-gene-expression-analysis-with-limma.html#cb90-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-2"><a href="differential-gene-expression-analysis-with-limma.html#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Mapping Sex values into colors</span></span>
<span id="cb90-3"><a href="differential-gene-expression-analysis-with-limma.html#cb90-3" aria-hidden="true" tabindex="-1"></a>col.sex <span class="ot">&lt;-</span> df<span class="sc">$</span>Sex</span>
<span id="cb90-4"><a href="differential-gene-expression-analysis-with-limma.html#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(col.sex) <span class="ot">&lt;-</span> <span class="fu">brewer.pal</span>(<span class="fu">nlevels</span>(col.sex), <span class="st">&quot;Dark2&quot;</span>)</span>
<span id="cb90-5"><a href="differential-gene-expression-analysis-with-limma.html#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in brewer.pal(nlevels(col.sex), &quot;Dark2&quot;): minimal value for n is 3, returning requested palette with 3 different levels</span></span>
<span id="cb90-6"><a href="differential-gene-expression-analysis-with-limma.html#cb90-6" aria-hidden="true" tabindex="-1"></a>col.sex <span class="ot">&lt;-</span> <span class="fu">as.character</span>(col.sex)</span>
<span id="cb90-7"><a href="differential-gene-expression-analysis-with-limma.html#cb90-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-8"><a href="differential-gene-expression-analysis-with-limma.html#cb90-8" aria-hidden="true" tabindex="-1"></a><span class="do">## MDS by Sex</span></span>
<span id="cb90-9"><a href="differential-gene-expression-analysis-with-limma.html#cb90-9" aria-hidden="true" tabindex="-1"></a>limma<span class="sc">::</span><span class="fu">plotMDS</span>(vGene<span class="sc">$</span>E, <span class="at">labels =</span> df<span class="sc">$</span>Sex, <span class="at">col =</span> col.sex)</span></code></pre></div>
<p><img src="_main_files/figure-html/plot_mds-2.png" width="672" /></p>
<p>A lot of times, running the differential expression analysis is not the hard part. Building your model and having all the covariates you need can take much more work!</p>
<script defer class="speakerdeck-embed" data-slide="56" data-id="3c32410b600740abb4724486e83ebd30" data-ratio="1.77725118483412" src="//speakerdeck.com/assets/embed.js"></script>
</div>
<div id="community-4" class="section level2 hasAnchor" number="10.5">
<h2><span class="header-section-number">10.5</span> Community<a href="differential-gene-expression-analysis-with-limma.html#community-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Some <code>edgeR</code> and <code>limma</code> authors:</p>
<ul>
<li><a href="https://twitter.com/mritchieau" class="uri">https://twitter.com/mritchieau</a></li>
<li><a href="https://twitter.com/davisjmcc" class="uri">https://twitter.com/davisjmcc</a></li>
<li><a href="https://twitter.com/markrobinsonca" class="uri">https://twitter.com/markrobinsonca</a></li>
<li><a href="https://twitter.com/AliciaOshlack" class="uri">https://twitter.com/AliciaOshlack</a></li>
</ul>
<blockquote class="twitter-tweet">
<p lang="en" dir="ltr">
If you've ever been dazed by design matrices or confused by contrasts when performing gene expression analysis in limma, the new article by Charity Law is for you <a href="https://t.co/ZSMOA20tdm">https://t.co/ZSMOA20tdm</a> <a href="https://twitter.com/hashtag/bioconductor?src=hash&amp;ref_src=twsrc%5Etfw">#bioconductor</a> <a href="https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw">#rstats</a> (1/2)
</p>
— Matt Ritchie (<span class="citation">@mritchieau</span>) <a href="https://twitter.com/mritchieau/status/1338639551128952832?ref_src=twsrc%5Etfw">December 15, 2020</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

</div>
</div>
<div class="container">
    <footer class="site-footer">

      <center>
<p class="powered-by">
© 2011-2023. All thoughts and opinions here are my own. The icon was designed by <a href="https://www.linkedin.com/in/mauricio-guzman-6529b551/">Mauricio Guzmán</a> and is inspired by <a href="https://en.wikipedia.org/wiki/Huichol">Huichol culture</a>; it represents my community building interests.
</p>

<p class="powered-by copyright-license-text">
This work is licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0" rel="noopener noreferrer" target="_blank">CC BY NC SA 4.0</a>
</p>

<p class="powered-by footer-license-icons">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0" rel="noopener noreferrer" target="_blank">
      <img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg" alt="CC icon" width="32px">
      <img src="https://mirrors.creativecommons.org/presskit/icons/by.svg" alt="CC by icon" width="32px">
      <img src="https://mirrors.creativecommons.org/presskit/icons/nc.svg" alt="CC NC icon" width="32px">
      <img src="https://mirrors.creativecommons.org/presskit/icons/sa.svg" alt="CC SA icon" width="32px">
    </a>
</p>

<div id="clustrmaps-widget"></div><script type='text/javascript' id='clustrmaps' src='//cdn.clustrmaps.com/map_v2.js?cl=ffffff&w=300&t=m&d=Zo-deincaJGsqhqjIWsujtdoNOMJsnnZLefKmxDKVv8&co=124b73&cmo=dd53ff&cmn=4ec724'></script>

<p class="powered-by">
Published with <a href="https://bookdown.org/" target="_blank" rel="noopener">Bookdown</a>
</p>

</center>



<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-45299226-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-45299226-1');
</script>

</footer>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="interpreting-model-coefficients-with-exploremodelmatrix.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="differential-gene-expression-exercise.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
